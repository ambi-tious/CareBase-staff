# 連絡・予定編集画面設計書

- 画面名: `連絡・予定編集`
- パス: `/contact-schedule/edit/[itemId]`
- URL: https://carebase-staff.vercel.app/contact-schedule/edit/[itemId]

## 概要

連絡・予定編集画面設計書です。
既存の連絡事項・予定・申し送りの内容を編集・更新する機能を提供し、介護現場での情報管理を効率的に行えます。
下書き保存機能により、作業の中断・再開が可能で、バリデーション機能により入力ミスを防止します。

## 全体レイアウト

### 画面構成

連絡・予定編集のメイン画面として以下の要素で構成：

- ページヘッダー（画面タイトル、説明文、戻るボタン）
- 成功・エラーメッセージ表示エリア
- 連絡・予定編集フォーム（2列レイアウト）
- アクションボタン（キャンセル、下書き保存、更新）

### 画面項目

| 項目名           | コンポーネント | 必須 | 表示条件     | 初期値             | 備考                                                     |
| ---------------- | -------------- | ---- | ------------ | ------------------ | -------------------------------------------------------- |
| 戻るボタン       | Button         | -    | 常時         | 戻る               | アウトライン、ArrowLeft アイコン                         |
| 画面タイトル     | Heading        | -    | 常時         | 連絡・予定編集     | Edit3 アイコン付き                                       |
| 説明文           | Text           | -    | 常時         | 編集説明           | 必須項目マークの説明含む                                 |
| 成功メッセージ   | Alert          | -    | 更新成功時   | -                  | 緑色背景、CheckCircle アイコン                           |
| エラーアラート   | Alert          | -    | 更新エラー時 | -                  | 赤色背景、エラーメッセージ表示                           |
| 作成者表示       | InfoDisplay    | -    | 常時         | ログインユーザー名 | 青色背景、User アイコン付き                              |
| タイトル入力     | FormField      | ◯    | 常時         | 既存データ         | テキスト入力、プレースホルダー「夏季感染症対策について」 |
| 種別選択         | FormSelect     | ◯    | 常時         | 既存データ         | 連絡事項/予定/申し送り                                   |
| 重要度選択       | FormSelect     | ◯    | 常時         | 既存データ         | 高/中/低                                                 |
| 対象者選択       | FormSelect     | ◯    | 常時         | 既存データ         | 全職員/グループ別                                        |
| 実施日入力       | FormField      | ◯    | 常時         | 既存データ         | 日付入力                                                 |
| 開始時刻入力     | FormField      | -    | 常時         | 既存データ         | 時刻入力                                                 |
| 終了時刻入力     | FormField      | -    | 常時         | 既存データ         | 時刻入力                                                 |
| 関連利用者選択   | FormSelect     | -    | 常時         | 既存データ         | 利用者一覧から選択                                       |
| タグ入力         | FormField      | -    | 常時         | 既存データ         | カンマ区切りテキスト                                     |
| 内容入力         | Textarea       | ◯    | 常時         | 既存データ         | 大きなテキストエリア、1000文字制限                       |
| 未保存変更警告   | Alert          | -    | 変更あり時   | -                  | 黄色背景、AlertCircle アイコン                           |
| キャンセルボタン | Button         | -    | 常時         | キャンセル         | アウトライン                                             |
| 下書き保存ボタン | Button         | -    | 常時         | 下書き保存         | アウトライン、Save アイコン                              |
| 更新ボタン       | Button         | -    | 常時         | 更新               | 青色スタイル、Send アイコン                              |

## 機能仕様

### アクション

| 項目名           | 処理内容                       | 対象API                                   | 遷移先画面                                    |
| ---------------- | ------------------------------ | ----------------------------------------- | --------------------------------------------- |
| 戻るボタン       | 連絡・予定詳細画面に戻る       | -                                         | 連絡・予定詳細画面 (`/contact-schedule/{id}`) |
| フォーム入力     | リアルタイムバリデーション実行 | -                                         | 同一画面（エラー表示更新）                    |
| 下書き保存       | 入力内容を下書きとして保存     | `PUT /api/v1/contact-schedule/{id}/draft` | 同一画面（成功メッセージ表示）                |
| 更新ボタン       | 連絡・予定を確定して更新       | `PUT /api/v1/contact-schedule/{id}`       | 連絡・予定詳細画面 (`/contact-schedule/{id}`) |
| キャンセルボタン | 入力内容を破棄して詳細に戻る   | -                                         | 連絡・予定詳細画面 (`/contact-schedule/{id}`) |

### 入力チェック

| 項目名       | イベント | チェック内容                   | エラーメッセージ                           |
| ------------ | -------- | ------------------------------ | ------------------------------------------ |
| タイトル入力 | blur     | 必須チェック                   | タイトルは必須です                         |
| タイトル入力 | blur     | 文字数チェック（100文字以内）  | タイトルは100文字以内で入力してください    |
| 種別選択     | change   | 必須選択チェック               | 種別は必須です                             |
| 重要度選択   | change   | 必須選択チェック               | 重要度は必須です                           |
| 対象者選択   | change   | 必須選択チェック               | 対象者は必須です                           |
| 実施日入力   | change   | 必須チェック                   | 実施日は必須です                           |
| 開始時刻入力 | change   | 時刻形式チェック               | 有効な時刻を入力してください               |
| 終了時刻入力 | change   | 時刻形式チェック               | 有効な時刻を入力してください               |
| 終了時刻入力 | change   | 開始時刻との関係チェック       | 終了時刻は開始時刻より後に設定してください |
| 内容入力     | blur     | 必須チェック                   | 内容は必須です                             |
| 内容入力     | input    | 文字数チェック（1000文字以内） | 内容は1000文字以内で入力してください       |
| フォーム送信 | submit   | 全必須項目チェック             | 必須項目をすべて入力してください           |

### バリデーション仕様

#### リアルタイムバリデーション

- **入力時検証**: フォーム項目への入力と同時にバリデーションを実行
- **エラー表示**: 各項目下部に赤色でエラーメッセージを表示
- **送信制御**: バリデーションエラーがある場合は送信ボタンクリック時に送信を阻止

#### 文字数制限

- **タイトル**: 100文字以内
- **内容**: 1000文字以内、リアルタイム文字数表示
- **文字数表示**: 入力中の文字数を「xxx/1000文字」形式で表示

#### 下書き保存仕様

- **バリデーション**: 下書き保存時は必須項目チェックを緩和
- **自動保存**: 一定時間ごとの自動下書き保存（将来実装予定）
- **復元機能**: 下書きからの復元機能（将来実装予定）

#### エラーハンドリング

- **API通信エラー**: 「ネットワークエラーが発生しました。接続を確認してもう一度お試しください。」
- **バリデーションエラー**: 「入力内容に不備があります。必須項目を確認してください。」
- **更新エラー**: 「連絡・予定の更新に失敗しました。もう一度お試しください。」
- **下書き保存エラー**: 「下書き保存に失敗しました。もう一度お試しください。」

## UI/UX仕様

### レスポンシブデザイン

- **モバイル（〜768px）**:
  - フォーム項目を1列で縦並び表示
  - ボタンを全幅で縦積み配置
  - 余白を最小化してコンテンツエリアを最大化
- **タブレット（768px〜1024px）**:
  - フォーム項目を2列グリッドで表示
  - ボタンを右寄せで横並び配置
- **デスクトップ（1024px〜）**:
  - フォーム全体の最大幅を6xlに制限
  - 2列グリッドレイアウトを維持
  - 余白を十分に確保

### カラーテーマ

- **背景色**: `bg-carebase-bg` - アプリケーション標準背景色
- **更新ボタン**: `bg-carebase-blue hover:bg-carebase-blue-dark` - メインアクション
- **下書き保存ボタン**: `border-gray-400 text-gray-700 hover:bg-gray-50` - セカンダリアクション
- **戻る・キャンセルボタン**: `border-gray-300 text-gray-700` - セカンダリアクション
- **成功アラート**: `bg-green-50 border-green-200 text-green-700` - 成功状態
- **エラーアラート**: `bg-red-50 border-red-200 text-red-700` - エラー状態
- **警告アラート**: `bg-yellow-50 border-yellow-200 text-yellow-800` - 警告状態
- **作成者表示**: `bg-blue-50 border-blue-200 text-blue-800` - 情報表示

### フォームUI仕様

- **入力フィールド間隔**: `gap-6` - 項目間の適切な間隔
- **セクション分割**: 基本情報と日時・関連情報を明確に分離
- **ラベル配置**: 各入力フィールドの上部に配置
- **プレースホルダー**: 入力例を示すサンプルテキスト
- **フォーカス状態**: 青色のアウトライン表示
- **文字数カウンター**: 内容入力の下部に表示

### アニメーション

- **ボタンホバー**: スムーズなカラートランジション
- **フォーム送信**: ローディング状態の表示（「更新中...」「保存中...」）
- **アラート表示**: フェードイン効果でアラート表示
- **バリデーション**: リアルタイムでエラーメッセージ表示・非表示

### アクセシビリティ

- **キーボードナビゲーション**: Tabキーでの順次フォーカス移動
- **スクリーンリーダー**:
  - 適切なlabel要素の関連付け
  - 必須項目のaria-required属性
  - エラーメッセージのaria-describedby属性
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスリング表示

### ローディング・無効化状態

- **更新中状態**:
  - 全フォーム要素の無効化
  - 更新ボタンテキストを「更新中...」に変更
  - 下書き保存ボタンの無効化
- **下書き保存中状態**:
  - 下書き保存ボタンテキストを「保存中...」に変更
  - 更新ボタンの無効化
- **バリデーションエラー時**:
  - 該当フィールドの赤色ボーダー表示
  - エラーメッセージの即座表示

## 技術仕様

### 使用コンポーネント

#### 2_molecules層

- **ContactScheduleForm**: 連絡・予定作成・編集フォーム

#### 1_atoms層

- **TypeBadge**: 種別バッジ表示
- **PriorityBadge**: 重要度バッジ表示
- **StatusBadge**: ステータスバッジ表示

#### カスタムフック

- **useContactScheduleForm**: フォーム状態管理とバリデーション

### データ型定義

```typescript
interface ContactScheduleFormData {
  title: string; // タイトル（必須、100文字以内）
  content: string; // 内容（必須、1000文字以内）
  type: ContactScheduleType; // 種別（必須）
  priority: ContactSchedulePriority; // 重要度（必須）
  assignedTo: string; // 対象者（必須）
  dueDate: string; // 実施日（必須）
  startTime?: string; // 開始時刻（任意）
  endTime?: string; // 終了時刻（任意）
  relatedResidentId?: string; // 関連利用者（任意）
  tags?: string; // タグ（任意）
}
```

### API仕様

| メソッド | エンドポイント                        | 説明               |
| -------- | ------------------------------------- | ------------------ |
| GET      | `/api/v1/contact-schedule/{id}`       | 連絡・予定詳細取得 |
| PUT      | `/api/v1/contact-schedule/{id}`       | 連絡・予定更新     |
| PUT      | `/api/v1/contact-schedule/{id}/draft` | 下書き保存         |

### 状態管理

- **フォーム状態**: 入力値、バリデーション状態、送信状態
- **エラー状態**: API通信エラー、バリデーションエラー
- **成功状態**: 更新成功、下書き保存成功
- **未保存変更**: フォーム変更の検知と警告表示

## 参考資料

- [連絡・予定一覧画面設計書](../README.md)
- [連絡・予定詳細画面設計書](../[itemId]/README.md)
- [ContactScheduleForm コンポーネント](../../../../components/2_molecules/contact-schedule/contact-schedule-form.tsx)
- [useContactScheduleForm フック](../../../../hooks/useContactScheduleForm.ts)
- [Contact Schedule Types](../../../../types/contact-schedule.ts)
- [画面一覧](../../../../docs/screen-list.md#連絡予定)
