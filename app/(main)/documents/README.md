# 書類一覧画面設計書

- 画面名: `書類一覧`
- パス: `/documents`
- URL: <https://carebase-staff.vercel.app/documents>

## 概要

書類一覧画面設計書です。
階層的なフォルダ管理システムによる書類管理機能を提供し、フォルダ作成・書類保存・ファイルアップロード・書類作成による効率的な書類管理を実現します。パンくずナビゲーション、検索・ソート機能、一括選択・削除機能を備えたテーブル表示により直感的な操作を可能にします。

## 全体レイアウト

### 画面構成

階層的フォルダ管理のメイン画面として以下の要素で構成：

- パンくずナビゲーション（フォルダ階層表示）
- ページヘッダー（統計情報、アクションボタン）
- アクションボタン（新規書類作成、新規フォルダ作成、ファイルアップロード、選択アイテム削除）
- フォルダ・書類一覧エリア（テーブル表示）
  - 検索機能
  - ソート機能（名前・更新日・サイズ）
  - 一括選択・個別選択
  - アイテム操作（表示・編集・削除）
- 空状態表示
- モーダル（フォルダ作成・編集・削除、ファイルアップロード、一括削除確認）

![書類一覧画面スクリーンショット](https://github.com/user-attachments/assets/de4fb4c5-7973-42f7-adc5-e89a6f477d14)

### 画面項目

| 項目名                       | コンポーネント     | 必須 | 表示条件         | 初期値               | 備考                                      |
| ---------------------------- | ------------------ | ---- | ---------------- | -------------------- | ----------------------------------------- |
| パンくずナビゲーション       | FolderBreadcrumb   | -    | 常時             | ルート階層           | フォルダ階層に応じて動的更新              |
| 統計情報                     | テキスト表示       | -    | 常時             | アイテム件数         | リアルタイム更新、最終更新日時表示        |
| 新規書類ボタン               | Button             | -    | 常時             | 新規書類             | 青色スタイル、FileText アイコン           |
| 新規フォルダボタン           | Button             | -    | 常時             | 新しいフォルダ       | 青色スタイル、FolderPlus アイコン         |
| ファイルアップロードボタン   | Button             | -    | 常時             | ファイルアップロード | アウトライン、Upload アイコン             |
| 選択アイテム削除ボタン       | Button             | -    | 常時             | 選択削除             | アウトライン、選択時赤色、Trash2 アイコン |
| 検索バー                     | Input              | -    | テーブル内       | 空文字               | ファイル名・フォルダ名での部分一致検索    |
| ソート選択                   | Select             | -    | テーブル内       | 名前（昇順）         | 名前/更新日/サイズでの並び替え            |
| 全選択チェックボックス       | Checkbox           | -    | テーブルヘッダー | 未選択               | 全アイテムの一括選択・解除                |
| アイテム一覧テーブル         | FolderContentsView | -    | データあり時     | -                    | テーブル表示、ソート・検索・選択機能      |
| 空状態表示                   | テキスト表示       | -    | データなし時     | -                    | 空フォルダ・検索結果なし時のメッセージ    |
| フォルダ作成モーダル         | FolderCreateModal  | -    | ボタンクリック時 | -                    | フォルダ名入力、重複チェック              |
| フォルダ編集モーダル         | FolderEditModal    | -    | フォルダ編集時   | -                    | フォルダ名変更、重複チェック              |
| フォルダ削除モーダル         | FolderDeleteModal  | -    | フォルダ削除時   | -                    | 削除確認ダイアログ                        |
| ファイルアップロードモーダル | FileUploadModal    | -    | ボタンクリック時 | -                    | ファイル選択・ドラッグ&ドロップ対応       |
| 一括削除確認モーダル         | GenericDeleteModal | -    | 一括削除時       | -                    | 選択アイテムの削除確認                    |

## 機能仕様

### アクション

| 項目名                 | 処理内容                               | 対象API                        | 遷移先画面                            |
| ---------------------- | -------------------------------------- | ------------------------------ | ------------------------------------- |
| 検索実行               | ファイル名・フォルダ名での部分一致検索 | -                              | 同一画面（結果更新）                  |
| ソート変更             | 名前・更新日・サイズでの並び替え       | -                              | 同一画面（結果更新）                  |
| 全選択・解除           | テーブル内全アイテムの選択状態切替     | -                              | 同一画面（選択状態更新）              |
| アイテム個別選択       | 個別アイテムのチェック状態変更         | -                              | 同一画面（選択状態更新）              |
| 新規書類作成           | 書類作成画面への遷移                   | -                              | 書類作成画面 (`/documents/edit`)      |
| 新規フォルダ作成       | フォルダ作成モーダルを表示             | モック関数 `createFolder`      | 同一画面（フォルダ追加）              |
| ファイルアップロード   | ファイルアップロードモーダルを表示     | モック関数 `handleUpload`      | 同一画面（ファイル追加）              |
| 選択アイテム一括削除   | 選択したアイテムの削除確認を表示       | モック関数 `executeDelete`     | 同一画面（アイテム削除）              |
| フォルダクリック       | 選択したフォルダ内の表示               | モック関数 `getFolderContents` | 同一画面（階層移動）                  |
| 書類クリック           | 選択した書類の表示画面への遷移         | -                              | 書類表示画面 (`/documents/view/{id}`) |
| フォルダ編集           | フォルダ編集モーダルを表示             | モック関数 `updateFolder`      | 同一画面（フォルダ名更新）            |
| フォルダ削除           | フォルダ削除確認モーダルを表示         | モック関数 `deleteFolder`      | 同一画面（フォルダ削除）              |
| パンくずナビゲーション | クリックした階層への移動               | -                              | 同一画面（階層移動）                  |
| 書類ダウンロード       | ファイルダウンロード機能               | -                              | ファイルダウンロード                  |

### テーブル表示仕様

| 列名   | 幅   | 内容                   | ソート | 備考                                    |
| ------ | ---- | ---------------------- | ------ | --------------------------------------- |
| 選択   | 固定 | チェックボックス       | -      | 全選択・個別選択・部分選択状態表示      |
| 名前   | 可変 | ファイル・フォルダ名   | ○      | アイコン付き、リンク形式                |
| 更新日 | 固定 | YYYY-MM-DD形式         | ○      | 日本語ロケール                          |
| サイズ | 固定 | ファイルサイズ         | ○      | フォルダは "-" 表示、モバイルでは非表示 |
| 作成者 | 固定 | 作成者名               | -      | モバイルでは非表示                      |
| 操作   | 固定 | ドロップダウンメニュー | -      | 表示・編集・削除・ダウンロード          |

#### アイコン表示

| アイテム種別     | アイコン       | 色       | 備考                         |
| ---------------- | -------------- | -------- | ---------------------------- |
| フォルダ         | Folder         | 青色     | `text-blue-500`              |
| PDFファイル      | FileIcon(pdf)  | 赤色     | ファイル種別に応じたアイコン |
| Wordファイル     | FileIcon(doc)  | 青色     | ファイル種別に応じたアイコン |
| Excelファイル    | FileIcon(xlsx) | 緑色     | ファイル種別に応じたアイコン |
| テキストファイル | FileIcon(txt)  | グレー   | ファイル種別に応じたアイコン |
| HTMLファイル     | FileIcon(html) | オレンジ | ファイル種別に応じたアイコン |

### ファイル種別仕様

現在の実装では以下のファイル種別をサポート：

| ファイル種別 | 拡張子      | アイコン表示   | 備考             |
| ------------ | ----------- | -------------- | ---------------- |
| PDF          | .pdf        | FileIcon(pdf)  | 赤色アイコン     |
| Word文書     | .doc, .docx | FileIcon(doc)  | 青色アイコン     |
| Excel表計算  | .xlsx       | FileIcon(xlsx) | 緑色アイコン     |
| テキスト     | .txt        | FileIcon(txt)  | グレーアイコン   |
| HTML         | .html       | FileIcon(html) | オレンジアイコン |

### 入力チェック

| 項目名               | イベント | チェック内容             | エラーメッセージ                   |
| -------------------- | -------- | ------------------------ | ---------------------------------- |
| 検索バー             | input    | リアルタイム部分一致検索 | 検索結果が見つかりませんでした     |
| フォルダ名（作成）   | input    | 必須入力チェック         | フォルダ名を入力してください       |
| フォルダ名（作成）   | input    | 重複チェック             | 同じ名前のフォルダが既に存在します |
| フォルダ名（編集）   | input    | 必須入力チェック         | フォルダ名を入力してください       |
| フォルダ名（編集）   | input    | 重複チェック             | 同じ名前のフォルダが既に存在します |
| アップロードファイル | change   | ファイル選択チェック     | ファイルを選択してください         |
| アップロードファイル | drop     | ドラッグ&ドロップ対応    | ファイルをドロップしてアップロード |

### バリデーション仕様

#### 検索ロジック

- **部分一致検索**: ファイル名・フォルダ名での部分一致検索を実行
- **大文字小文字無視**: 検索時は大文字小文字を区別しない（toLowerCase使用）
- **リアルタイム検索**: 入力と同時に検索結果を更新
- **空文字処理**: 検索キーワードが空の場合は全件表示

#### 表示制御

- **階層表示**: パンくずナビゲーションによる現在位置表示
- **並び順**: 名前・更新日・サイズによる昇順・降順切り替え
- **フォルダ優先**: ソート時はフォルダが書類より先に表示
- **レスポンシブ**: モバイル・タブレット・デスクトップ対応（非表示列制御）

#### 選択機能

- **全選択**: ヘッダーチェックボックスで一括選択・解除
- **部分選択**: 一部アイテム選択時の中間状態表示
- **選択状態保持**: 検索・ソート時の選択状態維持
- **削除確認**: 選択アイテム削除時の確認ダイアログ表示

#### エラーハンドリング

- 検索結果0件時の適切なメッセージ表示
- 空フォルダ時の案内メッセージ表示
- フォルダ操作エラー時のトースト通知
- ファイルアップロード失敗時のエラー表示
- ローディング状態の表示

## UI/UX仕様

### レスポンシブデザイン

- **テーブル表示**: 全幅表示（デスクトップ）→ 横スクロール対応（モバイル）
- **テーブル列**: サイズ・作成者列はモバイルでは非表示（`hidden md:table-cell`）
- **アクションボタン**: 横並び（デスクトップ）→ 縦積み（モバイル）
- **検索・ソート**: テーブル上部に配置、レスポンシブ対応

### カラーテーマ

- **アクションボタン**:
  - 新規書類・新規フォルダ: `bg-carebase-blue hover:bg-carebase-blue-dark text-white`
  - ファイルアップロード: `variant="outline" border-carebase-blue text-carebase-blue hover:bg-carebase-blue-light`
  - 選択アイテム削除: `variant="outline"` 選択時は `border-red-300 text-red-600 hover:bg-red-50`
- **テーブル行ホバー**: `hover:bg-gray-50 transition-colors`
- **背景色**: `bg-carebase-bg min-h-screen`

### インタラクション

- **ソートヘッダー**: クリックでソート方向切り替え、アイコン表示
- **チェックボックス**: 全選択・部分選択状態の視覚的表示
- **リンクホバー**: `hover:text-carebase-blue hover:underline`
- **モーダル**: 背景オーバーレイ、スムーズな表示・非表示

### アクセシビリティ

- **キーボードナビゲーション**: Tab キー・矢印キーでの操作対応
- **スクリーンリーダー**: 適切な aria-label・role 設定
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスインジケーター

## 技術仕様

### 使用コンポーネント

#### 1_atoms層

- **FileIcon**: ファイル種別アイコン表示（PDF、Word、Excel、テキスト、HTML）

#### 2_molecules層

- **FolderBreadcrumb**: パンくずナビゲーション

#### 3_organisms層

- **FolderContentsView**: フォルダ内容表示テーブル（検索・ソート・選択機能付き）

#### モーダル

- **FileUploadModal**: ファイルアップロードモーダル
- **FolderCreateModal**: フォルダ作成モーダル
- **FolderEditModal**: フォルダ編集モーダル
- **FolderDeleteModal**: フォルダ削除モーダル
- **GenericDeleteModal**: 一括削除確認モーダル

#### UI コンポーネント

- **Button**: アクションボタン
- **Checkbox**: 選択チェックボックス
- **Input**: 検索入力フィールド
- **Select**: ソート選択ドロップダウン
- **Table**: データ表示テーブル
- **DropdownMenu**: アイテム操作メニュー

### データ型定義

```typescript
// 基底インターフェース
interface DocumentBase {
  id: string;
  name: string;
  createdAt: string;
  updatedAt: string;
  createdBy: string;
}

// フォルダ型
interface Folder extends DocumentBase {
  type: 'folder';
  parentId: string | null; // null は最上位フォルダを示す
  path: string[]; // フォルダパス（IDの配列）
}

// 書類型
interface Document extends DocumentBase {
  type: 'document';
  size: string; // "1.2 MB" 形式
  fileType: 'pdf' | 'doc' | 'xlsx' | 'txt' | 'html';
  category: string; // フォルダのカテゴリ名
  description?: string;
  tags?: string[];
  status: 'draft' | 'published' | 'archived';
}

// ユニオン型
type DocumentItem = Folder | Document;

// パンくずナビゲーション
interface BreadcrumbItem {
  id: string;
  name: string;
  path: string;
}

// パンくずパスアイテム
interface BreadcrumbPathItem {
  id: string;
  name: string;
  path: string;
}
```

### データ取得・操作

現在はモック関数を使用して実装：

| 機能               | 使用関数                     | 説明                       |
| ------------------ | ---------------------------- | -------------------------- |
| フォルダ内容取得   | `getFolderContents(id)`      | 指定フォルダの内容を取得   |
| フォルダ情報取得   | `getFolder(id)`              | フォルダ詳細情報を取得     |
| フォルダパス取得   | `getFolderPath(id)`          | パンくず用フォルダパス取得 |
| 既存フォルダ名取得 | `getExistingFolderNames()`   | 重複チェック用フォルダ名   |
| フォルダ作成       | `createFolder(name, parent)` | 新規フォルダ作成           |
| フォルダ更新       | `updateFolder(id, name)`     | フォルダ名変更             |
| フォルダ削除       | `deleteFolder(id)`           | フォルダ削除               |
| カテゴリ取得       | `getCategoryByKey(key)`      | カテゴリ情報取得           |
| カテゴリ書類取得   | `getDocumentsByCategory()`   | カテゴリ別書類一覧取得     |

### 状態管理

- **ローカル状態**:
  - 検索クエリ（FolderContentsView内）
  - ソート条件（名前・更新日・サイズ、昇順・降順）
  - 選択アイテムリスト
  - 現在のフォルダ・カテゴリ情報
  - モーダル開閉状態
- **URL同期**: `category` または `folder` パラメータでナビゲーション管理
- **リアルタイム更新**: 操作後の即座状態反映
- **エラー処理**: トースト通知による操作結果フィードバック

## 画面遷移仕様

### 遷移先URL一覧

| 遷移元           | 遷移先             | URL                                 | パラメータ                   |
| ---------------- | ------------------ | ----------------------------------- | ---------------------------- |
| 新規書類ボタン   | 書類作成画面       | `/documents/edit`                   | なし                         |
| フォルダクリック | フォルダ内表示     | `/documents?folder={folderId}`      | folderId: フォルダID         |
| 書類クリック     | 書類表示画面       | `/documents/view/{documentId}`      | documentId: 書類ID           |
| パンくずクリック | 指定階層表示       | `/documents?folder={folderId}`      | folderId: フォルダID（任意） |
| カテゴリ表示     | カテゴリ別書類表示 | `/documents?category={categoryKey}` | categoryKey: カテゴリキー    |

### URLパラメータ仕様

#### 書類一覧画面

```url
/documents?folder={フォルダID}
/documents?category={カテゴリキー}
/documents（ルート表示）
```

**パラメータ詳細:**

- `folder`: フォルダID（文字列、任意、フォルダ内表示時に使用）
- `category`: カテゴリキー（文字列、任意、カテゴリ別表示時に使用）
- パラメータなし: ルートフォルダ表示

**使用例:**

- `/documents` - ルートフォルダ表示
- `/documents?folder=folder-1` - 議事録フォルダ表示
- `/documents?category=minutes` - 議事録カテゴリ表示

#### 書類表示画面

```url
/documents/view/{documentId}
```

**パラメータ詳細:**

- `documentId`: 書類ID（文字列、必須）

#### 書類作成画面

```url
/documents/edit
/documents/edit/[[...id]]
```

**パラメータ詳細:**

- `id`: 書類ID（配列、任意、編集時に使用）

## 参考資料

- [書類一覧画面実装](./page.tsx)
- [FolderContentsView コンポーネント](../../../components/3_organisms/documents/folder-contents-view.tsx)
- [FolderBreadcrumb コンポーネント](../../../components/2_molecules/documents/folder-breadcrumb.tsx)
- [FileIcon コンポーネント](../../../components/1_atoms/documents/file-icon.tsx)
- [Document Types](../../../types/document.ts)
- [階層的書類管理モック](../../../mocks/hierarchical-documents.ts)
- [書類カテゴリモック](../../../mocks/documents-data.ts)
- [書類作成画面](./edit/[[...id]]/README.md)
