# 書類一覧画面設計書

画面名: `書類一覧`  
パス: `/documents`  
URL: https://carebase-staff.vercel.app/documents

## 概要

CareBase-staffアプリケーションの書類一覧画面設計書です。  
GoogleDrive風インターフェースによる書類管理機能を提供し、フォルダ作成・書類保存、カテゴリ設定、書類種別管理（議事録・ヒヤリハット・事故報告書・行事企画書・一般的な書類）による効率的な書類管理を実現します。

## 全体レイアウト

### 画面構成

書類管理のメイン画面として以下の要素で構成：

- ページヘッダー（パンくずナビゲーション、統計情報）
- アクションボタン（新規書類作成、新規フォルダ作成、書類アップロード、アイテム削除）
- 表示モード切替（グリッド表示・リスト表示）
- 検索・フィルター機能
- 書類・フォルダ一覧エリア（GoogleDrive風）
- 空状態表示

<img width="1470" height="743" alt="スクリーンショット 2025-07-30 8 48 01" src="https://github.com/user-attachments/assets/de4fb4c5-7973-42f7-adc5-e89a6f477d14" />

### 画面項目

| 項目名                     | コンポーネント       | 必須 | 表示条件         | 初期値               | 備考                                       |
| -------------------------- | -------------------- | ---- | ---------------- | -------------------- | ------------------------------------------ |
| パンくずナビゲーション     | Breadcrumb           | -    | 常時             | 書類一覧             | フォルダ階層に応じて動的更新               |
| 統計情報                   | 情報表示エリア       | -    | 常時             | フォルダ・書類件数   | リアルタイム更新                           |
| 検索バー                   | DocumentSearchBar    | -    | 常時             | 空文字               | ファイル名・フォルダ名・内容で検索         |
| メインメニューボタン       | Button               | -    | 常時             | メインメニュー       | アウトライン、ArrowLeft アイコン           |
| 新規フォルダボタン         | Button               | -    | 常時             | 新規フォルダ作成     | アウトライン、FolderPlus アイコン          |
| 書類アップロードボタン     | Button               | -    | 常時             | 書類アップロード     | 青色スタイル、Upload アイコン              |
| 表示モード切替             | ToggleGroup          | -    | 常時             | グリッド表示         | Grid・List アイコン付きトグル              |
| 書類種別フィルター         | Select               | -    | 常時             | すべて               | 議事録/ヒヤリハット等での絞り込み          |
| カテゴリフィルター         | Select               | -    | 常時             | すべて               | フォルダカテゴリでの絞り込み               |
| 並び順選択                 | Select               | -    | 常時             | 更新日時（新しい順） | 名前/作成日/更新日/サイズでの並び替え      |
| リセットボタン             | Button               | -    | 常時             | リセット             | フィルター条件をクリア                     |
| フォルダ・書類一覧         | DocumentGrid/List    | -    | データあり時     | -                    | グリッド表示・リスト表示切り替え可能       |
| 空状態表示                 | EmptyState           | -    | データなし時     | -                    | FolderOpen アイコン付きメッセージ          |
| フォルダ作成ダイアログ     | CreateFolderDialog   | -    | ボタンクリック時 | -                    | フォルダ名・カテゴリ入力                   |
| 書類アップロードダイアログ | UploadDocumentDialog | -    | ボタンクリック時 | -                    | ファイル選択・書類種別・保存先フォルダ選択 |

## 機能仕様

### アクション

| 項目名             | 処理内容                             | 対象API                          | 遷移先画面                       |
| ------------------ | ------------------------------------ | -------------------------------- | -------------------------------- |
| 検索実行           | ファイル名・フォルダ名・内容で検索   | -                                | 同一画面（結果更新）             |
| 書類種別フィルター | 書類種別による絞り込み               | -                                | 同一画面（結果更新）             |
| カテゴリフィルター | フォルダカテゴリによる絞り込み       | -                                | 同一画面（結果更新）             |
| 並び順変更         | 選択した条件での並び替え             | -                                | 同一画面（結果更新）             |
| フィルターリセット | 全フィルター条件をクリア             | -                                | 同一画面（結果更新）             |
| 表示モード切替     | グリッド表示・リスト表示の切り替え   | -                                | 同一画面（表示モード変更）       |
| メインメニュー戻る | メインメニュー画面への遷移           | -                                | メインメニュー画面 (`/`)         |
| 新規フォルダ作成   | フォルダ作成ダイアログを表示         | `/api/v1/documents/folders`      | 同一画面（フォルダ追加）         |
| 書類アップロード   | 書類アップロードダイアログを表示     | `/api/v1/documents`              | 同一画面（書類追加）             |
| フォルダオープン   | 選択したフォルダ内の表示             | -                                | 同一画面（階層移動）             |
| 書類詳細表示       | 選択した書類の詳細画面への遷移       | -                                | 書類詳細画面 (`/documents/{id}`) |
| フォルダ名変更     | フォルダ名の編集                     | `/api/v1/documents/folders/{id}` | 同一画面（フォルダ名更新）       |
| フォルダ削除       | フォルダの削除（確認ダイアログ付き） | `/api/v1/documents/folders/{id}` | 同一画面（フォルダ削除）         |
| 書類削除           | 書類の削除（確認ダイアログ付き）     | `/api/v1/documents/{id}`         | 同一画面（書類削除）             |
| 書類移動           | ドラッグ&ドロップによる書類移動      | `/api/v1/documents/{id}/move`    | 同一画面（書類移動）             |

### グリッド表示仕様

| 要素名         | サイズ    | 内容                         | 表示情報                                         | 備考                            |
| -------------- | --------- | ---------------------------- | ------------------------------------------------ | ------------------------------- |
| フォルダカード | 200×150px | フォルダアイコン＋フォルダ名 | フォルダ名、カテゴリバッジ、書類件数、更新日時   | Folder アイコン、カテゴリ色分け |
| 書類カード     | 200×150px | 書類アイコン＋書類名         | 書類名、書類種別バッジ、ファイルサイズ、更新日時 | 種別に応じたアイコン表示        |
| カード間余白   | 16px      | -                            | -                                                | レスポンシブ対応                |
| ホバー効果     | -         | 背景色変更、影追加           | -                                                | `hover:shadow-md transition`    |

### リスト表示仕様

| 列名     | 幅   | 内容                     | ソート | 備考                         |
| -------- | ---- | ------------------------ | ------ | ---------------------------- |
| 名前     | 可変 | ファイル・フォルダ名     | ○      | アイコン付き、フォルダは太字 |
| 種別     | 固定 | 書類種別・カテゴリバッジ | ○      | 色分けバッジ表示             |
| サイズ   | 固定 | ファイルサイズ           | ○      | フォルダは書類件数表示       |
| 更新日時 | 固定 | MM/dd HH:mm形式          | ○      | 日本語ロケール               |
| 作成者   | 固定 | 作成者名                 | ○      | User アイコン付き            |
| 操作     | 固定 | 詳細・編集・削除ボタン   | -      | ドロップダウンメニュー形式   |

### 書類種別仕様

| 種別名       | 英語名          | アイコン      | バッジ色                                          | 備考                 |
| ------------ | --------------- | ------------- | ------------------------------------------------- | -------------------- |
| 議事録       | meeting-minutes | FileText      | `bg-blue-100 text-blue-700 border-blue-200`       | 会議記録関連書類     |
| ヒヤリハット | near-miss       | AlertTriangle | `bg-yellow-100 text-yellow-700 border-yellow-200` | インシデント報告書類 |
| 事故報告書   | accident-report | AlertCircle   | `bg-red-100 text-red-700 border-red-200`          | 事故関連報告書類     |
| 行事企画書   | event-planning  | Calendar      | `bg-green-100 text-green-700 border-green-200`    | イベント企画関連書類 |
| 一般的な書類 | general         | File          | `bg-gray-100 text-gray-700 border-gray-200`       | その他一般書類       |

### フォルダカテゴリ仕様

| カテゴリ名     | 英語名     | 色                                                | 備考                 |
| -------------- | ---------- | ------------------------------------------------- | -------------------- |
| 重要書類       | important  | `bg-red-100 text-red-700 border-red-200`          | 法定書類・重要文書   |
| 日常業務       | daily-work | `bg-blue-100 text-blue-700 border-blue-200`       | 日常業務関連書類     |
| 会議資料       | meeting    | `bg-green-100 text-green-700 border-green-200`    | 会議・打ち合わせ資料 |
| 研修資料       | training   | `bg-purple-100 text-purple-700 border-purple-200` | 研修・教育関連資料   |
| 行事・イベント | events     | `bg-orange-100 text-orange-700 border-orange-200` | 行事・イベント関連   |
| アーカイブ     | archive    | `bg-gray-100 text-gray-700 border-gray-200`       | 過去の書類・保管文書 |

### 入力チェック

| 項目名               | イベント | チェック内容                   | エラーメッセージ                              |
| -------------------- | -------- | ------------------------------ | --------------------------------------------- |
| 検索バー             | input    | 文字数制限（100文字以内）      | 検索キーワードは100文字以内で入力してください |
| フォルダ名           | input    | 文字数制限（50文字以内）       | フォルダ名は50文字以内で入力してください      |
| フォルダ名           | input    | 禁止文字チェック               | 使用できない文字が含まれています              |
| フォルダ名           | input    | 重複チェック                   | 同じ名前のフォルダが既に存在します            |
| アップロードファイル | change   | ファイルサイズ制限（50MB以内） | ファイルサイズは50MB以内にしてください        |
| アップロードファイル | change   | ファイル形式制限               | サポートされていないファイル形式です          |

### バリデーション仕様

#### 検索ロジック

- **部分一致検索**: ファイル名・フォルダ名・書類内容で部分一致検索を実行
- **大文字小文字無視**: 検索時は大文字小文字を区別しない
- **リアルタイム検索**: 入力と同時に検索結果を更新
- **空文字処理**: 検索キーワードが空の場合は全件表示

#### 表示制御

- **階層表示**: パンくずナビゲーションによる現在位置表示
- **並び順**: 名前・作成日・更新日・サイズによる昇順・降順切り替え
- **フィルター組み合わせ**: 複数フィルター条件のAND検索
- **レスポンシブ**: モバイル・タブレット・デスクトップ対応

#### ドラッグ&ドロップ

- **書類移動**: 書類をフォルダ間でドラッグ&ドロップ移動
- **ファイルアップロード**: デスクトップからのファイルドロップでアップロード
- **視覚的フィードバック**: ドロップゾーンのハイライト表示
- **操作制限**: 権限に応じた操作可否制御

#### エラーハンドリング

- 検索結果0件時の適切なメッセージ表示
- API通信エラー時のフォールバック表示
- ファイルアップロード失敗時のエラー表示
- 権限不足時の操作制限表示

## UI/UX仕様

### レスポンシブデザイン

- **グリッド表示**: 1列（モバイル）→ 2列（タブレット）→ 5列（デスクトップ）
- **リスト表示**: 横スクロール対応（モバイル）→ 固定幅表示（デスクトップ）
- **アクションボタン**: 縦積み（モバイル）→ 横並び（タブレット以上）
- **検索・フィルター**: 縦積み（モバイル）→ 横並び（デスクトップ）

### カラーテーマ

- **書類種別バッジ**: 上記「書類種別仕様」参照
- **フォルダカテゴリ**: 上記「フォルダカテゴリ仕様」参照
- **アクションボタン**:
  - 新規フォルダ: `bg-gray-100 hover:bg-gray-200 text-gray-700`
  - 書類アップロード: `bg-carebase-blue hover:bg-carebase-blue-dark text-white`
- **カード・行ホバー**: `hover:bg-gray-50 transition-colors`

### アニメーション

- **カードホバー**: `hover:shadow-md hover:scale-105 transition-all duration-200`
- **ドラッグ&ドロップ**: スムーズな移動アニメーション
- **フォルダ展開**: フェードイン・アウト効果
- **検索結果更新**: 検索結果のフェードイン表示

### アクセシビリティ

- **キーボードナビゲーション**: Tab キー・矢印キーでの操作対応
- **スクリーンリーダー**: 適切な aria-label・role 設定
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスインジケーター

## 技術仕様

### 使用コンポーネント

#### 1_atoms層

- **DocumentTypeIcon**: 書類種別アイコン表示
- **DocumentTypeBadge**: 書類種別バッジ表示
- **FolderCategoryBadge**: フォルダカテゴリバッジ表示

#### 2_molecules層

- **DocumentSearchBar**: 検索バー
- **DocumentFilters**: フィルター機能
- **DocumentCard**: 書類・フォルダカード（グリッド表示用）
- **DocumentListRow**: 書類・フォルダ行（リスト表示用）
- **CreateFolderDialog**: フォルダ作成ダイアログ
- **UploadDocumentDialog**: 書類アップロードダイアログ

#### 3_organisms層

- **DocumentGrid**: 書類・フォルダグリッド表示
- **DocumentList**: 書類・フォルダリスト表示
- **DocumentBreadcrumb**: パンくずナビゲーション

### データ型定義

```typescript
interface Document {
  id: string;
  name: string;
  type: DocumentType;
  folderId?: string;
  folderPath: string[];
  content?: string;
  fileSize: number;
  mimeType: string;
  url: string;
  createdBy: string;
  createdByName: string;
  createdAt: string;
  updatedAt: string;
}

interface Folder {
  id: string;
  name: string;
  category: FolderCategory;
  parentId?: string;
  path: string[];
  documentCount: number;
  createdBy: string;
  createdByName: string;
  createdAt: string;
  updatedAt: string;
}

type DocumentType =
  | 'meeting-minutes'
  | 'near-miss'
  | 'accident-report'
  | 'event-planning'
  | 'general';

type FolderCategory = 'important' | 'daily-work' | 'meeting' | 'training' | 'events' | 'archive';
```

### API エンドポイント

| メソッド | エンドポイント                   | 説明             |
| -------- | -------------------------------- | ---------------- |
| GET      | `/api/v1/documents`              | 書類一覧取得     |
| GET      | `/api/v1/documents/{id}`         | 書類詳細取得     |
| POST     | `/api/v1/documents`              | 書類アップロード |
| PUT      | `/api/v1/documents/{id}`         | 書類更新         |
| DELETE   | `/api/v1/documents/{id}`         | 書類削除         |
| POST     | `/api/v1/documents/{id}/move`    | 書類移動         |
| GET      | `/api/v1/documents/folders`      | フォルダ一覧取得 |
| GET      | `/api/v1/documents/folders/{id}` | フォルダ詳細取得 |
| POST     | `/api/v1/documents/folders`      | フォルダ作成     |
| PUT      | `/api/v1/documents/folders/{id}` | フォルダ更新     |
| DELETE   | `/api/v1/documents/folders/{id}` | フォルダ削除     |

### 状態管理

- **ローカル状態**: 検索クエリ、フィルター条件、表示モード、現在のフォルダパス
- **URL同期**: 検索・フィルター条件・フォルダパスをURLパラメータで管理
- **楽観的更新**: ファイル操作時の即座UI反映
- **エラー処理**: API通信エラー時のフォールバック

## ワイヤーフレーム（テキストベース）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ [← メインメニュー]  📁 書類一覧 > フォルダA            [📁+ 新規フォルダ] [📤 アップロード] │
├─────────────────────────────────────────────────────────────────────────────┤
│ フォルダ: 5個 | 書類: 12個                                        [🔍 書類を検索...] │
├─────────────────────────────────────────────────────────────────────────────┤
│ [書類種別▼] [カテゴリ▼] [並び順: 更新日時（新しい順）▼]  [🔄 リセット] [⚏ グリッド] [☰ リスト] │
├─────────────────────────────────────────────────────────────────────────────┤
│ ┌──────────────── グリッド表示エリア ─────────────────────────────────────┐ │
│ │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                               │ │
│ │ │📁   │ │📄   │ │📄   │ │📁   │ │📄   │                               │ │
│ │ │重要書│ │議事録│ │事故報│ │会議資│ │ヒヤリ│                               │ │
│ │ │類   │ │     │ │告書  │ │料   │ │ハット│                               │ │
│ │ │5件  │ │2.3MB│ │1.8MB│ │8件  │ │890KB│                               │ │
│ │ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘                               │ │
│ │                                                                         │ │
│ │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                               │ │
│ │ │📄   │ │📄   │ │📁   │ │📄   │ │📄   │                               │ │
│ │ │行事企│ │一般書│ │アーカ│ │研修資│ │議事録│                               │ │
│ │ │画書  │ │類   │ │イブ │ │料   │ │     │                               │ │
│ │ │3.2MB│ │1.1MB│ │15件 │ │4.5MB│ │2.1MB│                               │ │
│ │ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘                               │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 画面遷移仕様

### 遷移先URL一覧

| 遷移元               | 遷移先               | URL                               | パラメータ                   |
| -------------------- | -------------------- | --------------------------------- | ---------------------------- |
| メインメニューボタン | メインメニュー画面   | `/`                               | なし                         |
| フォルダクリック     | フォルダ内表示       | `/documents?folder={folderId}`    | folderId: フォルダID         |
| 書類クリック         | 書類詳細画面         | `/documents/{documentId}`         | documentId: 書類ID           |
| 書類ダウンロード     | ファイルダウンロード | `/api/v1/documents/{id}/download` | documentId: 書類ID           |
| パンくずクリック     | 指定階層表示         | `/documents?folder={folderId}`    | folderId: フォルダID（任意） |

### URLパラメータ仕様

#### 書類一覧画面

```
/documents?folder={フォルダID}&query={検索キーワード}&type={書類種別}&category={カテゴリ}&sort={並び順}&view={表示モード}
```

**パラメータ詳細:**

- `folder`: フォルダID（文字列、任意、ルートの場合は未指定）
- `query`: 検索キーワード（文字列、任意）
- `type`: 書類種別（meeting-minutes|near-miss|accident-report|event-planning|general、任意）
- `category`: フォルダカテゴリ（important|daily-work|meeting|training|events|archive、任意）
- `sort`: 並び順（name-asc|name-desc|created-asc|created-desc|updated-asc|updated-desc|size-asc|size-desc、デフォルト: updated-desc）
- `view`: 表示モード（grid|list、デフォルト: grid）

#### 書類詳細画面

```
/documents/{documentId}
```

**パラメータ詳細:**

- `documentId`: 書類ID（文字列、必須）

## 参考資料

- [書類一覧画面実装](./page.tsx)
- [DocumentGrid コンポーネント](../../../components/3_organisms/document/document-grid.tsx)
- [DocumentList コンポーネント](../../../components/3_organisms/document/document-list.tsx)
- [Document Types](../../../types/document.ts)
- [FlutterFlow 参考画面](https://carebase.flutterflow.app/docMeetingFolders)
- [画面一覧](../../../docs/screen-list.md#書類管理)
