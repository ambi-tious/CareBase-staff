# 通知一覧画面設計書

- 画面名: `通知一覧`
- パス: `/notifications`
- URL: https://carebase-staff.vercel.app/notifications

## 概要

通知一覧画面設計書です。
連絡予定等で通知が届いた場合に表示する通知管理機能を提供します。
Backlogのお知らせインターフェースを参考とした、直感的で使いやすい通知表示・管理システムです。
未読・既読状態の管理、通知の詳細確認、一括操作機能などを含む包括的な通知管理を実現します。

## 全体レイアウト

### 画面構成

![通知一覧画面](https://github.com/user-attachments/assets/0e9c949d-f3d5-449f-be11-d6a3d1a26709)

Backlogお知らせ風インターフェースとして以下の要素で構成：

- ページヘッダー（通知統計情報、フィルター機能）
- 通知リスト表示エリア（リスト形式）
- 通知管理操作バー（一括操作、既読/未読切り替え）
- 通知詳細表示エリア（選択時）

### 画面項目

| 項目名                 | コンポーネント        | 必須 | 表示条件       | 初期値         | 備考                                 |
| ---------------------- | --------------------- | ---- | -------------- | -------------- | ------------------------------------ |
| 未読通知件数           | Badge                 | -    | 常時           | 未読通知数     | 赤色バッジ、0件時は非表示            |
| 全通知件数             | Text                  | -    | 常時           | 全通知数       | グレー色テキスト                     |
| フィルタードロップダウン | Select               | -    | 常時           | 全て           | 全て/未読のみ/既読のみ               |
| 並び順ドロップダウン   | Select                | -    | 常時           | 新しい順       | 新しい順/古い順                      |
| 一括選択チェックボックス | Checkbox             | -    | 通知あり時     | false          | 全選択/全解除                        |
| 一括既読ボタン         | Button                | -    | 選択項目あり時 | 既読にする     | アウトライン、選択項目に対して実行   |
| 一括削除ボタン         | Button                | -    | 選択項目あり時 | 削除           | 危険色、確認ダイアログ表示           |
| 通知アイテム           | NotificationItem      | -    | 通知あり時     | -              | リスト形式、アバター・内容・時刻表示 |
| 通知アバター           | Avatar                | -    | 常時           | -              | 48x48px、ユーザー画像またはアイコン  |
| 通知タイトル           | Heading               | ◯    | 常時           | -              | 太字、未読時はより強調               |
| 通知内容               | Text                  | ◯    | 常時           | -              | 改行対応、リンク検出                 |
| 通知時刻               | Time                  | ◯    | 常時           | -              | 相対時間表示（○分前、○時間前等）    |
| 未読インジケーター     | Indicator             | -    | 未読時         | -              | 青色丸印、左端に表示                 |
| 通知タイプバッジ       | Badge                 | -    | タイプあり時   | -              | 連絡予定/システム/重要等             |
| 空状態表示             | EmptyState            | -    | 通知なし時     | -              | Bell アイコン付きメッセージ          |
| ローディング表示       | LoadingSpinner        | -    | データ取得中   | -              | スケルトンローディング               |

## 機能仕様

### アクション

| 項目名           | 処理内容                       | 対象API                           | 遷移先画面                     |
| ---------------- | ------------------------------ | --------------------------------- | ------------------------------ |
| 通知一覧取得     | 通知リストの取得・表示         | `/api/v1/notifications`           | 同一画面（初期表示）           |
| フィルター適用   | 未読/既読状態でのフィルタリング | `/api/v1/notifications?status=`   | 同一画面（リスト更新）         |
| 並び順変更       | 時系列順序の変更               | `/api/v1/notifications?order=`    | 同一画面（リスト更新）         |
| 通知クリック     | 通知詳細の表示                 | -                                 | 通知詳細モーダル               |
| 単体既読化       | 個別通知の既読状態変更         | `PUT /api/v1/notifications/[id]`  | 同一画面（状態更新）           |
| 一括選択         | 複数通知の選択・選択解除       | -                                 | 同一画面（選択状態更新）       |
| 一括既読化       | 選択通知の既読状態一括変更     | `PUT /api/v1/notifications/bulk`  | 同一画面（状態一括更新）       |
| 一括削除         | 選択通知の一括削除             | `DELETE /api/v1/notifications/bulk` | 同一画面（削除後リスト更新）   |
| 関連ページ遷移   | 通知に関連するページへの遷移   | -                                 | 連絡予定詳細等の関連画面       |
| リアルタイム更新 | 新着通知の自動表示             | WebSocket接続                     | 同一画面（リアルタイム更新）   |

### 入力チェック

| 項目名       | イベント | チェック内容           | エラーメッセージ                     |
| ------------ | -------- | ---------------------- | ------------------------------------ |
| 一括操作     | click    | 選択項目チェック       | 操作する通知を選択してください       |
| 一括削除     | click    | 削除確認               | 選択した通知を削除してもよろしいですか |
| 通知取得     | load     | API接続チェック        | 通知の取得に失敗しました             |
| リアルタイム | connect  | WebSocket接続チェック  | リアルタイム更新に失敗しました       |

### バリデーション仕様

#### 通知表示ロジック

- **時系列表示**: デフォルトで新しい通知を上位表示
- **未読優先**: 未読通知を既読通知より上位に表示（同一時系列内）
- **グループ化**: 同一日の通知を日付ヘッダーでグループ分け
- **ページネーション**: 一度に表示する通知数を50件に制限
- **自動読み込み**: スクロール下端到達時の追加読み込み

#### 状態管理

- **未読状態**: 通知受信時は未読状態で表示
- **既読状態**: クリック時または明示的操作で既読に変更
- **削除状態**: 論理削除（データベース上は残存、表示から除外）
- **選択状態**: 一括操作のための一時的な選択状態管理

#### エラーハンドリング

- **取得エラー**: API通信エラー時のリトライ機能
- **更新エラー**: 状態更新失敗時の元状態復元
- **接続エラー**: リアルタイム接続断絶時の再接続処理
- **権限エラー**: 操作権限不足時の適切なメッセージ表示

## UI/UX仕様

### レスポンシブデザイン

- **モバイル（〜768px）**:
  - 通知リストを1列表示
  - 操作ボタンを縦積み配置
  - アバターサイズを32pxに縮小
  - スワイプジェスチャーで既読/削除操作対応
- **タブレット（768px〜1024px）**:
  - 通知リストを1列表示（幅拡張）
  - 操作ボタンを横並び配置
  - アバターサイズを40px
  - タップ操作の最適化
- **デスクトップ（1024px〜）**:
  - 通知リストとサイドバー（詳細表示）の2ペイン表示
  - ホバー効果の活用
  - アバターサイズを48px
  - キーボードショートカット対応

### カラーテーマ

- **未読通知**:
  - 背景: `bg-blue-50`
  - インジケーター: `bg-blue-500`
  - タイトル: `text-carebase-text-primary font-semibold`
- **既読通知**:
  - 背景: `bg-white`
  - タイトル: `text-carebase-text-secondary font-normal`
- **選択状態**:
  - 背景: `bg-carebase-blue-light`
  - 境界線: `border-carebase-blue`
- **通知タイプバッジ**:
  - 重要: `bg-red-100 text-red-800 border-red-200`
  - 連絡予定: `bg-blue-100 text-blue-800 border-blue-200`
  - システム: `bg-gray-100 text-gray-800 border-gray-200`
- **アクションボタン**:
  - 既読化: `bg-carebase-blue hover:bg-carebase-blue-dark`
  - 削除: `bg-red-500 hover:bg-red-600 text-white`

### アニメーション

- **通知リスト**: `transition-all duration-200 ease-in-out`
- **未読→既読**: フェードアウト効果で状態変化を表現
- **新着通知**: 上部からスライドイン効果
- **削除アニメーション**: 左へスライドアウト後、上に詰める
- **ローディング**: スケルトンローディングでコンテンツ形状を保持
- **ホバー効果**: `hover:bg-gray-50 hover:shadow-sm`

### アクセシビリティ

- **キーボードナビゲーション**:
  - Tab キーでの順次移動対応
  - Enter/Space キーでの選択・実行対応
  - 矢印キーでのリスト内移動対応
- **スクリーンリーダー**:
  - 通知の重要度・状態を音声で伝達
  - 適切な aria-label, aria-describedby 設定
  - 既読/未読状態の明確な音声案内
- **視覚的配慮**:
  - WCAG 2.1 AA レベルのコントラスト比確保
  - 色覚特性に配慮した色彩設計
  - 明確なフォーカスインジケーター表示
- **操作性**:
  - 最小タップエリア44px×44px確保
  - 誤タップ防止のための十分な間隔
  - 確認ダイアログによる誤操作防止

## 参考資料

- [Issue #59: [設計] #042 その他｜通知一覧](https://github.com/ambi-tious/CareBase-staff/issues/59)
- [Backlog お知らせ機能参考画像](https://github.com/user-attachments/assets/0e9c949d-f3d5-449f-be11-d6a3d1a26709)
- [画面一覧](../../../docs/screen-list.md#その他機能)
- [連絡予定一覧画面設計書](../contact-schedule/README.md)
- [利用者一覧画面設計書](../residents/README.md)
- [通知一覧画面実装](./page.tsx)
- [NotificationsList コンポーネント](../../../components/3_organisms/notifications/notifications-list.tsx)
- [NotificationItem コンポーネント](../../../components/2_molecules/notifications/notification-item.tsx)