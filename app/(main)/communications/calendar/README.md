# 連絡・予定｜カレンダー表示画面設計書

**画面名**: 連絡・予定カレンダー表示画面  
**パス**: `/communications/calendar`  
**URL**: `https://carebase.example.com/communications/calendar`

## 概要

連絡・予定情報をカレンダー形式で表示し、月間・週間表示の切り替え、フィルタリング機能、ブックマーク機能を提供する画面です。申し送り情報と連絡予定を統合的に管理し、スタッフ間の情報共有を効率化します。

### 主要機能
- 月間・週間カレンダー表示の切り替え
- フィルタリング機能（全て、未読、マイリスト、申し送りのみ）
- カンバン形式の週間表示
- カード形式での情報表示（件名、作成日、確認数、コメント、ステータス）
- ブックマーク機能
- ボード・カレンダー表示切り替え
- 申し送り・連絡予定の新規作成

## 全体レイアウト

### 画面構成

```
┌─────────────────────────────────────────────────────────────┐
│ ヘッダー（共通）                                              │
├─────────────────────────────────────────────────────────────┤
│ ツールバー                                                   │
│ [表示切り替え] [フィルター] [検索] [新規作成ボタン]            │
├─────────────────────────────────────────────────────────────┤
│ カレンダー表示エリア                                         │
│                                                             │
│ ┌─ 月間表示 ─────────────────────────────────────────────┐ │
│ │ 日 月 火 水 木 金 土                                    │ │
│ │ ┌─┐┌─┐┌─┐┌─┐┌─┐┌─┐┌─┐                              │ │
│ │ │  ││  ││  ││  ││  ││  ││  │                              │ │
│ │ └─┘└─┘└─┘└─┘└─┘└─┘└─┘                              │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─ 週間表示（カンバン形式） ─────────────────────────────┐ │
│ │ 月曜日    火曜日    水曜日    木曜日    金曜日          │ │
│ │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐          │ │
│ │ │カード│ │カード│ │カード│ │カード│ │カード│          │ │
│ │ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘          │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 画面項目

| 項目名 | 種別 | 必須 | 説明 |
|--------|------|------|------|
| 表示切り替えボタン | ボタン | ○ | 月間・週間表示の切り替え |
| フィルタードロップダウン | セレクト | ○ | 全て/未読/マイリスト/申し送りのみ |
| 検索フィールド | テキスト | - | キーワード検索 |
| 新規作成ボタン | ボタン | ○ | 申し送り・連絡予定の作成 |
| カレンダーグリッド | 表示エリア | ○ | 日付とイベントの表示 |
| イベントカード | カード | ○ | 連絡・予定情報の表示 |
| ブックマークボタン | ボタン | - | お気に入り登録 |
| ステータス表示 | ラベル | ○ | 未読/既読/対応済み |

## 機能仕様

### アクション

#### 1. 表示切り替え
- **トリガー**: 月間/週間切り替えボタンクリック
- **処理内容**:
  1. 現在の表示モードを切り替え
  2. カレンダーコンポーネントを再描画
  3. 選択状態をローカルストレージに保存
- **API呼び出し**: なし（フロントエンド処理のみ）

#### 2. フィルタリング
- **トリガー**: フィルタードロップダウン選択
- **処理内容**:
  1. 選択されたフィルター条件を適用
  2. 表示データを絞り込み
  3. カレンダー表示を更新
- **API呼び出し**: `GET /api/communications/calendar?filter={filterType}`

#### 3. 検索
- **トリガー**: 検索フィールド入力（デバウンス500ms）
- **処理内容**:
  1. 入力キーワードでデータを検索
  2. 検索結果をカレンダーに反映
- **API呼び出し**: `GET /api/communications/calendar?search={keyword}`

#### 4. 新規作成
- **トリガー**: 新規作成ボタンクリック
- **処理内容**:
  1. 作成タイプ選択モーダル表示
  2. 申し送り作成 → `/handovers/new`へ遷移
  3. 連絡予定作成 → `/communications/new`へ遷移

#### 5. ブックマーク
- **トリガー**: カード内ブックマークボタンクリック
- **処理内容**:
  1. ブックマーク状態を切り替え
  2. サーバーに状態を保存
  3. UI表示を更新
- **API呼び出し**: `POST /api/communications/{id}/bookmark`

#### 6. カード詳細表示
- **トリガー**: イベントカードクリック
- **処理内容**:
  1. 詳細モーダル表示
  2. コメント機能提供
  3. ステータス更新機能提供

### 入力チェック

#### 検索フィールド
- **文字数制限**: 100文字以内
- **使用可能文字**: 全角・半角文字、数字、記号
- **特殊処理**: SQLインジェクション対策

### バリデーション仕様

#### フィルター選択
- **必須チェック**: なし（デフォルト値「全て」）
- **値チェック**: 定義済み値のみ許可（all, unread, my-list, handover-only）

#### 日付範囲
- **範囲チェック**: 過去1年〜未来1年の範囲内
- **形式チェック**: YYYY-MM-DD形式

## UI/UX仕様

### レスポンシブデザイン

#### デスクトップ（1024px以上）
- カレンダーグリッド: 7列表示（週間）
- サイドバー: フィルター・検索パネル表示
- カード: 詳細情報表示

#### タブレット（768px-1023px）
- カレンダーグリッド: 7列表示（縮小）
- サイドバー: 折りたたみ式
- カード: 簡略表示

#### モバイル（767px以下）
- カレンダーグリッド: 縦スクロール表示
- フィルター: ドロワー形式
- カード: リスト形式表示

### カラーテーマ

#### カテゴリ別色分け
- **申し送り**: `bg-blue-100 text-blue-700 border-blue-200`
- **連絡事項**: `bg-green-100 text-green-700 border-green-200`
- **イベント**: `bg-purple-100 text-purple-700 border-purple-200`
- **タスク**: `bg-orange-100 text-orange-700 border-orange-200`

#### ステータス別色分け
- **未読**: `bg-red-100 text-red-700 border-red-200`
- **既読**: `bg-yellow-100 text-yellow-700 border-yellow-200`
- **対応済み**: `bg-green-100 text-green-700 border-green-200`

### アニメーション

#### 表示切り替え
- **トランジション**: `transition-all duration-300 ease-in-out`
- **フェード効果**: カレンダー切り替え時

#### カードホバー
- **エフェクト**: `hover:shadow-md hover:scale-105`
- **トランジション**: `transition-transform duration-200`

### アクセシビリティ

#### キーボード操作
- **Tab**: フォーカス移動
- **Enter/Space**: ボタン実行
- **矢印キー**: カレンダー日付移動
- **Escape**: モーダル閉じる

#### スクリーンリーダー対応
- **aria-label**: 各ボタンに説明追加
- **role**: カレンダーグリッドに適切なrole設定
- **aria-expanded**: ドロップダウンの開閉状態

## 参考資料

### 関連設計書
- [申し送り一覧画面設計書](../../handovers/README.md)
- [連絡登録画面設計書](../new/README.md)
- [連絡編集画面設計書](../edit/[itemId]/README.md)

### 参考コンポーネント
- [Calendar UI Component](../../../../components/ui/calendar.tsx)
- [Handover Form Component](../../../../components/2_molecules/handover/handover-form.tsx)
- [Dashboard Menu](../../../../mocks/dashboard-menu.ts)

### FlutterFlow参考資料
- [カレンダー表示画面](https://github.com/ambi-tious/CareBase-staff/issues/103)
- 月間・週間表示切り替え機能
- フィルタリング・検索機能
- カンバン形式週間表示

### API仕様
- `GET /api/communications/calendar` - カレンダーデータ取得
- `POST /api/communications/{id}/bookmark` - ブックマーク切り替え
- `GET /api/handovers` - 申し送りデータ取得
- `GET /api/communications` - 連絡予定データ取得
