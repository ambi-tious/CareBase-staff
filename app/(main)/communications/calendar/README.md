# 連絡・予定（カレンダー表示）画面設計書

画面名: `連絡・予定（カレンダー表示）`  
パス: `/communications/calendar`  
URL: https://carebase-staff.vercel.app/communications/calendar

## 概要

CareBase-staffアプリケーションの連絡・予定（カレンダー表示）画面設計書です。  
施設全体のお知らせを効率的に管理・表示するカレンダー機能を提供します。  
月間表示と週間表示の2つのカレンダー表示方式を切り替えて使用でき、フィルタリング機能とブックマーク機能を備えています。

## 全体レイアウト

### 画面構成

連絡・予定カレンダー表示のメイン画面として以下の要素で構成：

- ページヘッダー（タイトル、表示切り替えタブ）
- フィルタリング機能（全て・未確認・マイリスト・申し送りのみ）
- 月間・週間表示切り替えボタン
- カレンダー表示エリア（月間表示または週間表示）
- アクションボタン（申し送り作成・連絡予定作成）

### 画面項目

| 項目名                 | コンポーネント     | 必須 | 表示条件     | 初期値       | 備考                                       |
| ---------------------- | ------------------ | ---- | ------------ | ------------ | ------------------------------------------ |
| ページタイトル         | Heading            | -    | 常時         | 申し送り/連絡・予定 | MessageSquare アイコン付き                 |
| ボード・カレンダータブ | TabGroup           | -    | 常時         | カレンダー   | ボード表示とカレンダー表示の切り替え       |
| 月間・週間切り替え     | ButtonGroup        | -    | 常時         | 月間表示     | 月間表示・週間表示の切り替え               |
| フィルターボタン       | FilterButtonGroup  | -    | 常時         | すべて       | 全て・未確認・マイリスト・申し送りのみ     |
| マイリスト詳細         | StatusGroup        | -    | マイリスト時 | -            | 公開終了・下書きの状態表示                 |
| 月選択ナビゲーション   | DateNavigation     | -    | 月間表示時   | 今月         | 前月・翌月ボタン、月表示                   |
| 週選択ナビゲーション   | WeekNavigation     | -    | 週間表示時   | 今週         | 前週・翌週ボタン、週表示                   |
| 月間カレンダー         | MonthCalendar      | -    | 月間選択時   | -            | カレンダーグリッド表示                     |
| 週間カンバン           | WeeklyKanban       | -    | 週間選択時   | -            | 7日分のカンバン式表示                      |
| 申し送り作成ボタン     | Button             | -    | 常時         | 申し送り     | オレンジ色、Plus アイコン付き              |
| 連絡予定作成ボタン     | Button             | -    | 常時         | 連絡・予定   | 青色、Plus アイコン付き                    |

## 機能仕様

### 表示モード

#### 月間表示

- 選択した月のカレンダーグリッド表示
- 各日付セルに予定がある場合はタイトルを表示
- 月の切り替え機能（前月・翌月ボタン）
- 今日の日付をハイライト表示
- 予定のある日は視覚的に区別して表示

#### 週間表示

- 選択した週の7日間をカンバン式で表示
- 日毎の予定をカード形式で表示
- カード内容：
  - タイトル
  - 作成日
  - 確認者数
  - コメント数
  - 確認ステータス
- カード右上にブックマーク機能
- 週の切り替え機能（前週・翌週ボタン）

### フィルタリング機能

| フィルター項目 | 選択肢                     | 説明                               |
| -------------- | -------------------------- | ---------------------------------- |
| 全て           | 全項目表示                 | すべての連絡・予定を表示           |
| 未確認         | 未確認項目のみ             | 未確認の連絡・予定のみ表示         |
| マイリスト     | 公開終了・下書き           | 自分が作成した項目の状態別表示     |
| 申し送りのみ   | 申し送り項目のみ           | 申し送り種別の項目のみ表示         |

### 表示切り替え機能

| 表示タイプ | 説明                         | 主な用途                         |
| ---------- | ---------------------------- | -------------------------------- |
| ボード     | リスト・ボード形式での表示   | 詳細情報の確認・編集             |
| カレンダー | カレンダー形式での表示       | 日程の視覚的確認・スケジュール管理 |

### アクション

| 項目名               | 処理内容                         | 対象API                               | 遷移先画面                           |
| -------------------- | -------------------------------- | ------------------------------------- | ------------------------------------ |
| 表示切り替え         | ボード/カレンダー表示の切り替え  | -                                     | 同一画面（表示モード変更）           |
| 月間・週間切り替え   | 月間/週間表示の切り替え          | -                                     | 同一画面（カレンダー表示変更）       |
| フィルター変更       | 表示項目のフィルタリング         | -                                     | 同一画面（フィルター適用）           |
| 月・週ナビゲーション | 表示期間の変更                   | -                                     | 同一画面（表示データ更新）           |
| カードクリック       | 詳細画面への遷移                 | -                                     | 連絡・予定詳細画面                   |
| ブックマーク操作     | カードのブックマーク状態変更     | `/api/v1/communications/{id}/bookmark` | 同一画面（ブックマーク状態更新）     |
| 申し送り作成         | 申し送り作成画面への遷移         | -                                     | 申し送り作成画面                     |
| 連絡予定作成         | 連絡・予定作成画面への遷移       | -                                     | 連絡・予定作成画面                   |

### データ型定義

```typescript
interface CommunicationItem {
  id: string;
  title: string;
  content: string;
  type: 'communication' | 'schedule' | 'handover';
  priority: 'high' | 'medium' | 'low';
  status: 'draft' | 'published' | 'ended' | 'confirmed';
  isBookmarked: boolean;
  confirmationCount: number;
  commentCount: number;
  assignedTo: string[];
  createdBy: string;
  createdByName: string;
  createdAt: string;
  updatedAt: string;
  publishDate: string;
  endDate?: string;
  targetDate: string;
  tags?: string[];
  relatedResidentId?: string;
  relatedResidentName?: string;
}

interface CalendarViewProps {
  viewMode: 'monthly' | 'weekly';
  displayType: 'board' | 'calendar';
  filterType: 'all' | 'unconfirmed' | 'mylist' | 'handovers';
  selectedDate: Date;
  communications: CommunicationItem[];
}
```

## UI/UX仕様

### レスポンシブデザイン

- **モバイル（〜768px）**:
  - 週間表示は1列縦並び
  - フィルターボタンは縦積み配置
  - カード表示は全幅使用
- **タブレット（768px〜1024px）**:
  - 週間表示は日毎の列を適切に配置
  - フィルターボタンは横並び配置
- **デスクトップ（1024px〜）**:
  - 週間表示は7列の完全なカンバン表示
  - 全機能を横並びで表示

### カラーテーマ

- **種別バッジ**:
  - 連絡事項: `bg-green-100 text-green-700 border-green-200`
  - 予定: `bg-blue-100 text-blue-700 border-blue-200`
  - 申し送り: `bg-purple-100 text-purple-700 border-purple-200`
- **ステータスバッジ**:
  - 下書き: `bg-gray-100 text-gray-700 border-gray-200`
  - 公開中: `bg-green-100 text-green-700 border-green-200`
  - 公開終了: `bg-red-100 text-red-700 border-red-200`
  - 確認済み: `bg-blue-100 text-blue-700 border-blue-200`
- **アクションボタン**:
  - 申し送り作成: `bg-orange-500 hover:bg-orange-600`
  - 連絡予定作成: `bg-blue-500 hover:bg-blue-600`

### ブックマーク機能

- **表示**: カード右上にブックマークアイコン（星マーク）
- **状態**: ブックマーク済み（塗りつぶし）/ 未ブックマーク（アウトライン）
- **操作**: クリックで即座に状態切り替え
- **フィードバック**: 状態変更時のアニメーション効果

### アニメーション

- **カード表示**: `hover:shadow-md transition-shadow`
- **表示切り替え**: スムーズなトランジション
- **ブックマーク**: クリック時の拡縮アニメーション
- **ナビゲーション**: ページ切り替え時のフェード効果

### アクセシビリティ

- **キーボードナビゲーション**: Tab キーでの操作対応
- **スクリーンリーダー**: 適切な aria-label 設定
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスインジケーター

## 技術仕様

### 使用コンポーネント

#### 3_organisms層

- **CommunicationsCalendarView**: メイン画面コンポーネント
- **MonthlyCalendarGrid**: 月間カレンダー表示コンポーネント
- **WeeklyKanbanBoard**: 週間カンバン表示コンポーネント

#### 2_molecules層

- **CalendarDateNavigation**: 日付ナビゲーションコンポーネント
- **CommunicationCard**: 連絡・予定カードコンポーネント
- **FilterButtonGroup**: フィルターボタングループ
- **BookmarkButton**: ブックマークボタンコンポーネント

#### 1_atoms層

- **Badge**: 種別・ステータス表示
- **Button**: アクションボタン
- **Card**: カード表示
- **TabGroup**: タブ切り替え
- **DatePicker**: 日付選択

### 状態管理

- **表示モード**: 月間/週間の切り替え状態
- **表示タイプ**: ボード/カレンダーの切り替え状態
- **フィルター**: フィルター条件の状態
- **選択日付**: カレンダー表示での選択日付
- **ブックマーク**: ブックマーク状態の管理
- **データ**: 連絡・予定データの管理

### API エンドポイント

| メソッド | エンドポイント                            | 説明                     |
| -------- | ----------------------------------------- | ------------------------ |
| GET      | `/api/v1/communications`                  | 連絡・予定一覧取得       |
| GET      | `/api/v1/communications/calendar`         | カレンダー表示用データ取得 |
| POST     | `/api/v1/communications/{id}/bookmark`    | ブックマーク追加         |
| DELETE   | `/api/v1/communications/{id}/bookmark`    | ブックマーク解除         |
| GET      | `/api/v1/communications/filter`           | フィルター適用データ取得 |

### モックデータ

- `mocks/communications-data.ts` にサンプルデータを定義
- 種別、ステータス、ブックマーク状態別のデータを含む
- カレンダー表示・フィルター機能のヘルパー関数を提供

## 画面レイアウト詳細

### 月間表示レイアウト

```
┌─────────────────────────────────────────────────────────────┐
│ 申し送り/連絡・予定              [ボード] [月間表示] [週間表示] │
├─────────────────────────────────────────────────────────────┤
│ [すべて] [未確認] [マイリスト] [申し送りのみ]                   │
├─────────────────────────────────────────────────────────────┤
│                    [<] 2025年07月 [>]                        │
├─────────────────────────────────────────────────────────────┤
│  日    月    火    水    木    金    土                        │
│ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐               │
│ │ 6 │ │ 7 │ │ 8 │ │ 9 │ │10 │ │11 │ │12 │               │
│ └───┘ └───┘ └───┘ └───┘ └───┘ └───┘ └───┘               │
│ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐               │
│ │13 │ │14 │ │15 │ │16 │ │17 │ │18 │ │19 │               │
│ │   │ │設定│ │   │ │   │ │   │ │   │ │   │               │
│ │   │ │なし│ │   │ │   │ │   │ │   │ │   │               │
│ └───┘ └───┘ └───┘ └───┘ └───┘ └───┘ └───┘               │
├─────────────────────────────────────────────────────────────┤
│                [+ 申し送り] [+ 連絡・予定]                     │
└─────────────────────────────────────────────────────────────┘
```

### 週間表示レイアウト

```
┌─────────────────────────────────────────────────────────────┐
│ 申し送り/連絡・予定              [ボード] [月間表示] [週間表示] │
├─────────────────────────────────────────────────────────────┤
│ [すべて] [未確認] [マイリスト] [申し送りのみ]                   │
├─────────────────────────────────────────────────────────────┤
│                    [<] 2025年07月第2週 [>]                   │
├─────────────────────────────────────────────────────────────┤
│  日    月    火    水    木    金    土                        │
│ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐               │
│ │ 6 │ │ 7 │ │ 8 │ │ 9 │ │10 │ │11 │ │12 │               │
│ │   │ │   │ │   │ │   │ │   │ │   │ │   │               │
│ │   │ │ ┌─┐│ │   │ │   │ │   │ │   │ │   │               │
│ │   │ │ │ ││ │   │ │   │ │   │ │   │ │   │               │
│ │   │ │ │⭐││ │   │ │   │ │   │ │   │ │   │               │
│ │   │ │ │ ││ │   │ │   │ │   │ │   │ │   │               │
│ │   │ │ └─┘│ │   │ │   │ │   │ │   │ │   │               │
│ └───┘ └───┘ └───┘ └───┘ └───┘ └───┘ └───┘               │
├─────────────────────────────────────────────────────────────┤
│                [+ 申し送り] [+ 連絡・予定]                     │
└─────────────────────────────────────────────────────────────┘
```

## 参考資料

### FlutterFlow参考画面

- **月間表示**: https://carebase.flutterflow.app/Information_calendar
- **週間表示**: https://carebase.flutterflow.app/Information_calendarWeek

### 関連ファイル

- [連絡・予定画面実装](../../../contact-schedule/page.tsx)
- [ContactScheduleCalendarView コンポーネント](../../../../components/3_organisms/contact-schedule/contact-schedule-calendar-view.tsx)
- [Calendar UI コンポーネント](../../../../components/ui/calendar.tsx)
- [Weekly Calendar CSS](../../../../styles/weekly-calendar.css)
- [画面一覧](../../../../docs/screen-list.md#連絡予定)

### 実装上の注意事項

- 既存の contact-schedule 機能との整合性を保つ
- 週間表示のパフォーマンス最適化（大量データ対応）
- ブックマーク機能の楽観的更新実装
- モバイル表示での操作性確保
- アクセシビリティ対応の徹底