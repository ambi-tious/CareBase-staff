# 利用者登録画面設計書

画面名: `利用者登録`  
パス: `/residents/new`  
URL: https://carebase-staff.vercel.app/residents/new

## 概要

CareBase-staffアプリケーションの利用者登録画面設計書です。  
職員が新しい利用者の基本情報を入力して、施設への登録を行うためのフォーム画面です。  
利用者一覧画面から遷移し、登録完了後は新しく作成された利用者の詳細画面に自動遷移します。

Issue: [#135 [設計] #004 利用者｜利用者登録](https://github.com/ambi-tious/CareBase-staff/issues/135)

## 全体レイアウト

### 画面構成

<img width="752" height="489" alt="新規利用者登録画面" src="https://github.com/user-attachments/assets/ff8f66a2-4067-4a04-98d7-0a7768f442c0" />

職員による利用者情報入力のためのフォーム画面として以下の要素で構成：
- ページヘッダー（画面タイトル、説明文、戻るボタン）
- エラー表示エリア（入力エラー時に表示）
- 基本情報入力フォーム（2列レイアウト）
- アクションボタン（キャンセル、登録）

### 画面項目

| 項目名 | コンポーネント | 必須 | 表示条件 | 初期値 | 備考 |
| --- | --- | --- | --- | --- | --- |
| 戻るボタン | Button | - | 常時 | 戻る | アウトライン、ArrowLeft アイコン |
| 画面タイトル | Heading | - | 常時 | 新規利用者登録 | UserPlus アイコン付き |
| 説明文 | Text | - | 常時 | 基本情報入力の説明 | 必須項目マークの説明含む |
| エラーアラート | Alert | - | 送信エラー時 | - | 赤色背景、エラーメッセージ表示 |
| 氏名 | FormField | ◯ | 常時 | 空文字 | テキスト入力、プレースホルダー「山田 太郎」 |
| フリガナ | FormField | ◯ | 常時 | 空文字 | テキスト入力、プレースホルダー「ヤマダ タロウ」 |
| 生年月日 | FormField | ◯ | 常時 | 空文字 | 日付入力 |
| 性別 | FormSelect | ◯ | 常時 | 空文字 | 選択肢：男性/女性/その他 |
| 要介護度 | FormSelect | ◯ | 常時 | 空文字 | 選択肢：自立～要介護5 |
| 所属フロア・グループ | FormSelect | - | 常時 | 空文字 | 施設組織選択 |
| 所属ユニット・チーム | FormSelect | - | 常時 | 空文字 | チーム選択 |
| 部屋情報 | FormField | - | 常時 | 空文字 | テキスト入力、プレースホルダー「もみじ101号室」 |
| 入所日 | FormField | ◯ | 常時 | 空文字 | 日付入力 |
| 住所 | FormField | ◯ | 常時 | 空文字 | テキスト入力、プレースホルダー「東京都渋谷区...」 |
| キャンセルボタン | Button | - | 常時 | キャンセル | アウトライン |
| 登録ボタン | Button | - | 常時 | 登録 | 青色スタイル、Save アイコン |

## 機能仕様

### アクション

| 項目名 | 処理内容 | 対象API | 遷移先画面 |
| --- | --- | --- | --- |
| 戻るボタン | 利用者一覧画面に戻る | - | 利用者一覧画面 (`/residents`) |
| フォーム入力 | リアルタイムバリデーション実行 | - | 同一画面（エラー表示更新） |
| キャンセルボタン | 入力内容を破棄して一覧に戻る | - | 利用者一覧画面 (`/residents`) |
| 登録ボタン | 利用者情報を保存して詳細画面に遷移 | `residentService.createResident` | 利用者詳細画面 (`/residents/{id}`) |

### 入力チェック

| 項目名 | イベント | チェック内容 | エラーメッセージ |
| --- | --- | --- | --- |
| 氏名 | input | 必須チェック | 氏名は必須です |
| フリガナ | input | 必須チェック | フリガナは必須です |
| フリガナ | input | カタカナ形式チェック | フリガナはカタカナで入力してください |
| 生年月日 | input | 必須チェック | 生年月日は必須です |
| 性別 | select | 必須チェック | 性別は必須です |
| 要介護度 | select | 必須チェック | 要介護度は必須です |
| 入所日 | input | 必須チェック | 入所日は必須です |
| 入所日 | input | 生年月日との整合性チェック | 入所日は生年月日より後の日付を入力してください |
| 住所 | input | 必須チェック | 住所は必須です |

### バリデーション仕様

#### リアルタイムバリデーション

- **入力時検証**: フォーム項目への入力と同時にバリデーションを実行
- **エラー表示**: 各項目下部に赤色でエラーメッセージを表示
- **送信制御**: バリデーションエラーがある場合は登録ボタンクリック時に送信を阻止

#### 文字列検証

- **フリガナ**: カタカナ、長音符、スペースのみ許可（正規表現: `/^[ァ-ヶー\s]+$/`）
- **必須項目**: 空文字、空白のみの入力を無効とする
- **日付形式**: ISO 8601形式での日付入力を要求

#### 日付検証

- **入所日 > 生年月日**: 入所日が生年月日より後の日付であることを確認
- **未来日制限**: 現在日より未来の入所日は警告表示（実装予定）

#### エラーハンドリング

- **API通信エラー**: 「利用者の登録に失敗しました。もう一度お試しください。」
- **バリデーションエラー**: 「入力内容に不備があります。必須項目を確認してください。」
- **ネットワークエラー**: 自動リトライ機能付きエラーメッセージ


## UI/UX仕様

### レスポンシブデザイン

- **モバイル（〜768px）**: 
  - フォーム項目を1列で縦並び表示
  - ボタンを全幅で縦積み配置
  - 余白を最小化してコンテンツエリアを最大化
- **タブレット（768px〜1024px）**: 
  - フォーム項目を2列グリッドで表示
  - ボタンを右寄せで横並び配置
- **デスクトップ（1024px〜）**: 
  - フォーム全体の最大幅を6xlに制限
  - 2列グリッドレイアウトを維持
  - 余白を十分に確保

### カラーテーマ

- **背景色**: `bg-carebase-bg` - アプリケーション標準背景色
- **登録ボタン**: `bg-carebase-blue hover:bg-carebase-blue-dark` - メインアクション
- **戻る・キャンセルボタン**: `border-gray-300 text-gray-700` - セカンダリアクション
- **エラーアラート**: `bg-red-50 border-red-200 text-red-700` - エラー状態
- **必須マーク**: `text-red-500` - 必須項目表示
- **セクション見出し**: `text-carebase-text-primary border-b` - セクション分割

### フォームUI仕様

- **入力フィールド間隔**: `gap-6` - 項目間の適切な間隔
- **セクション分割**: 基本情報と施設情報を明確に分離
- **ラベル配置**: 各入力フィールドの上部に配置
- **プレースホルダー**: 入力例を示すサンプルテキスト
- **フォーカス状態**: 青色のアウトライン表示

### アニメーション

- **ボタンホバー**: スムーズなカラートランジション
- **フォーム送信**: ローディング状態の表示（「登録中...」）
- **エラー表示**: フェードイン効果でアラート表示
- **バリデーション**: リアルタイムでエラーメッセージ表示・非表示

### アクセシビリティ

- **キーボードナビゲーション**: Tabキーでの順次フォーカス移動
- **スクリーンリーダー**: 
  - 適切なlabel要素の関連付け
  - 必須項目のaria-required属性
  - エラーメッセージのaria-describedby属性
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスリング表示

### ローディング・無効化状態

- **送信中状態**: 
  - 全フォーム要素の無効化
  - 登録ボタンテキストを「登録中...」に変更
  - ボタンの無効化による誤操作防止
- **バリデーションエラー時**: 
  - 該当フィールドの赤色ボーダー表示
  - エラーメッセージの即座表示

## 参考資料

- [Issue #135: [設計] #004 利用者｜利用者登録](https://github.com/ambi-tious/CareBase-staff/issues/135)
- [利用者登録画面実装](./page.tsx)
- [ResidentBasicInfoForm コンポーネント](../../../../components/2_molecules/forms/resident-basic-info-form.tsx)
- [useResidentForm カスタムフック](../../../../hooks/useResidentForm.ts)
- [利用者一覧画面設計書](../README.md)
- [利用者詳細画面設計書](../[residentId]/README.md)
- [利用者登録画面テスト](../../../../__tests__/app/(main)/residents/new/new-resident-page.test.tsx)
- [ResidentBasicInfoForm テスト](../../../../__tests__/components/2_molecules/forms/resident-basic-info-form.test.tsx)
- [画面一覧](../../../../docs/screen-list.md#利用者管理)