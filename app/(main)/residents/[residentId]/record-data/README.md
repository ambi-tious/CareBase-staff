# 記録データ画面設計書

画面名: `記録データ`  
パス: `/residents/[residentId]/record-data`  
URL: https://carebase-staff.vercel.app/residents/[residentId]/record-data

## 概要

利用者詳細画面内の記録データ表示機能設計書です。  
利用者の介護状況確認、ケア記録・介護記録・申し送り表示、日次・月次表示切り替え機能を提供します。  
利用者詳細画面からの遷移により、その人にどのようなケアをしたか、日次・月次での記録データを効率的に確認できます。

Issue: [#125 [設計] #009 利用者｜利用者詳細（記録データ）](https://github.com/ambi-tious/CareBase-staff/issues/125)

## 全体レイアウト

### 画面構成

利用者の記録データを効率的に表示・管理するインターフェース：

- 利用者基本情報ヘッダー
- 表示形式切り替えタブ（日次・月次）
- データフィルタリング機能
- 記録データ一覧表示（形式に応じた表示）
- 空状態メッセージ（データなし時）

### 画面項目

| 項目名               | コンポーネント | 必須 | 表示条件         | 初期値       | 備考                         |
| -------------------- | -------------- | ---- | ---------------- | ------------ | ---------------------------- |
| 利用者情報ヘッダー   | ProfileHeader  | ◯    | 常時             | -            | 写真、名前、基本情報表示     |
| 表示形式切り替えタブ | TabsList       | ◯    | 常時             | 日次         | 日次・月次の2つのタブ        |
| 日付選択フィルター   | DatePicker     | ◯    | 常時             | 今日         | カレンダー選択形式           |
| 記録種別フィルター   | CheckboxGroup  | -    | 常時             | 全選択       | ケア記録・介護記録・申し送り |
| 検索フィルター       | Input          | -    | 常時             | -            | キーワード検索               |
| リセットボタン       | Button         | -    | フィルター使用時 | リセット     | フィルター条件クリア         |
| 記録データカード一覧 | RecordCard     | -    | データ存在時     | -            | 日次表示：詳細カード表示     |
| 記録データテーブル   | DataTable      | -    | データ存在時     | -            | 月次表示：数値テーブル表示   |
| 空状態メッセージ     | EmptyState     | -    | データなし時     | -            | 記録データがない旨の表示     |
| ページネーション     | Pagination     | -    | データ多数時     | -            | 日次表示時のページング       |
| エクスポートボタン   | Button         | -    | データ存在時     | エクスポート | CSV/PDF出力                  |
| 新規記録ボタン       | Button         | -    | 常時             | 記録追加     | 記録データ作成モーダル表示   |

## 機能仕様

### 表示形式切り替え

#### 日次表示

**表示内容**：

- ケア記録の詳細情報（実施時刻、内容、担当者、特記事項）
- 介護記録の詳細情報（記録時刻、内容、担当者、記録種別）
- 申し送り情報の詳細（作成時刻、内容、優先度、対象期間）

**レイアウト**：

- タイムライン形式での時系列表示
- 記録種別ごとの色分けとアイコン表示
- 詳細情報の展開/折りたたみ機能

**データ項目**：

| 項目名        | ケア記録 | 介護記録 | 申し送り | 備考                   |
| ------------- | -------- | -------- | -------- | ---------------------- |
| 実施/記録時刻 | ◯        | ◯        | ◯        | HH:MM形式で表示        |
| 内容          | ◯        | ◯        | ◯        | テキスト、改行対応     |
| 担当者        | ◯        | ◯        | ◯        | スタッフ名表示         |
| 記録種別      | ケア分類 | 記録分類 | 優先度   | バッジ形式で表示       |
| 特記事項      | ◯        | -        | 対象期間 | 注意点や特別な配慮事項 |
| 添付資料      | -        | ◯        | -        | 画像やファイルの添付   |

#### 月次表示

**表示内容**：

- ケア記録の数値データ（実施回数、実施率、目標達成度）
- 月間統計情報（総記録数、平均実施時間、傾向分析）
- グラフィカルな表示（棒グラフ、折れ線グラフ、円グラフ）

**レイアウト**：

- カレンダーベースの月次表示
- 数値データの表形式表示
- 統計グラフの表示

**データ項目**：

| 項目名       | 表示形式     | 計算方法               | 備考                 |
| ------------ | ------------ | ---------------------- | -------------------- |
| 日別実施回数 | 数値         | 日毎のケア記録件数     | カレンダーに数値表示 |
| 実施率       | パーセント   | 実施回数/計画回数×100  | 目標との比較         |
| 平均実施時間 | 分単位       | 総実施時間/実施回数    | 効率性の指標         |
| 記録種別内訳 | 円グラフ     | 種別毎の件数比率       | 視覚的な比率表示     |
| 月間傾向     | 折れ線グラフ | 日別実施数の推移       | トレンド分析         |
| 達成状況     | 進捗バー     | 月間目標に対する達成度 | 色分けによる状況表示 |

### アクション

| 項目名             | 処理内容                         | 対象API                                         | 遷移先画面                 |
| ------------------ | -------------------------------- | ----------------------------------------------- | -------------------------- |
| 日次タブ選択       | 日次表示モードに切り替え         | -                                               | 同一画面（表示形式変更）   |
| 月次タブ選択       | 月次表示モードに切り替え         | -                                               | 同一画面（表示形式変更）   |
| 日付選択           | 指定日付の記録データを取得       | `/api/v1/residents/{id}/record-data`            | 同一画面（データ更新）     |
| 記録種別フィルター | 選択した種別の記録データのみ表示 | -                                               | 同一画面（フィルター適用） |
| キーワード検索     | 検索条件に一致する記録データ表示 | `/api/v1/residents/{id}/record-data/search`     | 同一画面（検索結果表示）   |
| フィルターリセット | 全フィルター条件をクリア         | -                                               | 同一画面（初期状態に戻る） |
| エクスポート       | 記録データをCSV/PDF形式で出力    | `/api/v1/residents/{id}/record-data/export`     | ファイルダウンロード       |
| 新規記録           | 記録データ作成モーダルを表示     | -                                               | 同一画面（モーダル表示）   |
| 記録詳細表示       | 記録データの詳細情報を表示       | `/api/v1/residents/{id}/record-data/{recordId}` | 記録詳細画面               |
| 記録編集           | 記録データ編集モーダルを表示     | -                                               | 同一画面（モーダル表示）   |
| 記録削除           | 記録データ削除確認モーダルを表示 | -                                               | 同一画面（モーダル表示）   |

### フィルタリング機能

#### 日付フィルター

**日次表示**：

- 単一日付選択（カレンダーピッカー）
- 前日/翌日ナビゲーション
- 今日へのクイック移動

**月次表示**：

- 年月選択（年月ピッカー）
- 前月/翌月ナビゲーション
- 今月へのクイック移動

#### 記録種別フィルター

**選択オプション**：

- ケア記録（チェックボックス）
- 介護記録（チェックボックス）
- 申し送り（チェックボックス）
- 全選択/全解除ボタン

#### 検索フィルター

**検索対象**：

- 記録内容のテキスト
- 担当者名
- 特記事項・コメント

**検索機能**：

- 部分一致検索
- 複数キーワード対応（スペース区切り）
- 検索履歴機能

### 入力チェック

| 項目名         | イベント | チェック内容                 | エラーメッセージ                      |
| -------------- | -------- | ---------------------------- | ------------------------------------- |
| 日付選択       | change   | 有効な日付チェック           | 有効な日付を選択してください          |
| 検索キーワード | input    | 文字数チェック（50文字以内） | 検索キーワードは50文字以内です        |
| フィルター適用 | apply    | 選択条件チェック             | 少なくとも1つの条件を選択してください |

### バリデーション仕様

#### 表示制御

- 記録データがない場合の空状態表示
- フィルター条件に一致するデータがない場合の表示
- データ読み込み中のローディング表示
- エラー発生時のエラーメッセージ表示

#### エラーハンドリング

- ネットワークエラー時のリトライ機能
- データ取得失敗時のフォールバック表示
- 権限エラー時の適切なメッセージ表示

## UI/UX仕様

### レスポンシブデザイン

- **モバイル（〜768px）**:
  - タブを上下に配置
  - フィルターを折りたたみ式で表示
  - 記録カードを1列で縦並び表示
  - 月次表示はスクロール可能なテーブル

- **タブレット（768px〜1024px）**:
  - タブとフィルターを横並び配置
  - 記録カードを1列で表示
  - 月次表示は固定幅テーブル

- **デスクトップ（1024px〜）**:
  - 全要素を横方向に最適化
  - サイドバーでフィルター常時表示
  - 記録カードを2列表示可能
  - 月次表示は全幅テーブル

### カラーテーマ

- **日次タブ（アクティブ）**: `bg-carebase-blue text-white`
- **月次タブ（アクティブ）**: `bg-carebase-blue text-white`
- **ケア記録**: `bg-green-100 border-green-200 text-green-800`
- **介護記録**: `bg-blue-100 border-blue-200 text-blue-800`
- **申し送り**: `bg-orange-100 border-orange-200 text-orange-800`
- **フィルターボタン**: `border-carebase-blue text-carebase-blue hover:bg-carebase-blue-light`
- **新規記録ボタン**: `bg-carebase-blue hover:bg-carebase-blue-dark`
- **エクスポートボタン**: `border-gray-300 text-gray-700 hover:bg-gray-50`

### アイコン使用

- **日次タブ**: `Calendar` アイコン
- **月次タブ**: `CalendarDays` アイコン
- **ケア記録**: `Heart` アイコン
- **介護記録**: `Clipboard` アイコン
- **申し送り**: `MessageSquare` アイコン
- **検索**: `Search` アイコン
- **フィルター**: `Filter` アイコン
- **リセット**: `RotateCcw` アイコン
- **エクスポート**: `Download` アイコン
- **新規記録**: `Plus` アイコン
- **編集**: `Edit3` アイコン
- **削除**: `Trash2` アイコン

### アニメーション

- **タブ切り替え**: スムーズなトランジション効果
- **フィルター適用**: データ更新時のフェード効果
- **カード表示**: スタガーアニメーション
- **ホバー効果**: ボタン・カードの背景色変更
- **ローディング**: スケルトンローディングとスピナー

### アクセシビリティ

- **キーボードナビゲーション**: タブキーでの要素移動対応
- **スクリーンリーダー**: 適切なaria-label設定
- **色覚サポート**: 色だけでない情報伝達（アイコン併用）
- **コントラスト**: WCAG AA準拠の色彩設計
- **フォーカス管理**: 明確なフォーカス表示

## 技術仕様

### 使用コンポーネント

#### 新規作成が必要なコンポーネント

- **RecordDataTabs**: 日次・月次表示切り替えタブ
  - パス: `components/3_organisms/record-data/record-data-tabs.tsx`
  - 機能: タブ切り替え、データ表示制御
  - プロパティ: residentId, initialView, onViewChange

- **RecordDataFilters**: 記録データフィルター
  - パス: `components/2_molecules/record-data/record-data-filters.tsx`
  - 機能: 日付・種別・検索フィルター
  - プロパティ: onFiltersChange, initialFilters

- **DailyRecordView**: 日次記録表示
  - パス: `components/3_organisms/record-data/daily-record-view.tsx`
  - 機能: 日次記録データのタイムライン表示
  - プロパティ: records, filters, onRecordAction

- **MonthlyRecordView**: 月次記録表示
  - パス: `components/3_organisms/record-data/monthly-record-view.tsx`
  - 機能: 月次統計データの表・グラフ表示
  - プロパティ: statistics, month, onExport

- **RecordCard**: 記録データカード
  - パス: `components/2_molecules/record-data/record-card.tsx`
  - 機能: 個別記録データの詳細表示
  - プロパティ: record, type, onEdit, onDelete

- **RecordDataEmpty**: 空状態表示
  - パス: `components/1_atoms/record-data/record-data-empty.tsx`
  - 機能: データなし時の表示
  - プロパティ: message, showCreateButton

#### サービスクラス

- **recordDataService**: 記録データのCRUD操作
  - パス: `services/recordDataService.ts`
  - メソッド: getRecordData, getMonthlyStatistics, exportRecordData
  - フィルタリング・検索・ページネーション機能

#### 型定義

- **RecordData**: 記録データエンティティ型
  - パス: `types/record-data.ts`
  - プロパティ: id, type, content, timestamp, staffId, residentId

- **RecordFilter**: フィルター条件型
  - パス: `types/record-data.ts`
  - プロパティ: date, types, searchKeyword, pagination

- **MonthlyStatistics**: 月次統計データ型
  - パス: `types/record-data.ts`
  - プロパティ: month, totalRecords, averageTime, typeBreakdown

### API エンドポイント

| メソッド | エンドポイント                                  | 説明                   |
| -------- | ----------------------------------------------- | ---------------------- |
| GET      | `/api/v1/residents/{id}/record-data`            | 記録データ一覧取得     |
| GET      | `/api/v1/residents/{id}/record-data/monthly`    | 月次統計データ取得     |
| GET      | `/api/v1/residents/{id}/record-data/search`     | 記録データ検索         |
| GET      | `/api/v1/residents/{id}/record-data/export`     | 記録データエクスポート |
| GET      | `/api/v1/residents/{id}/record-data/{recordId}` | 記録データ詳細取得     |
| POST     | `/api/v1/residents/{id}/record-data`            | 記録データ新規作成     |
| PUT      | `/api/v1/residents/{id}/record-data/{recordId}` | 記録データ更新         |
| DELETE   | `/api/v1/residents/{id}/record-data/{recordId}` | 記録データ削除         |

### 状態管理

#### ローカル状態

- 表示形式（日次/月次）の管理
- フィルター条件の管理
- 記録データの表示状態
- ページネーション状態
- ローディング・エラー状態

#### データキャッシュ

- 記録データのメモリキャッシュ
- フィルター結果のキャッシュ
- 月次統計データのキャッシュ

### パフォーマンス最適化

- 仮想化によるリスト表示
- データの遅延読み込み
- 検索結果のデバウンス処理
- 画像の最適化とレイジーローディング

## 参考資料

### FlutterFlow参考画面

**日次表示**：
![日次表示](https://github.com/user-attachments/assets/f02e0f92-be70-4f09-902c-f0ca6db7cc3f)

**月次表示**：
![月次表示](https://github.com/user-attachments/assets/0a1321e1-f7ec-49dd-a9b9-433c478670a7)

### 関連ドキュメント

- [Issue #125: [設計] #009 利用者｜利用者詳細（記録データ）](https://github.com/ambi-tious/CareBase-staff/issues/125)
- [利用者詳細画面設計書](../README.md)
- [ケア記録画面設計書](../../care-records/README.md)
- [申し送り画面設計書](../../handovers/README.md)
- [お薬情報タブ設計書](../medications/README.md)
- [画面一覧](../../../../docs/screen-list.md#利用者管理)

### 実装参考

- 利用者詳細画面実装: `app/(main)/residents/[residentId]/page.tsx`
- ケア記録コンポーネント: `components/2_molecules/care-record/`
- 申し送りコンポーネント: `components/2_molecules/handover/`
- フィルターコンポーネント: `components/2_molecules/filters/`
- タブコンポーネント: `components/1_atoms/tabs/`
