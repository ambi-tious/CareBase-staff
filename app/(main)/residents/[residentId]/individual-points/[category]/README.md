# 個別ポイント詳細画面設計書

画面名: `個別ポイント詳細`  
パス: `/residents/[residentId]/individual-points/[category]`  
URL: https://carebase-staff.vercel.app/residents/[residentId]/individual-points/[category]

## 概要

CareBase-staffアプリケーションの個別ポイント詳細画面設計書です。  
利用者の個別ポイントカテゴリごとの詳細情報を表示・編集・削除・新規作成する機能を提供します。  
利用者詳細画面の個別ポイントタブからの遷移で使用されます。

## 画面モード

この画面は以下の2つのモードで動作します：

### 1. 詳細表示・編集モード（デフォルト）

- 既存の詳細情報がある場合
- URL: `/residents/[residentId]/individual-points/[category]`
- 詳細情報の表示、編集、削除が可能

### 2. 新規作成モード

- 詳細情報が存在しない場合
- URL: `/residents/[residentId]/individual-points/[category]?mode=create`
- 新規詳細情報の作成が可能
- 初期状態で編集モードで表示

## 全体レイアウト

### 画面構成

個別ポイントの詳細情報を管理するための専用画面：

- ページヘッダー（戻るボタン、カテゴリ名、利用者名）
- エラー表示エリア（エラー時に表示）
- 削除確認エリア（削除確認時に表示）
- メインコンテンツカード（詳細情報表示・編集）

### 画面項目

| 項目名               | コンポーネント | 必須 | 表示条件         | 初期値                     | 備考                               |
| -------------------- | -------------- | ---- | ---------------- | -------------------------- | ---------------------------------- |
| 戻るボタン           | Button         | -    | 常時             | 戻る                       | アウトライン、ArrowLeft アイコン   |
| カテゴリ編集ボタン   | Button         | -    | 編集モード時のみ | カテゴリの編集             | アウトライン、Edit アイコン        |
| カテゴリアイコン     | Icon           | -    | 常時             | -                          | 動的アイコン、青色背景             |
| カテゴリ名           | Heading        | ◯    | 常時             | -                          | 大文字、太字                       |
| 利用者名             | Text           | ◯    | 常時             | {利用者名}様の個別ポイント | グレー色                           |
| エラーアラート       | Alert          | -    | エラー時         | -                          | 赤色背景、エラーメッセージ表示     |
| バリデーションエラー | Alert          | -    | バリデーション時 | -                          | 赤色背景、必須入力エラー表示       |
| 削除確認アラート     | Alert          | -    | 削除確認時       | -                          | 赤色背景、確認メッセージ表示       |
| 編集ボタン           | Button         | -    | 閲覧モード時     | 編集                       | アウトライン、Edit アイコン        |
| 削除ボタン           | Button         | -    | 閲覧モード時     | 削除                       | アウトライン、赤色、Trash アイコン |
| キャンセルボタン     | Button         | -    | 編集モード時     | キャンセル                 | アウトライン                       |
| 保存・登録ボタン     | Button         | -    | 編集モード時     | 保存/登録                  | 青色、Save アイコン                |
| 詳細内容表示エリア   | Div            | -    | 閲覧モード時     | -                          | 改行保持、最小高さ384px            |
| 詳細内容入力エリア   | RichTextEditor | ◯    | 編集モード時     | -                          | 高さ400px、必須入力                |
| 空状態表示           | Div            | -    | 内容なし時       | 詳細情報がありません       | 中央配置、アイコン付き             |

## 機能仕様

### アクション

| 項目名           | 処理内容                               | 対象API                                                        | 遷移先画面                                        |
| ---------------- | -------------------------------------- | -------------------------------------------------------------- | ------------------------------------------------- |
| 戻るボタン       | 利用者詳細画面の個別ポイントタブに戻る | -                                                              | 利用者詳細画面 (`/residents/{id}?tab=points`)     |
| 編集ボタン       | 編集モードに切り替え                   | -                                                              | 同一画面（編集モード）                            |
| キャンセルボタン | 編集をキャンセル                       | -                                                              | 新規作成時：個別ポイントタブ / 編集時：閲覧モード |
| 登録・保存ボタン | 詳細内容を保存                         | `/api/v1/residents/{id}/individual-points/{category}`          | 新規作成時：詳細画面 / 編集時：閲覧モード         |
| 削除ボタン       | 削除確認表示                           | -                                                              | 同一画面（削除確認表示）                          |
| 削除確認         | 詳細内容を削除                         | `/api/v1/residents/{id}/individual-points/{category}` (DELETE) | 同一画面（空状態）                                |

### 入力チェック

| 項目名     | イベント     | チェック内容     | エラーメッセージ                                 |
| ---------- | ------------ | ---------------- | ------------------------------------------------ |
| 利用者ID   | ページロード | 存在チェック     | 指定された利用者が見つかりません                 |
| カテゴリ名 | ページロード | 存在チェック     | 指定されたカテゴリが見つかりません               |
| 詳細内容   | 保存時       | 必須入力チェック | 詳細情報は必須入力です。内容を入力してください。 |
| 詳細内容   | 保存時       | 文字数制限       | 内容が長すぎます                                 |

### バリデーション仕様

#### URL パラメータ

- **residentId**: 数値形式の利用者ID
- **category**: URLエンコードされたカテゴリ名（日本語対応）
- **mode**: 'create' | 'edit' (オプション、createの場合は新規作成モード)

#### 表示制御

- 新規作成モード: 初期状態で編集モード、空のエディタを表示
- 内容がない場合: 空状態メッセージとアイコンを中央表示
- 編集モード: テキストエリアで内容編集可能
- 閲覧モード: 改行を保持して内容表示
- 削除確認: 削除ボタンクリック時に確認アラート表示
- 必須入力: 新規作成・編集時に内容が空の場合はバリデーションエラー表示

#### エラーハンドリング

- 利用者データ取得エラー時の404ページ表示
- カテゴリ存在チェックエラー時の404ページ表示
- 必須入力バリデーションエラー時の適切なメッセージ表示
- 保存・削除処理エラー時のエラーメッセージ表示
- ネットワークエラー時の適切なフィードバック
- 未保存変更時の確認ダイアログ表示

## UI/UX仕様

### レスポンシブデザイン

- **モバイル（〜768px）**:
  - ヘッダー要素を縦並び配置
  - カードを全幅表示
  - ボタンサイズを調整
- **タブレット（768px〜1024px）**:
  - ヘッダー要素を横並び配置
  - カード最大幅を制限
- **デスクトップ（1024px〜）**:
  - カード最大幅を4xlに制限
  - 十分な余白を確保

### カラーテーマ

- **戻るボタン**: `border-gray-300 text-gray-700 hover:bg-gray-50`
- **編集ボタン**: `border-carebase-blue text-carebase-blue hover:bg-carebase-blue-light`
- **保存・登録ボタン**: `bg-carebase-blue hover:bg-carebase-blue-dark`
- **削除ボタン**: `border-red-300 text-red-600 hover:bg-red-50`
- **カテゴリアイコン**: `bg-carebase-blue-light text-carebase-blue`
- **エラーアラート**: `bg-red-50 border-red-200 text-red-700`
- **バリデーションエラー**: `bg-red-50 border-red-200 text-red-700`
- **個別ポイントカード（内容なし）**: `bg-gray-200 text-gray-500 hover:bg-gray-300`

### アニメーション

- **ボタンホバー**: スムーズなカラートランジション
- **保存・削除処理**: ローディング状態の表示
- **モード切り替え**: スムーズな表示切り替え
- **カードホバー**: 内容なしカードのホバー効果

### アクセシビリティ

- **キーボードナビゲーション**: Tabキーでの要素移動対応
- **スクリーンリーダー**: 適切なaria-label設定
- **フォーカス管理**: 編集モード時のテキストエリアフォーカス
- **エラー通知**: role="alert"でエラーメッセージを通知
- **必須項目表示**: 視覚的な必須マーク（\*）の表示

## データ仕様

### Mock データ構造

```typescript
const mockPointContents: Record<string, string> = {
  食事: `食事に関する個別ポイント

朝食：全粥・常菜・常食
昼食：全粥・常菜・常食
夕食：全粥・常菜・常食

• 嚥下機能は良好
• 自力摂取可能
• 食事の際は前かがみの姿勢を保持
• 水分とろみ剤使用（中間のとろみ）`,
  移乗介助: `移乗介助に関する個別ポイント

基本的に見守りで自立
疲労時は一部介助が必要

• ベッドから車椅子への移乗は見守り
• 立ち上がり時にふらつきあり
• 手すりを使用して安全に移乗`,
  // その他のカテゴリ...
};
```

### API 仕様（将来実装）

- **POST** `/api/v1/residents/{id}/individual-points/{category}` - 詳細内容新規作成
- **GET** `/api/v1/residents/{id}/individual-points/{category}` - 詳細内容取得
- **PUT** `/api/v1/residents/{id}/individual-points/{category}` - 詳細内容更新
- **DELETE** `/api/v1/residents/{id}/individual-points/{category}` - 詳細内容削除

## 新規作成機能の特徴

### 1. 自動モード判定

- 個別ポイントタブで内容のないカテゴリをクリック → 新規作成モード
- 個別ポイントタブで内容のあるカテゴリをクリック → 詳細表示モード

### 2. 必須入力バリデーション

- 新規作成時は詳細内容が必須入力
- 空の状態で保存しようとするとエラーメッセージを表示
- リアルタイムでの入力状態監視

### 3. 適切な画面遷移

- 新規作成完了後は詳細表示画面に自動遷移
- キャンセル時は個別ポイントタブに戻る
- 未保存変更時の確認ダイアログ

### 4. ユーザビリティ向上

- 内容なしカードに「クリックして作成」のヒント表示
- ホバー効果でインタラクティブ性を向上
- 新規作成モードでは初期状態で編集モード

## 参考資料

- [利用者詳細画面設計書](../../README.md)
- [ResidentDetailTabs コンポーネント](../../../../../components/3_organisms/resident/resident-detail-tabs.tsx)
- [IndividualPointDetailPage コンポーネント](../../../../../components/3_organisms/resident/individual-point-detail-page.tsx)
- [IndividualPointCard コンポーネント](../../../../../components/2_molecules/resident/individual-point-card.tsx)
- [個別ポイント詳細画面実装](./page.tsx)
- [画面一覧](../../../../../docs/screen-list.md#利用者管理)

---

_最終更新: 2025年1月22日_
