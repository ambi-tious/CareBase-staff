# 介護記録編集画面設計書

画面名: `介護記録編集`  
パス: `/care-records/[recordId]/edit`  
URL: https://carebase-staff.vercel.app/care-records/[recordId]/edit

## 概要

CareBase-staffアプリケーションの介護記録編集画面設計書です。  
既存の介護記録の内容を編集・更新する機能を提供し、介護現場での記録修正や追記を効率的に行えます。  
下書き保存機能により、作業の中断・再開が可能で、削除機能も含む包括的な編集機能を提供します。

## 全体レイアウト

### 画面構成

介護記録編集のメイン画面として以下の要素で構成：

- ページヘッダー（画面タイトル、説明文、戻るボタン、削除ボタン）
- 成功・エラーメッセージ表示エリア
- 担当職員情報表示
- 対象利用者情報表示（選択時）
- 介護記録編集フォーム（2列レイアウト）
- アクションボタン（キャンセル、下書き保存、更新）
- 削除確認モーダル

### 画面項目

| 項目名               | コンポーネント    | 必須 | 表示条件     | 初期値             | 備考                                                   |
| -------------------- | ----------------- | ---- | ------------ | ------------------ | ------------------------------------------------------ |
| 戻るボタン           | Button            | -    | 常時         | 戻る               | アウトライン、ArrowLeft アイコン                       |
| 画面タイトル         | Heading           | -    | 常時         | 介護記録編集       | Edit3 アイコン付き                                     |
| 削除ボタン           | Button            | -    | 常時         | 削除               | 赤色アウトライン、Trash2 アイコン                      |
| 説明文               | Text              | -    | 常時         | 編集説明           | 必須項目マークの説明含む                               |
| 成功メッセージ       | Alert             | -    | 更新成功時   | -                  | 緑色背景、CheckCircle アイコン                         |
| エラーアラート       | Alert             | -    | 更新エラー時 | -                  | 赤色背景、エラーメッセージ表示                         |
| 担当職員表示         | InfoDisplay       | -    | 常時         | ログインユーザー名 | 青色背景、User アイコン付き                            |
| 対象利用者選択       | FormSelect        | ◯    | 常時         | 既存データ         | 利用者一覧から選択                                     |
| 利用者情報表示       | InfoDisplay       | -    | 選択時       | 利用者詳細情報     | 緑色背景、年齢・性別・介護度・部屋情報表示             |
| 記録種別選択         | FormSelect        | ◯    | 常時         | 既存データ         | 食事/入浴/服薬/排泄/バイタル/運動/コミュニケーション等 |
| タイトル入力         | FormField         | ◯    | 常時         | 既存データ         | テキスト入力、プレースホルダー「朝食摂取記録」         |
| 記録日時入力         | FormField         | ◯    | 常時         | 既存データ         | datetime-local形式                                     |
| 重要度選択           | FormSelect        | ◯    | 常時         | 既存データ         | 高/中/低                                               |
| ステータス選択       | FormSelect        | ◯    | 常時         | 既存データ         | 下書き/完了/確認済み                                   |
| 記録内容入力         | Textarea          | ◯    | 常時         | 既存データ         | 大きなテキストエリア、1000文字制限                     |
| 記録ガイドライン     | InfoDisplay       | -    | 常時         | ガイドライン表示   | グレー背景、記録作成のヒント                           |
| 未保存変更警告       | Alert             | -    | 変更あり時   | -                  | 黄色背景、AlertCircle アイコン                         |
| キャンセルボタン     | Button            | -    | 常時         | キャンセル         | アウトライン                                           |
| 下書き保存ボタン     | Button            | -    | 常時         | 下書き保存         | アウトライン、Save アイコン                            |
| 更新ボタン           | Button            | -    | 常時         | 記録を更新         | 青色スタイル、Send アイコン                            |
| 削除確認モーダル     | Modal             | -    | 削除時       | -                  | 削除確認ダイアログ                                     |

## 機能仕様

### アクション

| 項目名           | 処理内容                       | 対象API                                | 遷移先画面                              |
| ---------------- | ------------------------------ | -------------------------------------- | --------------------------------------- |
| 戻るボタン       | 介護記録詳細画面に戻る         | -                                      | 介護記録詳細画面 (`/care-records/{id}`) |
| フォーム入力     | リアルタイムバリデーション実行 | -                                      | 同一画面（エラー表示更新）              |
| 下書き保存       | 入力内容を下書きとして保存     | `careRecordService.updateCareRecord`   | 同一画面（成功メッセージ表示）          |
| 更新ボタン       | 介護記録を確定して更新         | `careRecordService.updateCareRecord`   | 介護記録詳細画面 (`/care-records/{id}`) |
| 削除ボタン       | 削除確認モーダルを表示         | -                                      | 同一画面（モーダル表示）                |
| 削除確認         | 介護記録を削除                 | `careRecordService.deleteCareRecord`   | 介護記録一覧画面 (`/care-records`)      |
| キャンセルボタン | 入力内容を破棄して詳細に戻る   | -                                      | 介護記録詳細画面 (`/care-records/{id}`) |

### 入力チェック

| 項目名       | イベント | チェック内容                   | エラーメッセージ                     |
| ------------ | -------- | ------------------------------ | ------------------------------------ |
| 利用者選択   | change   | 必須選択チェック               | 利用者を選択してください             |
| 記録種別選択 | change   | 必須選択チェック               | 記録種別を選択してください           |
| タイトル入力 | blur     | 必須チェック                   | タイトルは必須です                   |
| タイトル入力 | blur     | 文字数チェック（100文字以内）  | タイトルは100文字以内で入力してください  |
| 記録日時入力 | change   | 必須チェック                   | 記録日時は必須です                   |
| 記録日時入力 | change   | 日時形式チェック               | 有効な日時を入力してください         |
| 重要度選択   | change   | 必須選択チェック               | 重要度を選択してください             |
| ステータス選択 | change | 必須選択チェック               | ステータスを選択してください         |
| 記録内容入力 | blur     | 必須チェック                   | 記録内容は必須です                   |
| 記録内容入力 | input    | 文字数チェック（1000文字以内） | 記録内容は1000文字以内で入力してください |
| フォーム送信 | submit   | 全必須項目チェック             | 必須項目をすべて入力してください     |

### バリデーション仕様

#### リアルタイムバリデーション

- **入力時検証**: フォーム項目への入力と同時にバリデーションを実行
- **エラー表示**: 各項目下部に赤色でエラーメッセージを表示
- **送信制御**: バリデーションエラーがある場合は送信ボタンクリック時に送信を阻止

#### 文字数制限

- **タイトル**: 100文字以内
- **記録内容**: 1000文字以内、リアルタイム文字数表示
- **文字数表示**: 入力中の文字数を「xxx/1000文字」形式で表示

#### 下書き保存仕様

- **バリデーション**: 下書き保存時は必須項目チェックを緩和
- **自動保存**: 一定時間ごとの自動下書き保存（将来実装予定）
- **復元機能**: 下書きからの復元機能（将来実装予定）

#### エラーハンドリング

- **API通信エラー**: 「ネットワークエラーが発生しました。接続を確認してもう一度お試しください。」
- **バリデーションエラー**: 「入力内容に不備があります。必須項目を確認してください。」
- **更新エラー**: 「介護記録の更新に失敗しました。もう一度お試しください。」
- **削除エラー**: 「介護記録の削除に失敗しました。もう一度お試しください。」
- **下書き保存エラー**: 「下書き保存に失敗しました。もう一度お試しください。」

## UI/UX仕様

### レスポンシブデザイン

- **モバイル（〜768px）**:
  - フォーム項目を1列で縦並び表示
  - ボタンを全幅で縦積み配置
  - 余白を最小化してコンテンツエリアを最大化
- **タブレット（768px〜1024px）**:
  - フォーム項目を2列グリッドで表示
  - ボタンを右寄せで横並び配置
- **デスクトップ（1024px〜）**:
  - フォーム全体の最大幅を6xlに制限
  - 2列グリッドレイアウトを維持
  - 余白を十分に確保

### カラーテーマ

- **背景色**: `bg-carebase-bg` - アプリケーション標準背景色
- **更新ボタン**: `bg-carebase-blue hover:bg-carebase-blue-dark` - メインアクション
- **下書き保存ボタン**: `border-gray-400 text-gray-700 hover:bg-gray-50` - セカンダリアクション
- **削除ボタン**: `border-red-300 text-red-600 hover:bg-red-50` - 危険なアクション
- **戻る・キャンセルボタン**: `border-gray-300 text-gray-700` - セカンダリアクション
- **成功アラート**: `bg-green-50 border-green-200 text-green-700` - 成功状態
- **エラーアラート**: `bg-red-50 border-red-200 text-red-700` - エラー状態
- **警告アラート**: `bg-yellow-50 border-yellow-200 text-yellow-800` - 警告状態
- **担当職員表示**: `bg-blue-50 border-blue-200 text-blue-800` - 情報表示
- **利用者情報表示**: `bg-green-50 border-green-200 text-green-800` - 情報表示

### フォームUI仕様

- **入力フィールド間隔**: `gap-6` - 項目間の適切な間隔
- **セクション分割**: 基本情報と記録内容を明確に分離
- **ラベル配置**: 各入力フィールドの上部に配置
- **プレースホルダー**: 入力例を示すサンプルテキスト
- **フォーカス状態**: 青色のアウトライン表示
- **文字数カウンター**: 記録内容の下部に表示

### アニメーション

- **ボタンホバー**: スムーズなカラートランジション
- **フォーム送信**: ローディング状態の表示（「更新中...」「保存中...」）
- **アラート表示**: フェードイン効果でアラート表示
- **バリデーション**: リアルタイムでエラーメッセージ表示・非表示
- **モーダル表示**: フェードイン・スケールアニメーション

### アクセシビリティ

- **キーボードナビゲーション**: Tabキーでの順次フォーカス移動
- **スクリーンリーダー**:
  - 適切なlabel要素の関連付け
  - 必須項目のaria-required属性
  - エラーメッセージのaria-describedby属性
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスリング表示

### ローディング・無効化状態

- **更新中状態**:
  - 全フォーム要素の無効化
  - 更新ボタンテキストを「更新中...」に変更
  - 下書き保存ボタンの無効化
- **下書き保存中状態**:
  - 下書き保存ボタンテキストを「保存中...」に変更
  - 更新ボタンの無効化
- **削除中状態**:
  - 削除ボタンテキストを「削除中...」に変更
  - 全ボタンの無効化
- **バリデーションエラー時**:
  - 該当フィールドの赤色ボーダー表示
  - エラーメッセージの即座表示

## 技術仕様

### 使用コンポーネント

#### 2_molecules層

- **CareRecordForm**: 介護記録作成・編集フォーム
- **CareRecordDeleteModal**: 削除確認モーダル（将来実装）

#### 1_atoms層

- **CategoryBadge**: カテゴリバッジ表示
- **PriorityBadge**: 重要度バッジ表示
- **StatusBadge**: ステータスバッジ表示

#### カスタムフック

- **useCareRecordForm**: フォーム状態管理とバリデーション

#### サービス層

- **careRecordService**: 介護記録のCRUD操作

### データ型定義

```typescript
interface CareRecordFormData {
  residentId: string;        // 利用者ID（必須）
  category: CareRecordCategory; // 記録種別（必須）
  title: string;             // タイトル（必須、100文字以内）
  content: string;           // 記録内容（必須、1000文字以内）
  recordedAt: string;        // 記録日時（必須、ISO形式）
  priority: CareRecordPriority; // 重要度（必須）
  status: CareRecordStatus;  // ステータス（必須）
}
```

### API仕様

| メソッド | エンドポイント                    | 説明             |
| -------- | --------------------------------- | ---------------- |
| GET      | `/api/v1/care-records/{id}`       | 介護記録詳細取得 |
| PUT      | `/api/v1/care-records/{id}`       | 介護記録更新     |
| DELETE   | `/api/v1/care-records/{id}`       | 介護記録削除     |
| POST     | `/api/v1/care-records/{id}/draft` | 下書き保存       |

### 状態管理

- **フォーム状態**: 入力値、バリデーション状態、送信状態
- **エラー状態**: API通信エラー、バリデーションエラー
- **成功状態**: 更新成功、下書き保存成功
- **未保存変更**: フォーム変更の検知と警告表示

## 削除機能仕様

### 削除確認フロー

1. **削除ボタンクリック**: 削除確認モーダルを表示
2. **確認メッセージ**: 記録タイトルを含む確認メッセージ
3. **削除実行**: 確認後にAPI呼び出し
4. **完了処理**: 削除成功後に一覧画面に遷移

### 削除時の注意事項

- **データ復元不可**: 削除されたデータは復元できない旨を明示
- **二段階確認**: モーダル表示による確認プロセス
- **エラーハンドリング**: 削除失敗時の適切なエラー表示

## 参考資料

- [介護記録一覧画面設計書](../README.md)
- [介護記録詳細画面設計書](../[recordId]/README.md)
- [CareRecordForm コンポーネント](../../../../components/2_molecules/care-record/care-record-form.tsx)
- [useCareRecordForm フック](../../../../hooks/useCareRecordForm.ts)
- [Care Record Types](../../../../types/care-record.ts)
- [Care Record Service](../../../../services/careRecordService.ts)
- [画面一覧](../../../../docs/screen-list.md#申し送り介護記録)