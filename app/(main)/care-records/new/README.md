# 介護記録登録画面設計書

画面名: `介護記録登録`  
パス: `/care-records/new`  
URL: https://carebase-staff.vercel.app/care-records/new

## 概要

CareBase-staffアプリケーションの介護記録登録画面設計書です。  
介護現場での日々の記録を効率的に作成・管理するため、利用者選択・職員通知・分類入力・テンプレート活用・添付ファイル機能を提供します。  
下書き保存機能により作業の中断・再開が可能で、バリデーション機能により入力ミスを防止します。

## 全体レイアウト

<img width="743" height="746" alt="スクリーンショット 2025-07-30 15 50 32" src="https://github.com/user-attachments/assets/7e8a073d-97ba-4cb8-853c-e33b48828808" />

### 画面構成

介護記録登録のメイン画面として以下の要素で構成：

- ページヘッダー（画面タイトル、説明文、戻るボタン）
- 成功・エラーメッセージ表示エリア
- 介護記録登録フォーム（2列レイアウト）
- アクションボタン（キャンセル、下書き保存、記録作成）

### 画面項目

| 項目名           | コンポーネント   | 必須 | 表示条件       | 初期値             | 備考                                                        |
| ---------------- | ---------------- | ---- | -------------- | ------------------ | ----------------------------------------------------------- |
| 戻るボタン       | Button           | -    | 常時           | 戻る               | アウトライン、ArrowLeft アイコン                            |
| 画面タイトル     | Heading          | -    | 常時           | 新規介護記録作成   | FileText アイコン付き                                       |
| 説明文           | Text             | -    | 常時           | 作成説明           | 必須項目マークの説明含む                                    |
| 成功メッセージ   | Alert            | -    | 作成成功時     | -                  | 緑色背景、CheckCircle アイコン                              |
| エラーアラート   | Alert            | -    | 作成エラー時   | -                  | 赤色背景、エラーメッセージ表示                              |
| 担当職員表示     | InfoDisplay      | -    | 常時           | ログインユーザー名 | 青色背景、User アイコン付き                                 |
| 対象利用者表示   | InfoDisplay      | -    | 利用者選択時   | 選択利用者情報     | 緑色背景、利用者詳細情報表示                                |
| 対象利用者選択   | FormSelect       | ◯    | 常時           | 未選択             | 利用者一覧、検索機能付き                                    |
| 記録種別選択     | FormSelect       | ◯    | 常時           | ケース記録         | 食事/入浴/服薬/排泄/バイタル/運動/コミュニケーション/その他 |
| 分類編集         | Button           | -    | 常時           | 分類を編集する     | テキストボタン、記録種別設定画面へ遷移                      |
| タイトル入力     | FormField        | ◯    | 常時           | 空文字             | テキスト入力、プレースホルダー「朝食摂取記録」              |
| 記録日時入力     | FormField        | ◯    | 常時           | 現在日時           | 日時入力、該当時間として表示                                |
| 重要度選択       | FormSelect       | ◯    | 常時           | 中                 | 高/中/低                                                    |
| ステータス選択   | FormSelect       | ◯    | 常時           | 完了               | 下書き/完了/確認済み                                        |
| お知らせ職員選択 | StaffSelector    | -    | 常時           | 空配列             | 複数選択可能、検索機能付き                                  |
| 記録内容入力     | Textarea         | ◯    | 常時           | 空文字             | 大きなテキストエリア、1000文字制限                          |
| アラート切り替え | Switch           | -    | 常時           | OFF                | 重要な記録内容の場合にON                                    |
| テンプレート選択 | TemplateSelector | -    | 常時           | -                  | よく使用する文章テンプレートの選択・適用                    |
| テンプレート作成 | Button           | -    | 常時           | テンプレート作成   | アウトライン、新規テンプレート作成                          |
| 画像添付         | AttachmentUpload | -    | 常時           | -                  | 画像ファイルのアップロード、プレビュー表示                  |
| 動画添付         | AttachmentUpload | -    | 常時           | -                  | 動画ファイルのアップロード、プレビュー表示                  |
| 添付ファイル一覧 | AttachmentList   | -    | 添付ファイル時 | -                  | アップロード済みファイルの一覧・削除                        |
| 未保存変更警告   | Alert            | -    | 変更あり時     | -                  | 黄色背景、AlertCircle アイコン                              |
| キャンセルボタン | Button           | -    | 常時           | キャンセル         | アウトライン                                                |
| 下書き保存ボタン | Button           | -    | 常時           | 下書き保存         | アウトライン、Save アイコン                                 |
| 記録作成ボタン   | Button           | -    | 常時           | 記録を作成         | 青色スタイル、FileText アイコン                             |

## 機能仕様

### アクション

| 項目名           | 処理内容                         | 対象API                              | 遷移先画面                                |
| ---------------- | -------------------------------- | ------------------------------------ | ----------------------------------------- |
| 戻るボタン       | 介護記録一覧画面に戻る           | -                                    | 介護記録一覧画面 (`/care-records`)        |
| フォーム入力     | リアルタイムバリデーション実行   | -                                    | 同一画面（エラー表示更新）                |
| 分類編集         | 記録種別設定画面に遷移           | -                                    | 記録種別設定画面 (`/settings/categories`) |
| お知らせ職員選択 | 職員一覧から通知対象を選択       | `GET /api/v1/staff`                  | 同一画面（選択状態更新）                  |
| テンプレート選択 | 既存テンプレートを記録内容に適用 | `GET /api/v1/care-record-templates`  | 同一画面（内容更新）                      |
| テンプレート作成 | 新規テンプレート作成             | `POST /api/v1/care-record-templates` | テンプレート作成画面                      |
| 画像添付         | 画像ファイルのアップロード       | `POST /api/v1/attachments/images`    | 同一画面（添付ファイル追加）              |
| 動画添付         | 動画ファイルのアップロード       | `POST /api/v1/attachments/videos`    | 同一画面（添付ファイル追加）              |
| 添付ファイル削除 | アップロード済みファイルの削除   | `DELETE /api/v1/attachments/{id}`    | 同一画面（添付ファイル削除）              |
| 下書き保存       | 入力内容を下書きとして保存       | `POST /api/v1/care-records/draft`    | 同一画面（成功メッセージ表示）            |
| 記録作成         | 介護記録を確定して作成           | `POST /api/v1/care-records`          | 記録詳細画面 (`/care-records/{id}`)       |
| キャンセルボタン | 入力内容を破棄して一覧に戻る     | -                                    | 介護記録一覧画面 (`/care-records`)        |

### 入力チェック

| 項目名         | イベント | チェック内容                    | エラーメッセージ                         |
| -------------- | -------- | ------------------------------- | ---------------------------------------- |
| 対象利用者選択 | change   | 必須選択チェック                | 対象利用者を選択してください             |
| 記録種別選択   | change   | 必須選択チェック                | 記録種別は必須です                       |
| タイトル入力   | blur     | 必須チェック                    | タイトルは必須です                       |
| タイトル入力   | blur     | 文字数チェック（100文字以内）   | タイトルは100文字以内で入力してください  |
| 記録日時入力   | change   | 必須チェック                    | 記録日時は必須です                       |
| 記録日時入力   | change   | 日時形式チェック                | 有効な日時を入力してください             |
| 重要度選択     | change   | 必須選択チェック                | 重要度は必須です                         |
| 記録内容入力   | blur     | 必須チェック                    | 記録内容は必須です                       |
| 記録内容入力   | input    | 文字数チェック（1000文字以内）  | 記録内容は1000文字以内で入力してください |
| 画像添付       | change   | ファイル形式チェック            | 対応している画像形式を選択してください   |
| 画像添付       | change   | ファイルサイズチェック（10MB）  | 画像ファイルは10MB以内にしてください     |
| 動画添付       | change   | ファイル形式チェック            | 対応している動画形式を選択してください   |
| 動画添付       | change   | ファイルサイズチェック（100MB） | 動画ファイルは100MB以内にしてください    |
| フォーム送信   | submit   | 全必須項目チェック              | 必須項目をすべて入力してください         |

### バリデーション仕様

#### リアルタイムバリデーション

- **入力時検証**: フォーム項目への入力と同時にバリデーションを実行
- **エラー表示**: 各項目下部に赤色でエラーメッセージを表示
- **送信制御**: バリデーションエラーがある場合は送信ボタンクリック時に送信を阻止

#### 文字数制限

- **タイトル**: 100文字以内
- **記録内容**: 1000文字以内、リアルタイム文字数表示
- **文字数表示**: 入力中の文字数を「xxx/1000文字」形式で表示

#### ファイルアップロード制限

- **画像ファイル**: JPEG, PNG, GIF, WEBP対応、10MB以内
- **動画ファイル**: MP4, MOV, AVI対応、100MB以内
- **同時アップロード**: 画像5枚、動画3本まで
- **プレビュー**: アップロード後に即座にプレビュー表示

#### 下書き保存仕様

- **バリデーション**: 下書き保存時は必須項目チェックを緩和
- **自動保存**: 5分間隔での自動下書き保存
- **復元機能**: ページ再読み込み時の下書き復元
- **重複防止**: 同一記録の重複下書き防止

#### エラーハンドリング

- **API通信エラー**: 「ネットワークエラーが発生しました。接続を確認してもう一度お試しください。」
- **バリデーションエラー**: 「入力内容に不備があります。必須項目を確認してください。」
- **送信エラー**: 「介護記録の作成に失敗しました。もう一度お試しください。」
- **下書き保存エラー**: 「下書き保存に失敗しました。もう一度お試しください。」
- **ファイルアップロードエラー**: 「ファイルのアップロードに失敗しました。ファイル形式・サイズを確認してください。」

## UI/UX仕様

### レスポンシブデザイン

- **モバイル（〜768px）**:
  - フォーム項目を1列で縦並び表示
  - ボタンを全幅で縦積み配置
  - 添付ファイルボタンを縦並びで表示
  - 余白を最小化してコンテンツエリアを最大化
- **タブレット（768px〜1024px）**:
  - フォーム項目を2列グリッドで表示
  - ボタンを右寄せで横並び配置
  - 添付ファイルボタンを横並びで表示
- **デスクトップ（1024px〜）**:
  - フォーム全体の最大幅を4xlに制限
  - 2列グリッドレイアウトを維持
  - 余白を十分に確保

### カラーテーマ

- **背景色**: `bg-carebase-bg` - アプリケーション標準背景色
- **記録作成ボタン**: `bg-carebase-blue hover:bg-carebase-blue-dark` - メインアクション
- **下書き保存ボタン**: `border-gray-400 text-gray-700 hover:bg-gray-50` - セカンダリアクション
- **戻る・キャンセルボタン**: `border-gray-300 text-gray-700` - セカンダリアクション
- **成功アラート**: `bg-green-50 border-green-200 text-green-700` - 成功状態
- **エラーアラート**: `bg-red-50 border-red-200 text-red-700` - エラー状態
- **警告アラート**: `bg-yellow-50 border-yellow-200 text-yellow-800` - 警告状態
- **担当職員表示**: `bg-blue-50 border-blue-200 text-blue-800` - 情報表示
- **対象利用者表示**: `bg-green-50 border-green-200 text-green-800` - 情報表示
- **アラートスイッチON**: `bg-red-100 text-red-700` - 重要な記録の強調表示

### フォームUI仕様

- **入力フィールド間隔**: `gap-6` - 項目間の適切な間隔
- **セクション分割**: 基本情報・記録内容・添付ファイル・通知設定を明確に分離
- **ラベル配置**: 各入力フィールドの上部に配置
- **プレースホルダー**: 入力例を示すサンプルテキスト
- **フォーカス状態**: 青色のアウトライン表示
- **文字数カウンター**: タイトル・記録内容の下部に表示

### テンプレート機能UI

- **テンプレート選択**: ドロップダウンで既存テンプレート表示
- **テンプレート適用**: 選択と同時に記録内容フィールドに文章を挿入
- **テンプレート作成**: モーダルダイアログで新規テンプレート作成
- **テンプレートプレビュー**: 選択前にテンプレート内容をプレビュー表示

### 添付ファイル機能UI

- **ドラッグ&ドロップ**: ファイルをフォーム上にドラッグしてアップロード
- **ファイル選択ボタン**: 画像・動画それぞれに専用ボタン
- **プレビュー表示**: アップロード後に縮小画像・動画サムネイル表示
- **進行状況表示**: アップロード中のプログレスバー表示
- **削除ボタン**: 各添付ファイルに削除ボタン配置

### アニメーション

- **ボタンホバー**: スムーズなカラートランジション
- **フォーム送信**: ローディング状態の表示（「作成中...」「保存中...」）
- **アラート表示**: フェードイン効果でアラート表示
- **バリデーション**: リアルタイムでエラーメッセージ表示・非表示
- **ファイルアップロード**: スムーズなプレビュー表示アニメーション

### アクセシビリティ

- **キーボードナビゲーション**: Tabキーでの順次フォーカス移動
- **スクリーンリーダー**:
  - 適切なlabel要素の関連付け
  - 必須項目のaria-required属性
  - エラーメッセージのaria-describedby属性
  - ファイルアップロード状態のaria-live属性
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスリング表示

### ローディング・無効化状態

- **送信中状態**:
  - 全フォーム要素の無効化
  - 送信ボタンテキストを「作成中...」に変更
  - 下書き保存ボタンの無効化
- **下書き保存中状態**:
  - 下書き保存ボタンテキストを「保存中...」に変更
  - 送信ボタンの無効化
- **ファイルアップロード中状態**:
  - アップロード中のプログレスバー表示
  - 該当ファイルボタンの無効化
- **バリデーションエラー時**:
  - 該当フィールドの赤色ボーダー表示
  - エラーメッセージの即座表示

## 技術仕様

### 使用コンポーネント

#### 2_molecules層

- **CareRecordForm**: 介護記録作成・編集フォーム
- **StaffSelector**: お知らせ職員選択
- **ResidentSelector**: 対象利用者選択
- **TemplateSelector**: テンプレート選択・適用
- **AttachmentUpload**: ファイルアップロード
- **AttachmentList**: 添付ファイル一覧

#### 1_atoms層

- **CategoryBadge**: 記録種別バッジ表示
- **PriorityBadge**: 重要度バッジ表示
- **StatusBadge**: ステータスバッジ表示
- **AlertSwitch**: アラート切り替えスイッチ
- **FilePreview**: ファイルプレビュー表示

#### カスタムフック

- **useCareRecordForm**: フォーム状態管理とバリデーション
- **useFileUpload**: ファイルアップロード処理
- **useTemplates**: テンプレート管理

### データ型定義

```typescript
interface CareRecordFormData {
  residentId: string; // 対象利用者ID（必須）
  category: CareRecordCategory; // 記録種別（必須）
  title: string; // タイトル（必須、100文字以内）
  content: string; // 記録内容（必須、1000文字以内）
  recordedAt: string; // 記録日時（必須）
  priority: CareRecordPriority; // 重要度（必須）
  status: CareRecordStatus; // ステータス（必須）
  notifyStaffIds: string[]; // お知らせ職員ID配列（任意）
  isAlert: boolean; // アラート設定（任意）
  attachments: AttachmentFile[]; // 添付ファイル（任意）
  templateId?: string; // 使用テンプレートID（任意）
}

interface AttachmentFile {
  id: string;
  type: 'image' | 'video';
  fileName: string;
  fileSize: number;
  mimeType: string;
  url: string;
  thumbnailUrl?: string;
}

interface CareRecordTemplate {
  id: string;
  name: string;
  content: string;
  category: CareRecordCategory;
  isPublic: boolean;
  createdBy: string;
  createdAt: string;
  usageCount: number;
}
```

### API仕様

| メソッド | エンドポイント                       | 説明                 |
| -------- | ------------------------------------ | -------------------- |
| POST     | `/api/v1/care-records`               | 介護記録新規作成     |
| POST     | `/api/v1/care-records/draft`         | 下書き保存           |
| PUT      | `/api/v1/care-records/{id}`          | 介護記録更新         |
| GET      | `/api/v1/care-records/drafts`        | 下書き一覧取得       |
| GET      | `/api/v1/care-record-templates`      | テンプレート一覧取得 |
| POST     | `/api/v1/care-record-templates`      | テンプレート新規作成 |
| PUT      | `/api/v1/care-record-templates/{id}` | テンプレート更新     |
| DELETE   | `/api/v1/care-record-templates/{id}` | テンプレート削除     |
| POST     | `/api/v1/attachments/images`         | 画像アップロード     |
| POST     | `/api/v1/attachments/videos`         | 動画アップロード     |
| DELETE   | `/api/v1/attachments/{id}`           | 添付ファイル削除     |
| GET      | `/api/v1/staff`                      | 職員一覧取得         |

### 状態管理

- **フォーム状態**: React Hook Form での入力値管理
- **添付ファイル状態**: useState でのファイルリスト管理
- **テンプレート状態**: SWR でのテンプレート一覧キャッシュ
- **エラー状態**: フォームエラー・API通信エラーの管理
- **ローディング状態**: 送信・保存・アップロード中の状態管理


## 画面遷移仕様

### 遷移先URL一覧

| 遷移元           | 遷移先               | URL                          | パラメータ       |
| ---------------- | -------------------- | ---------------------------- | ---------------- |
| 戻るボタン       | 介護記録一覧画面     | `/care-records`              | なし             |
| 分類編集リンク   | 記録種別設定画面     | `/settings/categories`       | なし             |
| テンプレート作成 | テンプレート作成画面 | `/care-record-templates/new` | なし             |
| 記録作成成功     | 記録詳細画面         | `/care-records/{recordId}`   | recordId: 記録ID |
| キャンセルボタン | 介護記録一覧画面     | `/care-records`              | なし             |
| 下書き保存成功   | 同一画面             | `/care-records/new`          | なし             |

### URLパラメータ仕様

#### 介護記録作成画面

```
/care-records/new?residentId={利用者ID}&category={記録種別}&templateId={テンプレートID}
```

**パラメータ詳細:**

- `residentId`: 対象利用者ID（文字列、任意）- 事前選択用
- `category`: 記録種別（文字列、任意）- 事前選択用
- `templateId`: テンプレートID（文字列、任意）- 事前適用用

#### 記録詳細画面

```
/care-records/{recordId}
```

**パラメータ詳細:**

- `recordId`: 記録ID（文字列、必須）

## 参考資料

### FlutterFlow画面デザイン

参考画像に基づく主要な UI 要素：

- **該当時間表示**: 日付・時刻を見やすく表示（07/14(月) 12:52）
- **分類選択**: ドロップダウンでの記録種別選択とカスタマイズリンク
- **利用者選択**: アイコン付きの利用者選択機能
- **アラート機能**: 重要な記録の場合のアラート切り替え
- **添付機能**: 画像・動画の添付ボタンを画面下部に配置
- **保存ボタン**: 画面右上に分かりやすく配置

### 関連ドキュメント

- [介護記録一覧画面設計書](../README.md)
- [CareRecordForm コンポーネント](../../../components/2_molecules/care-record/care-record-form.tsx)
- [useCareRecordForm フック](../../../hooks/useCareRecordForm.ts)
- [Care Record Types](../../../types/care-record.ts)
- [画面一覧](../../../docs/screen-list.md#申し送り介護記録)
