# 申し送り一覧画面設計書

画面名: `申し送り一覧`  
パス: `/handovers`  
URL: https://carebase-staff.vercel.app/handovers

## 概要

CareBase-staffアプリケーションの申し送り一覧画面設計書です。  
職員間の申し送り情報を一覧表示し、検索・フィルタリング機能、詳細表示、新規作成機能を提供します。  
未読・既読・対応済みのステータス管理と重要度による優先度表示を行います。

## 全体レイアウト

### 画面構成

申し送り管理のメイン画面として以下の要素で構成：

- ページヘッダー（統計情報）
- アクションボタン（メインメニュー戻る、新規作成）
- 検索・フィルター機能
- 申し送り一覧テーブル
- 空状態表示

### 画面項目

| 項目名               | コンポーネント    | 必須 | 表示条件     | 初期値                       | 備考                                     |
| -------------------- | ----------------- | ---- | ------------ | ---------------------------- | ---------------------------------------- |
| 統計情報             | 情報表示エリア    | -    | 常時         | 総件数・未読件数・表示中件数 | リアルタイム更新                         |
| 検索バー             | HandoverSearchBar | -    | 常時         | 空文字                       | 件名・内容・申し送り者名で検索           |
| メインメニューボタン | Button            | -    | 常時         | メインメニュー               | アウトライン、ArrowLeft アイコン         |
| 新規作成ボタン       | Button            | -    | 常時         | 新規申し送り作成             | 青色スタイル、MessageSquarePlus アイコン |
| 重要度フィルター     | Select            | -    | 常時         | すべて                       | 高/中/低での絞り込み                     |
| ステータスフィルター | Select            | -    | 常時         | すべて                       | 未読/既読/対応済みでの絞り込み           |
| リセットボタン       | Button            | -    | 常時         | リセット                     | フィルター条件をクリア                   |
| 申し送りテーブル     | Table             | -    | データあり時 | -                            | 申し送り情報の一覧表示                   |
| 空状態表示           | EmptyState        | -    | データなし時 | -                            | MessageCircle アイコン付きメッセージ     |

## 機能仕様

### デフォルト表示仕様

- **初期表示**: 未読の申し送りのみを表示（selectedStatus = 'unread'）
- **未読判定基準**:
  - `handover.status === 'unread'`
  - `handover.readAt` が未設定（null/undefined）
- **視覚的表示**:
  - 未読件数バッジをタイトル横に赤色で表示
  - 統計情報の未読件数を赤色・太字で強調
  - ステータスフィルターを青色でハイライト
  - 「未読のみ表示中」の状態表示

### アクション

| 項目名               | 処理内容                                 | 対象API                         | 遷移先画面                              |
| -------------------- | ---------------------------------------- | ------------------------------- | --------------------------------------- |
| 検索実行             | 件名・内容・申し送り者名での部分一致検索 | -                               | 同一画面（結果更新）                    |
| 重要度フィルター     | 重要度による絞り込み                     | -                               | 同一画面（結果更新）                    |
| ステータスフィルター | ステータスによる絞り込み                 | -                               | 同一画面（結果更新）                    |
| フィルターリセット   | 全フィルター条件をクリア                 | -                               | 同一画面（結果更新）                    |
| メインメニュー戻る   | メインメニュー画面への遷移               | -                               | メインメニュー画面 (`/`)                |
| 新規申し送り作成     | 新規申し送り作成画面への遷移             | -                               | 新規申し送り作成画面 (`/handovers/new`) |
| 申し送り詳細表示     | 選択した申し送りの詳細画面への遷移       | -                               | 申し送り詳細画面 (`/handovers/{id}`)    |
| ステータス更新       | 申し送りのステータスを更新               | `/api/v1/handovers/{id}/status` | 同一画面（ステータス更新）              |

### テーブル仕様

| 列名       | 幅   | 内容                        | ソート | 備考                   |
| ---------- | ---- | --------------------------- | ------ | ---------------------- |
| 申し送りID | 固定 | handover.id                 | -      | フォント: monospace    |
| 作成日時   | 固定 | MM/dd HH:mm形式             | ○      | 日本語ロケール         |
| 申し送り者 | 固定 | 申し送り者名                | ○      | User アイコン付き      |
| 件名       | 可変 | 件名 + 対象利用者名（任意） | ○      | リンク形式、青色       |
| 重要度     | 固定 | 高/中/低バッジ              | ○      | 色分けバッジ表示       |
| ステータス | 固定 | 未読/既読/対応済みバッジ    | ○      | 色分けバッジ表示       |
| 操作       | 固定 | 詳細ボタン                  | -      | Eye アイコン付きボタン |

### 入力チェック

| 項目名   | イベント | チェック内容              | エラーメッセージ                              |
| -------- | -------- | ------------------------- | --------------------------------------------- |
| 検索バー | input    | 文字数制限（100文字以内） | 検索キーワードは100文字以内で入力してください |
| 検索バー | input    | 特殊文字制限              | 使用できない文字が含まれています              |

### バリデーション仕様

#### 検索ロジック

- **部分一致検索**: 件名・内容・申し送り者名・対象利用者名で部分一致検索を実行
- **大文字小文字無視**: 検索時は大文字小文字を区別しない
- **リアルタイム検索**: 入力と同時に検索結果を更新
- **空文字処理**: 検索キーワードが空の場合は全件表示

#### 表示制御

- **未読強調**: 未読の申し送りは背景色を青色で強調表示
- **ステータス自動更新**: 詳細リンククリック時に未読→既読に自動更新
- **優先度表示**: 重要度に応じたバッジの色分け表示
- **レスポンシブ**: モバイル・タブレット・デスクトップ対応

#### エラーハンドリング

- 検索結果0件時の適切なメッセージ表示
- API通信エラー時のフォールバック表示
- データ読み込み失敗時のエラー表示

## UI/UX仕様

### レスポンシブデザイン

- **テーブル**: 横スクロール対応（モバイル）→ 固定幅表示（デスクトップ）
- **アクションボタン**: 縦積み（モバイル）→ 横並び（タブレット以上）
- **検索・フィルター**: 縦積み（モバイル）→ 横並び（デスクトップ）

### カラーテーマ

- **重要度バッジ**:
  - 高: `bg-red-100 text-red-700 border-red-200`
  - 中: `bg-yellow-100 text-yellow-700 border-yellow-200`
  - 低: `bg-blue-100 text-blue-700 border-blue-200`
- **ステータスバッジ**:
  - 未読: `bg-gray-100 text-gray-700 border-gray-200`
  - 既読: `bg-green-100 text-green-700 border-green-200`
  - 対応済み: `bg-blue-100 text-blue-700 border-blue-200`
- **新規作成ボタン**: `bg-carebase-blue hover:bg-carebase-blue-dark`
- **未読行**: `bg-blue-50` 背景色で強調

### アニメーション

- **テーブル行ホバー**: `hover:bg-gray-50 transition-colors`
- **ボタンホバー**: スムーズなカラートランジション
- **検索結果更新**: フェードイン・アウト効果
- **ステータス更新**: 即座のUI反映

### アクセシビリティ

- **キーボードナビゲーション**: Tab キーでの操作対応
- **スクリーンリーダー**: 適切な aria-label 設定
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスインジケーター

## 技術仕様

### 使用コンポーネント

#### 1_atoms層

- **PriorityBadge**: 重要度バッジ表示
- **StatusBadge**: ステータスバッジ表示

#### 2_molecules層

- **HandoverSearchBar**: 検索バー
- **HandoverFilters**: フィルター機能
- **HandoverTableRow**: テーブル行

#### 3_organisms層

- **HandoverList**: 申し送り一覧表示
- **HandoverDetail**: 申し送り詳細表示

### データ型定義

```typescript
interface Handover {
  id: string;
  title: string;
  content: string;
  priority: 'high' | 'medium' | 'low';
  status: 'unread' | 'read' | 'completed';
  createdBy: string;
  createdByName: string;
  targetStaffIds: string[];
  residentId?: string;
  residentName?: string;
  createdAt: string;
  updatedAt: string;
  readAt?: string;
  completedAt?: string;
}
```

### API エンドポイント

| メソッド | エンドポイント                  | 説明                   |
| -------- | ------------------------------- | ---------------------- |
| GET      | `/api/v1/handovers`             | 申し送り一覧取得       |
| GET      | `/api/v1/handovers/{id}`        | 申し送り詳細取得       |
| POST     | `/api/v1/handovers`             | 申し送り新規作成       |
| PUT      | `/api/v1/handovers/{id}/status` | 申し送りステータス更新 |
| DELETE   | `/api/v1/handovers/{id}`        | 申し送り削除           |

### 状態管理

- **ローカル状態**: 検索クエリ、フィルター条件、申し送りデータ
- **楽観的更新**: ステータス変更時の即座UI反映
- **エラー処理**: API通信エラー時のフォールバック

## 参考資料

- [申し送り一覧画面実装](./page.tsx)
- [HandoverList コンポーネント](../../../components/3_organisms/handover/handover-list.tsx)
- [HandoverTableRow コンポーネント](../../../components/2_molecules/handover/handover-table-row.tsx)
- [Handover Types](../../../types/handover.ts)
- [画面一覧](../../../docs/screen-list.md#申し送り介護記録)
