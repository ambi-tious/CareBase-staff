# 申し送り一覧画面設計書

画面名: `申し送り一覧`  
パス: `/handovers`  
URL: https://carebase-staff.vercel.app/handovers

## 概要

CareBase-staffアプリケーションの申し送り一覧画面設計書です。  
シフト交代時や日々の業務引き継ぎで利用者の状態や注意点を職員間で共有するための機能を提供します。  
利用者ベースとタイムラインの2つの表示モードを切り替えて使用でき、日付範囲検索、分類・キーワード検索、申し送り作成機能を提供します。  
未読・既読・対応済みのステータス管理と重要度による優先度表示を行います。

## 全体レイアウト

### 画面構成

申し送り管理のメイン画面として以下の要素で構成：

- ページヘッダー（統計情報、表示切り替えタブ）
- アクションボタン（メインメニュー戻る、新規作成）
- 日付範囲検索機能（デフォルト本日のみ）
- 分類・キーワード検索機能
- 利用者ベース表示（カンバン形式、利用者ごとにグルーピング）
- タイムライン表示（テーブル形式、時系列表示）
- 空状態表示

### 画面項目

| 項目名               | コンポーネント    | 必須 | 表示条件     | 初期値                       | 備考                                     |
| -------------------- | ----------------- | ---- | ------------ | ---------------------------- | ---------------------------------------- |
| 統計情報             | 情報表示エリア    | -    | 常時         | 総件数・未読件数・表示中件数 | リアルタイム更新                         |
| 表示切り替えタブ     | TabGroup          | -    | 常時         | タイムライン                 | 利用者ベース・タイムライン切り替え       |
| 日付範囲検索         | DateRangePicker   | -    | 常時         | 本日のみ                     | 範囲指定での日付絞り込み                 |
| 検索バー             | HandoverSearchBar | -    | 常時         | 空文字                       | 件名・内容・申し送り者名で検索           |
| メインメニューボタン | Button            | -    | 常時         | メインメニュー               | アウトライン、ArrowLeft アイコン         |
| 新規作成ボタン       | Button            | -    | 常時         | 新規申し送り作成             | 青色スタイル、MessageSquarePlus アイコン |
| 分類フィルター       | Select            | -    | 常時         | すべて                       | 医療/介護/連絡事項等での絞り込み         |
| 重要度フィルター     | Select            | -    | 常時         | すべて                       | 高/中/低での絞り込み                     |
| ステータスフィルター | Select            | -    | 常時         | すべて                       | 未読/既読/対応済みでの絞り込み           |
| リセットボタン       | Button            | -    | 常時         | リセット                     | フィルター条件をクリア                   |
| 利用者ベース表示     | KanbanView        | -    | 利用者ベース | -                            | カンバン形式、利用者ごとのカード表示     |
| タイムライン表示     | Table             | -    | タイムライン | -                            | テーブル形式、時系列での申し送り表示     |
| 空状態表示           | EmptyState        | -    | データなし時 | -                            | MessageCircle アイコン付きメッセージ     |

## 表示モード仕様

### 利用者ベース表示（カンバン形式）

利用者ごとにグルーピングされたカンバン形式での申し送り表示：

- **表示形式**: 利用者別の縦列カンバンレイアウト
- **カードコンテンツ**: 連絡予定と同じカード内容・機能
- **グルーピング**: 利用者（resident）ごとに縦列で分類
- **カード並び順**: 作成日時の新しい順（上から下へ）
- **レスポンシブ**: 横スクロール対応（モバイル）
- **対象利用者なし**: 「共通事項」列に表示

#### カンバン列構成

| 列名           | 表示条件           | 並び順         | 備考                           |
| -------------- | ------------------ | -------------- | ------------------------------ |
| 共通事項       | residentId未設定   | 固定（左端）   | 施設全体・職員全体への申し送り |
| 利用者別列     | residentId設定済み | 利用者名順     | 各利用者への個別申し送り       |
| 空列表示       | 該当申し送りなし   | -              | 「申し送りなし」メッセージ     |

### タイムライン表示（テーブル形式）

時系列でのテーブル形式申し送り表示：

- **表示形式**: テーブル形式での一覧表示
- **並び順**: 古いものが上（作成日時昇順）
- **ページング**: 20件/ページ
- **行クリック**: 詳細画面への遷移
- **未読強調**: 未読申し送りの背景色強調

## 機能仕様

### 表示切り替え機能

- **初期表示**: タイムライン表示（既存仕様維持）
- **切り替え**: タブクリックで即座に表示変更
- **状態保持**: セッション内で選択状態を保持
- **フィルター**: 表示切り替え時もフィルター条件を維持

### 日付範囲検索機能

- **デフォルト**: 本日のみ（createdAt が本日）
- **範囲指定**: 開始日・終了日での期間絞り込み
- **クイック選択**: 今日・昨日・今週・今月のプリセット
- **クリア機能**: 日付条件のリセット


### デフォルト表示仕様

- **初期表示**: 未読の申し送りのみを表示（selectedStatus = 'unread'）
- **未読判定基準**:
  - `handover.status === 'unread'`
  - `handover.readAt` が未設定（null/undefined）
- **視覚的表示**:
  - 未読件数バッジをタイトル横に赤色で表示
  - 統計情報の未読件数を赤色・太字で強調
  - ステータスフィルターを青色でハイライト
  - 「未読のみ表示中」の状態表示

### アクション

| 項目名               | 処理内容                                 | 対象API                         | 遷移先画面                              |
| -------------------- | ---------------------------------------- | ------------------------------- | --------------------------------------- |
| 表示切り替え         | 利用者ベース・タイムライン表示の切り替え | -                               | 同一画面（表示モード変更）              |
| 日付範囲検索         | 指定期間での申し送り絞り込み             | -                               | 同一画面（結果更新）                    |
| 検索実行             | 件名・内容・申し送り者名での部分一致検索 | -                               | 同一画面（結果更新）                    |
| 分類フィルター       | カテゴリによる絞り込み                   | -                               | 同一画面（結果更新）                    |
| 重要度フィルター     | 重要度による絞り込み                     | -                               | 同一画面（結果更新）                    |
| ステータスフィルター | ステータスによる絞り込み                 | -                               | 同一画面（結果更新）                    |
| フィルターリセット   | 全フィルター条件をクリア                 | -                               | 同一画面（結果更新）                    |
| メインメニュー戻る   | メインメニュー画面への遷移               | -                               | メインメニュー画面 (`/`)                |
| 新規申し送り作成     | 新規申し送り作成画面への遷移             | -                               | 新規申し送り作成画面 (`/handovers/new`) |
| 申し送り詳細表示     | 選択した申し送りの詳細画面への遷移       | -                               | 申し送り詳細画面 (`/handovers/{id}`)    |
| ステータス更新       | 申し送りのステータスを更新               | `/api/v1/handovers/{id}/status` | 同一画面（ステータス更新）              |

### テーブル仕様（タイムライン表示）

| 列名       | 幅   | 内容                        | ソート | 備考                   |
| ---------- | ---- | --------------------------- | ------ | ---------------------- |
| 申し送りID | 固定 | handover.id                 | -      | フォント: monospace    |
| 作成日時   | 固定 | MM/dd HH:mm形式             | ○      | 日本語ロケール         |
| 申し送り者 | 固定 | 申し送り者名                | ○      | User アイコン付き      |
| 件名       | 可変 | 件名 + 対象利用者名（任意） | ○      | リンク形式、青色       |
| 重要度     | 固定 | 高/中/低バッジ              | ○      | 色分けバッジ表示       |
| ステータス | 固定 | 未読/既読/対応済みバッジ    | ○      | 色分けバッジ表示       |
| 操作       | 固定 | 詳細ボタン                  | -      | Eye アイコン付きボタン |

### カンバン仕様（利用者ベース表示）

#### カラム構成
- **固定カラム**: 共通事項（residentId未設定の申し送り）
- **動的カラム**: 各利用者別（residentName基準）
- **カラム幅**: 固定幅（320px）、横スクロール対応
- **カラム並び**: 共通事項 → 利用者名順

#### カード仕様
| 項目名     | 内容                        | 表示形式              | 備考                       |
| ---------- | --------------------------- | --------------------- | -------------------------- |
| 件名       | handover.title              | タイトル形式、太字    | クリックで詳細画面遷移     |
| 内容       | handover.content            | 3行省略表示           | ホバーで全文ツールチップ   |
| 作成日時   | MM/dd HH:mm形式             | 小さめテキスト        | 右上表示                   |
| 申し送り者 | handover.createdByName      | User アイコン付き     | 左下表示                   |
| 重要度     | 高/中/低バッジ              | 色分けバッジ          | 右下表示                   |
| ステータス | 未読/既読/対応済みバッジ    | 色分けバッジ          | 左上表示                   |
| 操作       | ステータス変更ボタン        | ドロップダウンメニュー | カードホバー時表示         |

#### ドラッグ＆ドロップ
- **対応範囲**: ステータス変更のみ（利用者間移動は不可）
- **未読→既読**: カード移動でステータス自動更新
- **既読→対応済み**: カード移動でステータス自動更新
- **視覚フィードバック**: ドラッグ中のカード強調表示

### 入力チェック

| 項目名       | イベント | チェック内容              | エラーメッセージ                              |
| ------------ | -------- | ------------------------- | --------------------------------------------- |
| 検索バー     | input    | 文字数制限（100文字以内） | 検索キーワードは100文字以内で入力してください |
| 検索バー     | input    | 特殊文字制限              | 使用できない文字が含まれています              |
| 日付範囲検索 | change   | 開始日 ≤ 終了日           | 開始日は終了日より前の日付を選択してください  |
| 日付範囲検索 | change   | 未来日制限                | 未来の日付は選択できません                    |

### バリデーション仕様

#### 検索・フィルタリングロジック

- **部分一致検索**: 件名・内容・申し送り者名・対象利用者名で部分一致検索を実行
- **大文字小文字無視**: 検索時は大文字小文字を区別しない
- **リアルタイム検索**: 入力と同時に検索結果を更新
- **空文字処理**: 検索キーワードが空の場合は全件表示
- **日付範囲フィルター**: createdAt が指定期間内の申し送りのみ表示
- **分類フィルター**: handover.category による絞り込み
- **複合フィルター**: 複数条件のAND検索

#### 表示制御

- **表示モード切り替え**: 利用者ベース・タイムライン間のスムーズな切り替え
- **未読強調**: 未読の申し送りは背景色を青色で強調表示
- **ステータス自動更新**: 詳細リンククリック時に未読→既読に自動更新
- **優先度表示**: 重要度に応じたバッジの色分け表示
- **日付フィルター保持**: 表示モード切り替え時もフィルター条件を維持
- **レスポンシブ**: モバイル・タブレット・デスクトップ対応

#### エラーハンドリング

- 検索結果0件時の適切なメッセージ表示
- API通信エラー時のフォールバック表示
- データ読み込み失敗時のエラー表示

## UI/UX仕様

### レスポンシブデザイン

#### タイムライン表示
- **テーブル**: 横スクロール対応（モバイル）→ 固定幅表示（デスクトップ）
- **アクションボタン**: 縦積み（モバイル）→ 横並び（タブレット以上）
- **検索・フィルター**: 縦積み（モバイル）→ 横並び（デスクトップ）

#### 利用者ベース表示
- **カンバン列**: 横スクロール対応（全デバイス）
- **カード**: 固定幅320px、縦積み表示
- **カラム数**: モバイル2列表示 → タブレット3列 → デスクトップ4列+
- **タブ切り替え**: 横スクロール対応（多数タブ時）

### カラーテーマ

- **表示切り替えタブ**:
  - アクティブ: `bg-carebase-blue text-white`
  - 非アクティブ: `bg-gray-100 text-gray-700 hover:bg-gray-200`
- **重要度バッジ**:
  - 高: `bg-red-100 text-red-700 border-red-200`
  - 中: `bg-yellow-100 text-yellow-700 border-yellow-200`
  - 低: `bg-blue-100 text-blue-700 border-blue-200`
- **ステータスバッジ**:
  - 未読: `bg-gray-100 text-gray-700 border-gray-200`
  - 既読: `bg-green-100 text-green-700 border-green-200`
  - 対応済み: `bg-blue-100 text-blue-700 border-blue-200`
- **カンバンカード**:
  - 通常: `bg-white border-gray-200 hover:shadow-md`
  - 未読: `bg-blue-50 border-blue-200`
  - ドラッグ中: `bg-white shadow-lg border-carebase-blue`
- **新規作成ボタン**: `bg-carebase-blue hover:bg-carebase-blue-dark`
- **未読行**: `bg-blue-50` 背景色で強調

### アニメーション

- **表示切り替え**: タブ間のスムーズなトランジション（300ms）
- **カンバンカード**: ホバー時の elevation 変化、ドラッグ中のスケール変化
- **テーブル行ホバー**: `hover:bg-gray-50 transition-colors`
- **ボタンホバー**: スムーズなカラートランジション
- **検索結果更新**: フェードイン・アウト効果
- **ステータス更新**: 即座のUI反映
- **日付フィルター**: 結果表示時のフェードイン効果

### アクセシビリティ

- **キーボードナビゲーション**: Tab キーでの操作対応
- **スクリーンリーダー**: 適切な aria-label 設定
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスインジケーター

## 技術仕様

### 使用コンポーネント

#### 1_atoms層

- **PriorityBadge**: 重要度バッジ表示
- **StatusBadge**: ステータスバッジ表示
- **CategoryBadge**: 分類バッジ表示

#### 2_molecules層

- **HandoverSearchBar**: 検索バー
- **HandoverFilters**: フィルター機能
- **HandoverTableRow**: テーブル行（タイムライン用）
- **HandoverCard**: カンバンカード（利用者ベース用）
- **DateRangePicker**: 日付範囲選択
- **ViewToggleTabs**: 表示切り替えタブ

#### 3_organisms層

- **HandoverList**: 申し送り一覧表示（統合コンポーネント）
- **HandoverTimelineView**: タイムライン表示
- **HandoverKanbanView**: カンバン表示
- **HandoverDetail**: 申し送り詳細表示

### データ型定義

```typescript
interface Handover {
  id: string;
  title: string;
  content: string;
  priority: 'high' | 'medium' | 'low';
  status: 'unread' | 'read' | 'completed';
  createdBy: string;
  createdByName: string;
  targetStaffIds: string[];
  residentId?: string;
  residentName?: string;
  createdAt: string;
  updatedAt: string;
  readAt?: string;
  completedAt?: string;
}
```

### API エンドポイント

| メソッド | エンドポイント                  | 説明                   |
| -------- | ------------------------------- | ---------------------- |
| GET      | `/api/v1/handovers`             | 申し送り一覧取得       |
| GET      | `/api/v1/handovers/{id}`        | 申し送り詳細取得       |
| POST     | `/api/v1/handovers`             | 申し送り新規作成       |
| PUT      | `/api/v1/handovers/{id}/status` | 申し送りステータス更新 |
| DELETE   | `/api/v1/handovers/{id}`        | 申し送り削除           |

### 状態管理

- **ローカル状態**: 
  - 検索クエリ、フィルター条件、申し送りデータ
  - 表示モード（利用者ベース・タイムライン）
  - 日付範囲フィルター（開始日・終了日）
  - 利用者別グルーピングデータ（カンバン用）
- **楽観的更新**: ステータス変更時の即座UI反映
- **エラー処理**: API通信エラー時のフォールバック
- **セッション保持**: 表示モード・フィルター状態の保持

## 参考資料

### FlutterFlow 参考画面
- **利用者ベース表示**: https://carebase.flutterflow.app/annoucementKanban
- **タイムライン表示**: https://carebase.flutterflow.app/annoucementTimeline

### 実装関連資料
- [申し送り一覧画面実装](./page.tsx)
- [HandoverList コンポーネント](../../../components/3_organisms/handover/handover-list.tsx)
- [HandoverTableRow コンポーネント](../../../components/2_molecules/handover/handover-table-row.tsx)
- [Handover Types](../../../types/handover.ts)
- [画面一覧](../../../docs/screen-list.md#申し送り介護記録)
