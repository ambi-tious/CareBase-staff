# 申し送り登録画面設計書

画面名: `申し送り登録`  
パス: `/handovers/new`  
URL: https://carebase-staff.vercel.app/handovers/new

## 概要

CareBase-staffアプリケーションの申し送り登録画面設計書です。  
医療・介護現場での職員間の情報共有を効率化するため、申し送り内容の登録・編集機能を提供します。  
利用者・職員選択、分類・重要度・内容入力、テンプレート文章機能、画像・動画添付、下書き機能により、総合的な申し送り管理を実現します。

Issue: [#036 [設計] #036 申し送り・介護記録｜申し送り登録](https://github.com/ambi-tious/CareBase-staff/issues/71)

## 全体レイアウト

### 画面構成

<img width="1041" height="1127" alt="申し送り登録画面" src="https://github.com/user-attachments/assets/89980d2d-f34b-457a-9073-b3d414081065" />

申し送り登録のメイン画面として以下の要素で構成：

- ページヘッダー（画面タイトル、説明文、戻るボタン）
- 成功・エラーメッセージ表示エリア
- 申し送り登録フォーム（2列レイアウト）
- テンプレート選択・管理機能
- 画像・動画添付機能
- アクションボタン（キャンセル、下書き保存、登録）

### 画面項目

| 項目名               | コンポーネント       | 必須 | 表示条件           | 初期値             | 備考                                                   |
| -------------------- | -------------------- | ---- | ------------------ | ------------------ | ------------------------------------------------------ |
| 戻るボタン           | Button               | -    | 常時               | 戻る               | アウトライン、ArrowLeft アイコン                       |
| 画面タイトル         | Heading              | -    | 常時               | 新規申し送り登録   | MessageSquarePlus アイコン付き                         |
| 説明文               | Text                 | -    | 常時               | 登録説明           | 必須項目マークの説明含む                               |
| 成功メッセージ       | Alert                | -    | 登録成功時         | -                  | 緑色背景、CheckCircle アイコン                         |
| エラーアラート       | Alert                | -    | 登録エラー時       | -                  | 赤色背景、エラーメッセージ表示                         |
| 申し送り者表示       | InfoDisplay          | -    | 常時               | ログインユーザー名 | 青色背景、User アイコン付き                            |
| 件名入力             | FormField            | ◯    | 常時               | 空文字             | テキスト入力、プレースホルダー「佐藤様の血圧について」 |
| 分類選択             | FormSelect           | ◯    | 常時               | 連絡事項           | 医療/介護/連絡事項/緊急/家族対応/その他                |
| 重要度選択           | FormSelect           | ◯    | 常時               | 中                 | 高/中/低                                               |
| 実施予定日入力       | FormField            | -    | 常時               | 今日の日付         | 日付入力                                               |
| 実施予定時刻入力     | FormField            | -    | 常時               | 現在時刻           | 時刻入力                                               |
| お知らせ職員選択     | StaffSelector        | ◯    | 常時               | 空配列             | 複数選択可能、検索機能付き                             |
| 対象利用者選択       | ResidentSelector     | -    | 常時               | 未選択             | 単一選択、検索機能付き                                 |
| テンプレート選択     | TemplateSelector     | -    | 常時               | 未選択             | プリセットテンプレート選択、カスタムテンプレート作成   |
| テンプレート管理     | TemplateManager      | -    | テンプレート選択時 | -                  | テンプレート編集・削除・新規作成                       |
| 申し送り内容入力     | Textarea             | ◯    | 常時               | 空文字/テンプレート| 大きなテキストエリア、1000文字制限                     |
| 画像添付             | FileUpload           | -    | 常時               | 空配列             | 複数画像選択、プレビューあり、5MB/ファイル制限         |
| 動画添付             | FileUpload           | -    | 常時               | 空配列             | 動画ファイル選択、プレビューあり、50MB/ファイル制限    |
| 添付ファイル一覧     | AttachmentList       | -    | 添付ファイルあり時 | -                  | 添付されたファイルの一覧とプレビュー                   |
| 未保存変更警告       | Alert                | -    | 変更あり時         | -                  | 黄色背景、AlertCircle アイコン                         |
| キャンセルボタン     | Button               | -    | 常時               | キャンセル         | アウトライン                                           |
| 下書き保存ボタン     | Button               | -    | 常時               | 下書き保存         | アウトライン、Save アイコン                            |
| 登録ボタン           | Button               | -    | 常時               | 申し送りを登録     | 青色スタイル、Send アイコン                            |

## 機能仕様

### 利用者・職員選択機能

#### 利用者選択（ResidentSelector）

| 機能項目         | 仕様内容                                 | 備考                           |
| ---------------- | ---------------------------------------- | ------------------------------ |
| 選択方式         | 単一選択（ラジオボタン）                 | 最大1名まで選択可能            |
| 検索機能         | 名前・フリガナ・部屋番号による部分一致検索| リアルタイム検索               |
| 表示項目         | 利用者名、フリガナ、年齢、部屋番号       | 写真サムネイル付き（将来予定） |
| ソート順         | 部屋番号昇順→名前50音順                  | デフォルトソート               |
| 選択状態表示     | 青色背景で選択中利用者をハイライト       | CheckCircle アイコン表示       |
| 未選択時表示     | 「対象利用者を選択してください」         | プレースホルダー表示           |

#### 職員選択（StaffSelector）

| 機能項目         | 仕様内容                                 | 備考                           |
| ---------------- | ---------------------------------------- | ------------------------------ |
| 選択方式         | 複数選択（チェックボックス）             | 最低1名、最大10名まで選択可能  |
| 検索機能         | 名前・部署・役職による部分一致検索       | リアルタイム検索               |
| 表示項目         | 職員名、部署名、役職、オンライン状態     | アバター画像付き               |
| フィルター機能   | 部署別・役職別・オンライン状態別絞り込み | 複数条件同時適用可能           |
| 選択状態表示     | 青色背景で選択中職員をハイライト         | チェックマーク表示             |
| 選択数表示       | 「3名選択中」のような選択数カウンター    | 上限到達時は赤色警告表示       |

### テンプレート文章機能

#### プリセットテンプレート

| テンプレート分類 | テンプレート例                           | 利用場面                       |
| ---------------- | ---------------------------------------- | ------------------------------ |
| 医療関連         | 「○○様の血圧が[数値]でした。」           | バイタルサイン報告             |
| 介護関連         | 「○○様の入浴介助で[詳細]がありました。」 | 日常ケア報告                   |
| 緊急対応         | 「緊急：○○様に[症状]が見られます。」     | 緊急事態報告                   |
| 家族対応         | 「○○様のご家族より[内容]のご連絡。」     | 家族とのやり取り報告           |
| 連絡事項         | 「○○について[詳細]をお知らせします。」   | 一般的な連絡事項               |

#### カスタムテンプレート管理

| 機能項目         | 仕様内容                                 | 備考                           |
| ---------------- | ---------------------------------------- | ------------------------------ |
| 作成機能         | フリーテキストでオリジナルテンプレート作成| 500文字以内                    |
| 編集機能         | 既存テンプレートの内容変更               | プリセットテンプレートは編集不可|
| 削除機能         | カスタムテンプレートの削除               | 確認ダイアログ表示             |
| 分類機能         | テンプレートを分類別に整理               | 医療/介護/緊急/家族/連絡/その他|
| お気に入り機能   | よく使うテンプレートをお気に入り登録     | 上部に優先表示                 |
| 利用頻度表示     | テンプレートの使用回数を表示             | 人気順ソート機能               |

#### テンプレート適用機能

| 機能項目         | 仕様内容                                 | 備考                           |
| ---------------- | ---------------------------------------- | ------------------------------ |
| 選択方式         | ドロップダウン選択またはモーダル選択     | 検索機能付き                   |
| プレビュー機能   | 選択前にテンプレート内容をプレビュー表示 | 適用前確認                     |
| 置換機能         | [利用者名][日付]等の動的置換             | 自動的に実データに置換         |
| 追記機能         | テンプレート適用後に追加編集可能         | テンプレート＋自由記述         |
| 履歴機能         | 最近使用したテンプレート履歴表示         | 最大10件まで履歴保持           |

### 画像・動画添付機能

#### 画像添付仕様

| 機能項目         | 仕様内容                                 | 備考                           |
| ---------------- | ---------------------------------------- | ------------------------------ |
| 対応形式         | JPEG, PNG, GIF, WebP                    | 画像ファイルのみ               |
| ファイルサイズ   | 最大5MB/ファイル                         | 合計最大50MB                   |
| 添付可能数       | 最大10ファイル                           | 制限数到達時は追加不可         |
| アップロード方式 | ドラッグ&ドロップまたはファイル選択      | 複数ファイル同時選択可能       |
| プレビュー表示   | サムネイル画像（150x150px）表示          | クリックで拡大表示             |
| 画像編集         | 回転・トリミング機能（将来実装予定）     | 基本的な編集機能               |

#### 動画添付仕様

| 機能項目         | 仕様内容                                 | 備考                           |
| ---------------- | ---------------------------------------- | ------------------------------ |
| 対応形式         | MP4, MOV, AVI, WebM                      | 一般的な動画形式               |
| ファイルサイズ   | 最大50MB/ファイル                        | 合計最大200MB                  |
| 添付可能数       | 最大3ファイル                            | 動画は容量が大きいため制限     |
| プレビュー表示   | 動画サムネイル＋再生時間表示             | インライン再生可能             |
| 圧縮機能         | 自動圧縮によるファイルサイズ最適化       | 画質とサイズのバランス調整     |

#### 添付ファイル管理

| 機能項目         | 仕様内容                                 | 備考                           |
| ---------------- | ---------------------------------------- | ------------------------------ |
| ファイル一覧表示 | 添付ファイルをカード形式で一覧表示       | ファイル名・サイズ・プレビュー |
| 削除機能         | 個別ファイルの削除                       | 確認なしで即座削除             |
| 並び替え機能     | ドラッグ&ドロップでファイル順序変更      | 表示順序の調整                 |
| ダウンロード機能 | 添付ファイルのダウンロード               | 元ファイル形式で保存           |
| エラーハンドリング| アップロード失敗時のエラー表示とリトライ| 自動リトライ機能付き           |

### 下書き機能

#### 下書き保存仕様

| 機能項目         | 仕様内容                                 | 備考                           |
| ---------------- | ---------------------------------------- | ------------------------------ |
| 自動保存         | 30秒間隔での自動下書き保存               | バックグラウンド実行           |
| 手動保存         | 下書き保存ボタンクリックでの即座保存     | 成功時は緑色メッセージ表示     |
| 保存対象データ   | 全フォーム入力内容＋添付ファイル         | 未完成でも保存可能             |
| 下書き一覧       | 保存済み下書きの一覧表示・選択機能       | 作成日時・件名で識別           |
| 復元機能         | 下書きデータからのフォーム復元           | 確認ダイアログ付き             |
| 削除機能         | 不要下書きの削除                         | 一括削除機能付き               |

### アクション

| 項目名               | 処理内容                               | 対象API                            | 遷移先画面                      |
| -------------------- | -------------------------------------- | ---------------------------------- | ------------------------------- |
| 戻るボタン           | 申し送り一覧画面に戻る                 | -                                  | 申し送り一覧画面 (`/handovers`) |
| 利用者検索           | 利用者一覧の検索・フィルタリング       | `GET /api/v1/residents/search`     | 同一画面（検索結果更新）        |
| 職員検索             | 職員一覧の検索・フィルタリング         | `GET /api/v1/staff/search`         | 同一画面（検索結果更新）        |
| テンプレート選択     | テンプレート内容の申し送り欄への適用   | `GET /api/v1/handover-templates`   | 同一画面（内容自動入力）        |
| テンプレート作成     | 新規カスタムテンプレートの作成         | `POST /api/v1/handover-templates`  | 同一画面（テンプレート追加）    |
| テンプレート編集     | 既存カスタムテンプレートの編集         | `PUT /api/v1/handover-templates/{id}` | 同一画面（テンプレート更新）    |
| テンプレート削除     | カスタムテンプレートの削除             | `DELETE /api/v1/handover-templates/{id}` | 同一画面（テンプレート削除） |
| 画像アップロード     | 画像ファイルのアップロード             | `POST /api/v1/files/upload`        | 同一画面（プレビュー表示）      |
| 動画アップロード     | 動画ファイルのアップロード             | `POST /api/v1/files/upload`        | 同一画面（プレビュー表示）      |
| 添付ファイル削除     | アップロード済みファイルの削除         | `DELETE /api/v1/files/{id}`        | 同一画面（添付一覧更新）        |
| フォーム入力         | リアルタイムバリデーション実行         | -                                  | 同一画面（エラー表示更新）      |
| 下書き保存           | 入力内容を下書きとして保存             | `POST /api/v1/handovers/draft`     | 同一画面（成功メッセージ表示）  |
| 下書き読み込み       | 保存済み下書きの読み込み・復元         | `GET /api/v1/handovers/drafts`     | 同一画面（フォーム復元）        |
| 登録ボタン           | 申し送りを確定して登録                 | `POST /api/v1/handovers`           | 申し送り一覧画面 (`/handovers`) |
| キャンセルボタン     | 入力内容を破棄して一覧に戻る           | -                                  | 申し送り一覧画面 (`/handovers`) |

### 入力チェック

| 項目名             | イベント | チェック内容                     | エラーメッセージ                         |
| ------------------ | -------- | -------------------------------- | ---------------------------------------- |
| 件名入力           | blur     | 必須チェック                     | 件名は必須です                           |
| 件名入力           | blur     | 文字数チェック（100文字以内）    | 件名は100文字以内で入力してください      |
| 分類選択           | change   | 必須選択チェック                 | 分類は必須です                           |
| 重要度選択         | change   | 必須選択チェック                 | 重要度は必須です                         |
| お知らせ職員選択   | change   | 必須選択チェック                 | お知らせする職員を選択してください       |
| お知らせ職員選択   | change   | 選択数上限チェック（10名以内）   | 選択できる職員は10名までです             |
| 申し送り内容       | blur     | 必須チェック                     | 内容は必須です                           |
| 申し送り内容       | input    | 文字数チェック（1000文字以内）   | 内容は1000文字以内で入力してください     |
| 画像アップロード   | upload   | ファイルサイズチェック（5MB以内）| ファイルサイズは5MB以下にしてください    |
| 画像アップロード   | upload   | ファイル形式チェック             | 対応していない画像形式です               |
| 画像アップロード   | upload   | ファイル数制限チェック（10個以内）| 画像は10個まで添付可能です               |
| 動画アップロード   | upload   | ファイルサイズチェック（50MB以内）| 動画ファイルは50MB以下にしてください     |
| 動画アップロード   | upload   | ファイル形式チェック             | 対応していない動画形式です               |
| 動画アップロード   | upload   | ファイル数制限チェック（3個以内）| 動画は3個まで添付可能です                |
| 合計容量チェック   | upload   | 全添付ファイル合計容量チェック   | 添付ファイルの合計容量が上限を超えています|
| テンプレート作成   | submit   | テンプレート名必須チェック       | テンプレート名は必須です                 |
| テンプレート作成   | submit   | テンプレート内容必須チェック     | テンプレート内容は必須です               |
| フォーム登録       | submit   | 全必須項目チェック               | 必須項目をすべて入力してください         |

### バリデーション仕様

#### リアルタイムバリデーション

- **入力時検証**: フォーム項目への入力と同時にバリデーションを実行
- **エラー表示**: 各項目下部に赤色でエラーメッセージを表示
- **登録制御**: バリデーションエラーがある場合は登録ボタンクリック時に登録を阻止

#### 文字数制限

- **件名**: 100文字以内
- **申し送り内容**: 1000文字以内、リアルタイム文字数表示
- **テンプレート名**: 50文字以内
- **テンプレート内容**: 500文字以内
- **文字数表示**: 入力中の文字数を「xxx/1000文字」形式で表示

#### ファイル添付制限

- **画像ファイル**: 個別5MB以内、合計最大10個
- **動画ファイル**: 個別50MB以内、合計最大3個
- **総容量制限**: 全添付ファイル合計200MB以内
- **対応形式**: 
  - 画像: JPEG, PNG, GIF, WebP
  - 動画: MP4, MOV, AVI, WebM

#### 下書き保存仕様

- **バリデーション**: 下書き保存時は必須項目チェックを緩和
- **自動保存**: 30秒間隔での自動下書き保存
- **復元機能**: 下書きからのフォーム内容復元
- **保存期間**: 下書きは30日間保持

#### エラーハンドリング

| エラー種別               | 発生条件                           | 表示メッセージ                                               | 表示場所           |
| ------------------------ | ---------------------------------- | ------------------------------------------------------------ | ------------------ |
| API通信エラー            | ネットワーク接続エラー             | ネットワークエラーが発生しました。接続を確認してもう一度お試しください。| 画面上部アラート   |
| 申し送り登録エラー       | handoverService.createHandover失敗 | 申し送りの登録に失敗しました。もう一度お試しください。       | 画面上部アラート   |
| バリデーションエラー     | 必須項目未入力時の登録             | 入力内容に不備があります。必須項目を確認してください。       | 画面上部アラート   |
| ファイルサイズエラー     | ファイルサイズ制限超過             | ファイルサイズが制限を超えています。                         | ファイル選択エリア |
| ファイル形式エラー       | 対応外ファイル形式選択             | 対応していないファイル形式です。                             | ファイル選択エリア |
| 容量制限エラー           | 総容量制限超過                     | 添付ファイルの合計容量が上限を超えています。                 | ファイル選択エリア |
| テンプレート作成エラー   | テンプレート作成失敗               | テンプレートの作成に失敗しました。                           | テンプレート管理エリア|
| 下書き保存エラー         | 下書き保存失敗                     | 下書き保存に失敗しました。もう一度お試しください。           | 画面上部アラート   |
| フィールド個別エラー     | リアルタイムバリデーション         | 各項目固有のエラーメッセージ                                 | 該当フィールド下部 |

## UI/UX仕様

### レスポンシブデザイン

- **モバイル（〜768px）**:
  - フォーム項目を1列で縦並び表示
  - ボタンを全幅で縦積み配置
  - ファイル添付エリアを縦積み表示
  - テンプレート選択をモーダル表示
  - 余白を最小化してコンテンツエリアを最大化
- **タブレット（768px〜1024px）**:
  - フォーム項目を2列グリッドで表示
  - ボタンを右寄せで横並び配置
  - ファイル添付エリアを横並び表示
  - テンプレート選択をサイドパネル表示
- **デスクトップ（1024px〜）**:
  - フォーム全体の最大幅を6xlに制限
  - 2列グリッドレイアウトを維持
  - テンプレートエリアを右サイドに固定表示
  - 余白を十分に確保

### カラーテーマ

- **背景色**: `bg-carebase-bg` - アプリケーション標準背景色
- **登録ボタン**: `bg-carebase-blue hover:bg-carebase-blue-dark` - メインアクション
- **下書き保存ボタン**: `border-gray-400 text-gray-700 hover:bg-gray-50` - セカンダリアクション
- **戻る・キャンセルボタン**: `border-gray-300 text-gray-700` - セカンダリアクション
- **成功アラート**: `bg-green-50 border-green-200 text-green-700` - 成功状態
- **エラーアラート**: `bg-red-50 border-red-200 text-red-700` - エラー状態
- **警告アラート**: `bg-yellow-50 border-yellow-200 text-yellow-800` - 警告状態
- **申し送り者表示**: `bg-blue-50 border-blue-200 text-blue-800` - 情報表示
- **テンプレートエリア**: `bg-gray-50 border-gray-200` - セクション背景
- **ファイル添付エリア**: `border-2 border-dashed border-gray-300 hover:border-blue-400` - ドロップゾーン

### フォームUI仕様

- **入力フィールド間隔**: `gap-6` - 項目間の適切な間隔
- **セクション分割**: 基本情報・テンプレート・添付ファイル・申し送り先を明確に分離
- **ラベル配置**: 各入力フィールドの上部に配置
- **プレースホルダー**: 入力例を示すサンプルテキスト
- **フォーカス状態**: 青色のアウトライン表示
- **文字数カウンター**: 申し送り内容とテンプレート内容の下部に表示

### テンプレート選択UI

- **選択方式**: ドロップダウンまたはモーダル表示
- **プレビュー機能**: ホバー時にテンプレート内容をポップアップ表示
- **検索機能**: テンプレート名・内容での部分一致検索
- **カテゴリタブ**: 分類別でのテンプレート絞り込み
- **お気に入り表示**: スター印で人気テンプレートを識別
- **使用頻度表示**: 「(使用回数: 5回)」のような表示

### ファイル添付UI

#### ドラッグ&ドロップエリア

- **未添付時**: 点線ボーダー、Upload アイコン、「ファイルをドラッグまたは選択」テキスト
- **ドラッグオーバー時**: 青色ボーダー、背景色変更、「ここにドロップ」テキスト
- **アップロード中**: プログレスバー表示、「アップロード中...」テキスト

#### ファイルプレビュー

- **画像ファイル**: 150x150px サムネイル、ファイル名、サイズ表示
- **動画ファイル**: 動画サムネイル、再生時間、ファイル名、サイズ表示
- **削除ボタン**: 各ファイルに X ボタン配置
- **並び替え**: ドラッグ&ドロップでファイル順序変更

### アニメーション

- **ボタンホバー**: スムーズなカラートランジション
- **フォーム登録**: ローディング状態の表示（「登録中...」「保存中...」）
- **アラート表示**: フェードイン効果でアラート表示
- **バリデーション**: リアルタイムでエラーメッセージ表示・非表示
- **ファイルアップロード**: プログレスバーアニメーション
- **テンプレート適用**: 内容挿入時のスムーズなアニメーション

### アクセシビリティ

- **キーボードナビゲーション**: Tabキーでの順次フォーカス移動
- **スクリーンリーダー**:
  - 適切なlabel要素の関連付け
  - 必須項目のaria-required属性
  - エラーメッセージのaria-describedby属性
  - ファイル添付状態のaria-live属性
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスリング表示
- **代替テキスト**: アップロード画像に適切なalt属性

### ローディング・無効化状態

#### 登録中状態（isSubmitting: true）

- **フォーム全体**: `disabled={isSubmitting}` で全入力フィールドを無効化
- **戻るボタン**: クリック無効化で誤操作防止
- **キャンセルボタン**: クリック無効化で誤操作防止
- **登録ボタン**:
  - テキスト変更: 「登録」→「登録中...」
  - クリック無効化: `disabled={isSubmitting}`
  - ローディング表示: Spinner アイコン表示

#### 下書き保存中状態（isSaving: true）

- **下書き保存ボタン**:
  - テキスト変更: 「下書き保存」→「保存中...」
  - クリック無効化: `disabled={isSaving}`
  - ローディング表示: Spinner アイコン表示
- **自動保存表示**: 「自動保存済み (2分前)」のような表示

#### ファイルアップロード中状態

- **アップロードエリア**: プログレスバー表示
- **他ファイル選択**: 無効化
- **フォーム送信**: アップロード完了まで無効化

#### バリデーションエラー時の表示

- **該当フィールド**: 赤色ボーダー表示
- **エラーメッセージ**: フィールド下部に即座表示
- **登録制御**: エラーがある場合は登録処理を中断

## 技術仕様

### 使用コンポーネント

#### 2_molecules層

- **HandoverForm**: 申し送り登録・編集フォーム
- **StaffSelector**: お知らせ職員選択（複数選択対応）
- **ResidentSelector**: 対象利用者選択（単一選択）
- **TemplateSelector**: テンプレート選択・管理
- **FileUploadArea**: ファイルアップロード（画像・動画対応）
- **AttachmentList**: 添付ファイル一覧・管理

#### 1_atoms層

- **CategoryBadge**: 分類バッジ表示
- **PriorityBadge**: 重要度バッジ表示
- **StatusBadge**: ステータスバッジ表示
- **FilePreview**: ファイルプレビュー表示
- **ProgressBar**: アップロード進捗表示

#### カスタムフック

- **useHandoverForm**: フォーム状態管理とバリデーション
- **useFileUpload**: ファイルアップロード管理
- **useTemplate**: テンプレート管理
- **useDraftSave**: 下書き保存・復元機能

### データ型定義

```typescript
interface HandoverFormData {
  title: string; // 件名（必須、100文字以内）
  content: string; // 内容（必須、1000文字以内）
  category: HandoverCategory; // 分類（必須）
  priority: HandoverPriority; // 重要度（必須）
  targetStaffIds: string[]; // お知らせ職員（必須、1名以上10名以内）
  residentId?: string; // 対象利用者（任意）
  scheduledDate?: string; // 実施予定日（任意）
  scheduledTime?: string; // 実施予定時刻（任意）
  attachments: AttachmentFile[]; // 添付ファイル（任意）
  templateId?: string; // 使用テンプレートID（任意）
}

interface AttachmentFile {
  id: string;
  filename: string;
  fileType: 'image' | 'video';
  fileSize: number;
  mimeType: string;
  url: string;
  thumbnailUrl?: string; // 動画の場合
}

interface HandoverTemplate {
  id: string;
  name: string;
  content: string;
  category: HandoverCategory;
  isCustom: boolean; // カスタムテンプレートかどうか
  usageCount: number; // 使用回数
  isFavorite: boolean; // お気に入りかどうか
  createdBy?: string; // カスタムテンプレートの作成者
  createdAt: string;
  updatedAt: string;
}

interface DraftHandover {
  id: string;
  formData: Partial<HandoverFormData>;
  attachments: AttachmentFile[];
  createdAt: string;
  updatedAt: string;
  autoSaved: boolean; // 自動保存かどうか
}
```

### API仕様

| メソッド | エンドポイント                   | 説明                     | パラメータ              |
| -------- | -------------------------------- | ------------------------ | ----------------------- |
| POST     | `/api/v1/handovers`              | 申し送り新規登録         | HandoverFormData        |
| POST     | `/api/v1/handovers/draft`        | 下書き保存               | Partial<HandoverFormData>|
| GET      | `/api/v1/handovers/drafts`       | 下書き一覧取得           | -                       |
| GET      | `/api/v1/handovers/drafts/{id}`  | 特定下書き詳細取得       | draftId: string         |
| DELETE   | `/api/v1/handovers/drafts/{id}`  | 下書き削除               | draftId: string         |
| GET      | `/api/v1/handover-templates`     | テンプレート一覧取得     | category?: string       |
| POST     | `/api/v1/handover-templates`     | カスタムテンプレート作成 | TemplateCreateData      |
| PUT      | `/api/v1/handover-templates/{id}`| カスタムテンプレート更新 | TemplateUpdateData      |
| DELETE   | `/api/v1/handover-templates/{id}`| カスタムテンプレート削除 | templateId: string      |
| POST     | `/api/v1/files/upload`           | ファイルアップロード     | FormData (multipart)    |
| DELETE   | `/api/v1/files/{id}`             | ファイル削除             | fileId: string          |
| GET      | `/api/v1/residents/search`       | 利用者検索               | query: string           |
| GET      | `/api/v1/staff/search`           | 職員検索                 | query: string, dept?: string|

### 状態管理

#### フォーム状態

```typescript
interface HandoverFormState {
  formData: HandoverFormData;
  errors: Record<string, string>;
  isSubmitting: boolean;
  isSaving: boolean; // 下書き保存中
  isDirty: boolean; // 未保存変更あり
  lastSavedAt?: Date; // 最終保存日時
}
```

#### ファイルアップロード状態

```typescript
interface FileUploadState {
  files: AttachmentFile[];
  uploading: boolean;
  uploadProgress: Record<string, number>; // ファイルID → 進捗%
  errors: Record<string, string>; // ファイルID → エラーメッセージ
}
```

#### テンプレート状態

```typescript
interface TemplateState {
  templates: HandoverTemplate[];
  selectedTemplate?: HandoverTemplate;
  isCreating: boolean;
  isEditing: boolean;
  searchQuery: string;
  selectedCategory?: HandoverCategory;
}
```

### パフォーマンス最適化

#### 自動保存機能

- **保存間隔**: 30秒間隔で自動実行
- **条件判定**: フォーム内容に変更がある場合のみ実行
- **バックグラウンド実行**: UIブロックなしで実行
- **エラーハンドリング**: 失敗時は次回間隔で再試行

#### ファイルアップロード最適化

- **チャンク分割**: 大容量ファイルの分割アップロード
- **並列アップロード**: 複数ファイルの同時アップロード
- **リトライ機能**: アップロード失敗時の自動リトライ
- **プログレス表示**: リアルタイム進捗表示

#### データキャッシュ

- **利用者・職員データ**: 検索結果のメモリキャッシュ
- **テンプレートデータ**: LocalStorageによる永続化
- **下書きデータ**: IndexedDBによる大容量対応

## 参考資料

### FlutterFlow参考画像
![申し送り登録画面](https://github.com/user-attachments/assets/89980d2d-f34b-457a-9073-b3d414081065)

### 関連ドキュメント
- [申し送り一覧画面設計書](../README.md)
- [HandoverForm コンポーネント](../../../components/2_molecules/handover/handover-form.tsx)
- [TemplateSelector コンポーネント](../../../components/2_molecules/handover/template-selector.tsx)
- [FileUploadArea コンポーネント](../../../components/2_molecules/common/file-upload-area.tsx)
- [useHandoverForm フック](../../../hooks/useHandoverForm.ts)
- [useFileUpload フック](../../../hooks/useFileUpload.ts)
- [useTemplate フック](../../../hooks/useTemplate.ts)
- [Handover Types](../../../types/handover.ts)
- [Template Types](../../../types/template.ts)
- [File Types](../../../types/file.ts)
- [画面一覧](../../../docs/screen-list.md#申し送り介護記録)
