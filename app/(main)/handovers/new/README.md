# 申し送り作成画面設計書

画面名: `申し送り作成`  
パス: `/handovers/new`  
URL: https://carebase-staff.vercel.app/handovers/new

## 概要

CareBase-staffアプリケーションの申し送り作成画面設計書です。  
医療・介護現場での職員間の情報共有を効率化するため、申し送り内容の作成・編集機能を提供します。  
下書き保存機能により、作業の中断・再開が可能で、バリデーション機能により入力ミスを防止します。

## 全体レイアウト

### 画面構成

申し送り作成のメイン画面として以下の要素で構成：

- ページヘッダー（画面タイトル、説明文、戻るボタン）
- 成功・エラーメッセージ表示エリア
- 申し送り作成フォーム（2列レイアウト）
- アクションボタン（キャンセル、下書き保存、送信）

### 画面項目

| 項目名           | コンポーネント   | 必須 | 表示条件     | 初期値             | 備考                                                   |
| ---------------- | ---------------- | ---- | ------------ | ------------------ | ------------------------------------------------------ |
| 戻るボタン       | Button           | -    | 常時         | 戻る               | アウトライン、ArrowLeft アイコン                       |
| 画面タイトル     | Heading          | -    | 常時         | 新規申し送り作成   | MessageSquarePlus アイコン付き                         |
| 説明文           | Text             | -    | 常時         | 作成説明           | 必須項目マークの説明含む                               |
| 成功メッセージ   | Alert            | -    | 送信成功時   | -                  | 緑色背景、CheckCircle アイコン                         |
| エラーアラート   | Alert            | -    | 送信エラー時 | -                  | 赤色背景、エラーメッセージ表示                         |
| 申し送り者表示   | InfoDisplay      | -    | 常時         | ログインユーザー名 | 青色背景、User アイコン付き                            |
| 件名入力         | FormField        | ◯    | 常時         | 空文字             | テキスト入力、プレースホルダー「佐藤様の血圧について」 |
| カテゴリ選択     | FormSelect       | ◯    | 常時         | 連絡事項           | 医療/介護/連絡事項/緊急/家族対応/その他                |
| 重要度選択       | FormSelect       | ◯    | 常時         | 中                 | 高/中/低                                               |
| 実施予定日入力   | FormField        | -    | 常時         | 今日の日付         | 日付入力                                               |
| 実施予定時刻入力 | FormField        | -    | 常時         | 現在時刻           | 時刻入力                                               |
| 申し送り先選択   | StaffSelector    | ◯    | 常時         | 空配列             | 複数選択可能、検索機能付き                             |
| 対象利用者選択   | ResidentSelector | -    | 常時         | 未選択             | 単一選択、検索機能付き                                 |
| 申し送り内容入力 | Textarea         | ◯    | 常時         | 空文字             | 大きなテキストエリア、1000文字制限                     |
| 未保存変更警告   | Alert            | -    | 変更あり時   | -                  | 黄色背景、AlertCircle アイコン                         |
| キャンセルボタン | Button           | -    | 常時         | キャンセル         | アウトライン                                           |
| 下書き保存ボタン | Button           | -    | 常時         | 下書き保存         | アウトライン、Save アイコン                            |
| 送信ボタン       | Button           | -    | 常時         | 申し送りを送信     | 青色スタイル、Send アイコン                            |

## 機能仕様

### アクション

| 項目名           | 処理内容                       | 対象API                        | 遷移先画面                      |
| ---------------- | ------------------------------ | ------------------------------ | ------------------------------- |
| 戻るボタン       | 申し送り一覧画面に戻る         | -                              | 申し送り一覧画面 (`/handovers`) |
| フォーム入力     | リアルタイムバリデーション実行 | -                              | 同一画面（エラー表示更新）      |
| 下書き保存       | 入力内容を下書きとして保存     | `POST /api/v1/handovers/draft` | 同一画面（成功メッセージ表示）  |
| 送信ボタン       | 申し送りを確定して送信         | `POST /api/v1/handovers`       | 申し送り一覧画面 (`/handovers`) |
| キャンセルボタン | 入力内容を破棄して一覧に戻る   | -                              | 申し送り一覧画面 (`/handovers`) |

### 入力チェック

| 項目名         | イベント | チェック内容                   | エラーメッセージ                     |
| -------------- | -------- | ------------------------------ | ------------------------------------ |
| 件名入力       | blur     | 必須チェック                   | 件名は必須です                       |
| 件名入力       | blur     | 文字数チェック（100文字以内）  | 件名は100文字以内で入力してください  |
| カテゴリ選択   | change   | 必須選択チェック               | カテゴリは必須です                   |
| 重要度選択     | change   | 必須選択チェック               | 重要度は必須です                     |
| 申し送り先選択 | change   | 必須選択チェック               | 申し送り先を選択してください         |
| 申し送り内容   | blur     | 必須チェック                   | 内容は必須です                       |
| 申し送り内容   | input    | 文字数チェック（1000文字以内） | 内容は1000文字以内で入力してください |
| フォーム送信   | submit   | 全必須項目チェック             | 必須項目をすべて入力してください     |

### バリデーション仕様

#### リアルタイムバリデーション

- **入力時検証**: フォーム項目への入力と同時にバリデーションを実行
- **エラー表示**: 各項目下部に赤色でエラーメッセージを表示
- **送信制御**: バリデーションエラーがある場合は送信ボタンクリック時に送信を阻止

#### 文字数制限

- **件名**: 100文字以内
- **申し送り内容**: 1000文字以内、リアルタイム文字数表示
- **文字数表示**: 入力中の文字数を「xxx/1000文字」形式で表示

#### 下書き保存仕様

- **バリデーション**: 下書き保存時は必須項目チェックを緩和
- **自動保存**: 一定時間ごとの自動下書き保存（将来実装予定）
- **復元機能**: 下書きからの復元機能（将来実装予定）

#### エラーハンドリング

- **API通信エラー**: 「ネットワークエラーが発生しました。接続を確認してもう一度お試しください。」
- **バリデーションエラー**: 「入力内容に不備があります。必須項目を確認してください。」
- **送信エラー**: 「申し送りの送信に失敗しました。もう一度お試しください。」
- **下書き保存エラー**: 「下書き保存に失敗しました。もう一度お試しください。」

## UI/UX仕様

### レスポンシブデザイン

- **モバイル（〜768px）**:
  - フォーム項目を1列で縦並び表示
  - ボタンを全幅で縦積み配置
  - 余白を最小化してコンテンツエリアを最大化
- **タブレット（768px〜1024px）**:
  - フォーム項目を2列グリッドで表示
  - ボタンを右寄せで横並び配置
- **デスクトップ（1024px〜）**:
  - フォーム全体の最大幅を6xlに制限
  - 2列グリッドレイアウトを維持
  - 余白を十分に確保

### カラーテーマ

- **背景色**: `bg-carebase-bg` - アプリケーション標準背景色
- **送信ボタン**: `bg-carebase-blue hover:bg-carebase-blue-dark` - メインアクション
- **下書き保存ボタン**: `border-gray-400 text-gray-700 hover:bg-gray-50` - セカンダリアクション
- **戻る・キャンセルボタン**: `border-gray-300 text-gray-700` - セカンダリアクション
- **成功アラート**: `bg-green-50 border-green-200 text-green-700` - 成功状態
- **エラーアラート**: `bg-red-50 border-red-200 text-red-700` - エラー状態
- **警告アラート**: `bg-yellow-50 border-yellow-200 text-yellow-800` - 警告状態
- **申し送り者表示**: `bg-blue-50 border-blue-200 text-blue-800` - 情報表示

### フォームUI仕様

- **入力フィールド間隔**: `gap-6` - 項目間の適切な間隔
- **セクション分割**: 基本情報と申し送り先・対象者を明確に分離
- **ラベル配置**: 各入力フィールドの上部に配置
- **プレースホルダー**: 入力例を示すサンプルテキスト
- **フォーカス状態**: 青色のアウトライン表示
- **文字数カウンター**: 申し送り内容の下部に表示

### アニメーション

- **ボタンホバー**: スムーズなカラートランジション
- **フォーム送信**: ローディング状態の表示（「送信中...」「保存中...」）
- **アラート表示**: フェードイン効果でアラート表示
- **バリデーション**: リアルタイムでエラーメッセージ表示・非表示

### アクセシビリティ

- **キーボードナビゲーション**: Tabキーでの順次フォーカス移動
- **スクリーンリーダー**:
  - 適切なlabel要素の関連付け
  - 必須項目のaria-required属性
  - エラーメッセージのaria-describedby属性
- **コントラスト比**: WCAG 2.1 AA レベル準拠
- **フォーカス表示**: 明確なフォーカスリング表示

### ローディング・無効化状態

- **送信中状態**:
  - 全フォーム要素の無効化
  - 送信ボタンテキストを「送信中...」に変更
  - 下書き保存ボタンの無効化
- **下書き保存中状態**:
  - 下書き保存ボタンテキストを「保存中...」に変更
  - 送信ボタンの無効化
- **バリデーションエラー時**:
  - 該当フィールドの赤色ボーダー表示
  - エラーメッセージの即座表示

## 技術仕様

### 使用コンポーネント

#### 2_molecules層

- **HandoverForm**: 申し送り作成・編集フォーム
- **StaffSelector**: 申し送り先スタッフ選択
- **ResidentSelector**: 対象利用者選択

#### 1_atoms層

- **CategoryBadge**: カテゴリバッジ表示
- **PriorityBadge**: 重要度バッジ表示
- **StatusBadge**: ステータスバッジ表示

#### カスタムフック

- **useHandoverForm**: フォーム状態管理とバリデーション

### データ型定義

```typescript
interface HandoverFormData {
  title: string; // 件名（必須、100文字以内）
  content: string; // 内容（必須、1000文字以内）
  category: HandoverCategory; // カテゴリ（必須）
  priority: HandoverPriority; // 重要度（必須）
  targetStaffIds: string[]; // 申し送り先（必須、1名以上）
  residentId?: string; // 対象利用者（任意）
  scheduledDate?: string; // 実施予定日（任意）
  scheduledTime?: string; // 実施予定時刻（任意）
}
```

### API仕様

| メソッド | エンドポイント             | 説明             |
| -------- | -------------------------- | ---------------- |
| POST     | `/api/v1/handovers`        | 申し送り新規作成 |
| POST     | `/api/v1/handovers/draft`  | 下書き保存       |
| PUT      | `/api/v1/handovers/{id}`   | 申し送り更新     |
| GET      | `/api/v1/handovers/drafts` | 下書き一覧取得   |

## 参考資料

- [申し送り一覧画面設計書](../README.md)
- [HandoverForm コンポーネント](../../../components/2_molecules/handover/handover-form.tsx)
- [useHandoverForm フック](../../../hooks/useHandoverForm.ts)
- [Handover Types](../../../types/handover.ts)
- [画面一覧](../../../docs/screen-list.md#申し送り介護記録)
